{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"shruggie-indexer","text":"<p>shruggie-indexer produces structured JSON index entries for files and directories, capturing hash-based identities, filesystem timestamps, EXIF metadata, sidecar metadata, and storage attributes. Every entry conforms to the v2 JSON Schema and includes deterministic, content-derived identifiers that are stable across runs and platforms. The tool ships as a CLI utility, a Python library, and a standalone GUI application \u2014 all powered by the same core indexing engine.</p>"},{"location":"#key-features","title":"Key Features","text":"<p>Deterministic hash-based identity \u2014 Each file receives a unique identifier derived from its content hashes (MD5 or SHA-256), prefixed by type (<code>y</code> for files, <code>x</code> for directories). The same file always produces the same ID.</p> <p>Multi-algorithm hashing \u2014 MD5 and SHA-256 are computed in a single streaming pass over each file. Optional SHA-512 is available for high-strength verification workflows.</p> <p>EXIF metadata extraction \u2014 Embedded EXIF, XMP, and IPTC metadata is extracted via ExifTool using a persistent batch process for high throughput. When ExifTool is not installed, all other features continue to work normally.</p> <p>Sidecar metadata discovery and merging \u2014 Automatically discovers sidecar files (<code>.info.json</code>, <code>.description</code>, thumbnails, subtitles, hash files, and more) alongside indexed items. Sidecar content can be merged into parent entries or merged-and-deleted with full provenance tracking for reversal.</p> <p>Configurable TOML-based settings \u2014 All behavior is configurable through a layered system: built-in defaults, user config files, project-local config files, and CLI flags. Sidecar patterns, exclusion lists, and extension validation are all user-modifiable without editing source code.</p> <p>Cross-platform \u2014 Windows, Linux, and macOS are fully supported with platform-aware handling of timestamps, symlinks, and filesystem attributes.</p> <p>Structured v2 JSON output \u2014 Output follows a well-defined schema with typed sub-objects (<code>HashSet</code>, <code>NameObject</code>, <code>SizeObject</code>, <code>TimestampPair</code>, <code>TimestampsObject</code>, <code>ParentObject</code>) and a <code>schema_version</code> discriminator for forward compatibility.</p>"},{"location":"#quick-example","title":"Quick Example","text":"<p>Index a file and print the result to stdout:</p> <pre><code>shruggie-indexer path/to/file.exe\n</code></pre> <p>Output (abbreviated):</p> <pre><code>{\n  \"schema_version\": 2,\n  \"id\": \"yA8A8C089A6A8583B24C85F5A4A41F5AC\",\n  \"id_algorithm\": \"md5\",\n  \"type\": \"file\",\n  \"name\": {\n    \"text\": \"file.exe\",\n    \"hashes\": { \"md5\": \"...\", \"sha256\": \"...\" }\n  },\n  \"extension\": \"exe\",\n  \"size\": { \"text\": \"15.28 MB\", \"bytes\": 16027648 },\n  \"hashes\": { \"md5\": \"A8A8C089...\", \"sha256\": \"B6BA115C...\" },\n  \"file_system\": {\n    \"relative\": \"file.exe\",\n    \"parent\": { \"id\": \"x3B4F479E...\", \"name\": { \"text\": \"my-dir\", \"hashes\": { \"...\": \"...\" } } }\n  },\n  \"timestamps\": {\n    \"created\":  { \"iso\": \"2026-02-15T09:28:17.408462-05:00\", \"unix\": 1771165697408 },\n    \"modified\": { \"iso\": \"2023-08-03T19:47:44.000000-04:00\", \"unix\": 1691106464000 },\n    \"accessed\": { \"iso\": \"2026-02-15T09:28:18.109390-05:00\", \"unix\": 1771165698109 }\n  },\n  \"attributes\": { \"is_link\": false, \"storage_name\": \"yA8A8C089A6A8583B24C85F5A4A41F5AC.exe\" },\n  \"items\": null,\n  \"metadata\": null,\n  \"mime_type\": \"application/octet-stream\"\n}\n</code></pre>"},{"location":"#documentation-sections","title":"Documentation Sections","text":"<ul> <li>Getting Started \u2014 Install shruggie-indexer, set up ExifTool, and index your first file in minutes.</li> <li>User Guide \u2014 Desktop application guide, CLI reference, configuration guide, Python API documentation, and platform-specific notes.</li> <li>Schema Reference \u2014 Full v2 JSON Schema documentation with type definitions, field tables, and annotated examples.</li> <li>Porting Reference \u2014 Historical reference materials from the original PowerShell implementation.</li> <li>Changelog \u2014 Version history and release notes.</li> </ul>"},{"location":"#quick-links","title":"Quick Links","text":"<ul> <li>GitHub Repository</li> <li>V2 JSON Schema (canonical)</li> <li>Technical Specification</li> </ul>"},{"location":"changelog/","title":"Changelog","text":"<p>All notable changes to this project are documented in this file.</p> <p>The format is based on Keep a Changelog, and this project adheres to Semantic Versioning.</p>"},{"location":"changelog/#unreleased","title":"Unreleased","text":""},{"location":"changelog/#added","title":"Added","text":"<ul> <li>Tests: Sidecar handling and MetaMergeDelete test infrastructure \u2014 Created three permanent test files covering sidecar exclusion, MetaMergeDelete pipeline, and full integration scenarios: <code>tests/test_sidecar_exclusion.py</code> (14 tests across 3 classes), <code>tests/test_meta_merge_delete.py</code> (7 tests across 2 classes), and <code>tests/test_integration_mmd_pipeline.py</code> (9 tests across 3 classes). Tests exercise Layer 1 (metadata_exclude_patterns) and Layer 2 (metadata_identify sidecar) filtering, delete queue population/execution, full MMD pipeline, MMD+rename pipeline, in-place sidecar naming, and idempotency. Added 4 new pytest markers: <code>sidecar</code>, <code>mmd</code>, <code>integration</code>, <code>destructive</code>.</li> <li>Tests: <code>sidecar-testbed</code> fixture \u2014 Created <code>tests/fixtures/sidecar-testbed/</code> directory tree with 19 files across 3 subdirectories, exercising all sidecar exclusion, merge, delete, and rename scenarios. Includes content files, sidecar variants (json_metadata, description, screenshot, hash, yaml), prior-run indexer output artifacts, and false-positive candidates (<code>standalone_notes.txt</code>).</li> <li>Core: <code>rename_inplace_sidecar()</code> function \u2014 New public function in <code>core/rename.py</code> that renames an in-place <code>_meta2.json</code> sidecar file from <code>{original_name}_meta2.json</code> to <code>{storage_name}_meta2.json</code> after a content file is renamed. Prevents orphaned sidecars and incorrect sidecar naming when rename is active. Exported via <code>shruggie_indexer.__init__</code>.</li> <li>Core: Rename phase diagnostic logging \u2014 Added comprehensive <code>DEBUG</code>-level logging to <code>_rename_tree()</code> in both GUI and CLI. Each rename candidate now logs its type and storage_name. Directory entries log item count on descent and skip reason when empty.</li> </ul>"},{"location":"changelog/#fixed","title":"Fixed","text":"<ul> <li>Core: In-place directory sidecar naming \u2014 <code>build_sidecar_path()</code> in <code>core/paths.py</code> constructed directory sidecar paths as <code>&lt;dir&gt;/_directorymeta2.json</code> (bare name with no identifying prefix). Every directory in the tree received an identically named file, making them indistinguishable in file managers and inconsistent with both the aggregate output naming (<code>{dirname}_directorymeta2.json</code>) and file sidecar naming (<code>{filename}_meta2.json</code>). Fixed to produce <code>&lt;dir&gt;/{dirname}_directorymeta2.json</code>. The <code>metadata_exclude_patterns</code> regex continues to match the corrected filenames because the pattern is end-anchored.</li> <li>Core: Sidecar files indexed as standalone items \u2014 <code>list_children()</code> in <code>traversal.py</code> was not applying <code>metadata_exclude_patterns</code> during item enumeration. Indexer output artifacts (<code>_meta.json</code>, <code>_meta2.json</code>, <code>_directorymeta2.json</code>) were being treated as regular files \u2014 fully indexed, hashed, EXIF-checked, renamed, and given their own sidecar output (creating absurd filenames like <code>file_meta.json_meta2.json</code>). Fixed by adding Layer 1 filtering: files matching <code>metadata_exclude_patterns</code> are now unconditionally excluded during traversal.</li> <li>Core: Sidecar companion files indexed as standalone items when MetaMerge active \u2014 When MetaMerge was enabled, files matching <code>metadata_identify</code> sidecar patterns (e.g., <code>.info.json</code>, <code>.description</code>, <code>_screen.jpg</code>, <code>.md5</code>, <code>.yaml</code>) appeared as both standalone index entries AND sidecar metadata sources. Fixed by adding Layer 2 filtering in <code>build_directory_entry()</code>: recognized sidecar files are excluded from the entry-building iteration while remaining in the full <code>siblings</code> list for sidecar discovery. This ensures sidecars are consumed exclusively through the merge system without breaking sidecar discovery's sibling enumeration.</li> <li>GUI/CLI: MetaMergeDelete log levels incorrect \u2014 <code>_drain_delete_queue()</code> in both GUI and CLI used <code>logger.debug</code> for successful deletions and <code>logger.warning</code> for failures. Per spec, successful deletions must be logged at <code>INFO</code> (<code>Sidecar deleted: {path}</code>) and failures at <code>ERROR</code> (<code>Sidecar delete FAILED: {path}: {exception}</code>). Fixed in both entry points.</li> <li>GUI/CLI: In-place sidecar files named using pre-rename filename \u2014 When both rename and in-place output were active, <code>_meta2.json</code> sidecar files were written using the original filename (e.g., <code>photo.jpg_meta2.json</code>) instead of the post-rename storage name (e.g., <code>yABC123.jpg_meta2.json</code>). This created orphaned sidecars with no on-disk association to the renamed content file. Fixed by wiring <code>rename_inplace_sidecar()</code> into the rename phase of both GUI and CLI, renaming the sidecar file alongside its content file.</li> <li>GUI/CLI: Pipeline ordering for rename + in-place output \u2014 In-place sidecar writes were happening independently of the rename phase. Swapped ordering so in-place writes occur before rename, and the rename phase handles both the content file and its sidecar atomically. This preserves partial-result survival for non-rename cases while ensuring correct sidecar naming when rename is active.</li> <li>Core: Rename collision logging \u2014 When multiple files share an identical content hash and the rename target already exists on disk, the collision was previously either raised as a <code>RenameError</code> (caught silently by callers) or skipped with no log output. <code>rename_item()</code> now logs a <code>WARNING</code>-level message (<code>Rename SKIPPED (collision): {original_name} \u2192 {storage_name} (target already exists)</code>) and returns the original path without raising. Callers in both GUI and CLI now check the return value to skip in-place sidecar rename for collision-skipped files, preserving the original filename as the sidecar base.</li> </ul>"},{"location":"changelog/#changed","title":"Changed","text":"<ul> <li>Core: <code>build_directory_entry()</code> Layer 2 sidecar filtering \u2014 Moved sidecar-pattern exclusion (Layer 2) from <code>list_children()</code> into <code>build_directory_entry()</code>. The full file list from <code>list_children()</code> is preserved as <code>siblings</code> for sidecar discovery, while a filtered <code>entry_files</code> list (excluding recognized sidecar patterns) is used for child entry construction. This architectural change ensures sidecar discovery can find companion files while preventing them from being indexed as standalone items.</li> <li>Core: <code>list_children()</code> now applies Layer 1 filtering \u2014 <code>list_children()</code> in <code>traversal.py</code> now applies <code>metadata_exclude_patterns</code> (compiled regexes) against all filenames after the scandir loop, before sorting. This is a new filtering step that was previously absent from the traversal module.</li> </ul>"},{"location":"changelog/#010-2026-02-20","title":"0.1.0 - 2026-02-20","text":""},{"location":"changelog/#added_1","title":"Added","text":"<ul> <li>Initial <code>shruggie-indexer</code> release with CLI, GUI, and Python API delivery surfaces.</li> <li>Deterministic v2 schema output with hash-based IDs, timestamp capture, and storage names.</li> <li>Filesystem traversal for files/directories with recursive mode and platform-aware behavior.</li> <li>Metadata features: sidecar discovery/parse/merge flows and optional ExifTool extraction.</li> <li>Output routing modes for stdout, combined outfile, and in-place sidecar JSON writes.</li> <li>Rename flow with dry-run support and configurable identity algorithm (<code>md5</code> or <code>sha256</code>).</li> <li>Config loading with layered defaults and TOML overrides.</li> <li>Cross-platform build-and-release CI that publishes standalone executables for Windows, Linux, and macOS.</li> </ul>"},{"location":"getting-started/exiftool/","title":"ExifTool Setup","text":""},{"location":"getting-started/exiftool/#what-is-exiftool","title":"What Is ExifTool?","text":"<p>ExifTool by Phil Harvey is a platform-independent Perl library and command-line tool for reading, writing, and editing metadata in a wide variety of file formats \u2014 including EXIF, XMP, IPTC, GPS, and maker notes from camera manufacturers.</p> <p>shruggie-indexer uses ExifTool to extract embedded metadata from indexed files when the <code>--meta</code> flag is active. ExifTool is the sole external binary dependency and is required only for embedded metadata extraction. All other functionality \u2014 hashing, timestamp capture, sidecar file handling, renaming \u2014 works without it.</p>"},{"location":"getting-started/exiftool/#installation","title":"Installation","text":""},{"location":"getting-started/exiftool/#windows","title":"Windows","text":"<p>Option 1 \u2014 Direct download:</p> <ol> <li>Download the standalone Windows executable from https://exiftool.org/.</li> <li>Extract the downloaded archive.</li> <li>Rename <code>exiftool(-k).exe</code> to <code>exiftool.exe</code>.</li> <li>Place <code>exiftool.exe</code> in a directory on your system <code>PATH</code> (e.g., <code>C:\\Windows\\</code> or a custom directory you have added to <code>PATH</code>).</li> </ol> <p>Option 2 \u2014 Chocolatey:</p> <pre><code>choco install exiftool\n</code></pre> <p>Option 3 \u2014 winget:</p> <pre><code>winget install OliverBetz.ExifTool\n</code></pre>"},{"location":"getting-started/exiftool/#macos","title":"macOS","text":"<p>Install via Homebrew:</p> <pre><code>brew install exiftool\n</code></pre>"},{"location":"getting-started/exiftool/#linux","title":"Linux","text":"<p>Debian / Ubuntu:</p> <pre><code>sudo apt install libimage-exiftool-perl\n</code></pre> <p>Fedora / RHEL:</p> <pre><code>sudo dnf install perl-Image-ExifTool\n</code></pre> <p>Arch Linux:</p> <pre><code>sudo pacman -S perl-image-exiftool\n</code></pre>"},{"location":"getting-started/exiftool/#verification","title":"Verification","text":"<p>After installing, verify that ExifTool is accessible on your <code>PATH</code> and meets the minimum version requirement (12.0+):</p> <pre><code>exiftool -ver\n</code></pre> <p>This should print a version number of <code>12.00</code> or higher (e.g., <code>12.87</code>).</p>"},{"location":"getting-started/exiftool/#behavior-when-exiftool-is-not-installed","title":"Behavior When ExifTool Is Not Installed","text":"<p>When ExifTool is not found on <code>PATH</code>, shruggie-indexer logs a single warning at startup:</p> <pre><code>WARNING: exiftool not found on PATH; embedded metadata extraction disabled\n</code></pre> <p>The indexing operation continues normally. The <code>metadata</code> array in output entries simply omits the <code>exiftool.json_metadata</code> entry that would otherwise be present. This is a graceful degradation, not a fatal error \u2014 the tool is fully functional for hashing, timestamping, sidecar handling, and renaming without ExifTool.</p> <p>Check once, not per-file</p> <p>The ExifTool availability check happens once at startup and the result is cached. You will not see repeated warnings for each file.</p>"},{"location":"getting-started/exiftool/#invocation-backends","title":"Invocation Backends","text":"<p>shruggie-indexer supports two ExifTool invocation backends, selected automatically based on package availability:</p>"},{"location":"getting-started/exiftool/#primary-pyexiftool-batch-mode","title":"Primary: pyexiftool batch mode","text":"<p>When the <code>pyexiftool</code> Python package is installed (it is a required runtime dependency of shruggie-indexer), the tool uses ExifTool's <code>-stay_open</code> protocol to maintain a single persistent Perl process for the entire indexing run. File paths and arguments are communicated via stdin/stdout pipes.</p> <p>This approach reduces per-file overhead from 200\u2013500 ms (process startup) to roughly 20\u201350 ms (metadata extraction only), making it significantly faster for large directory trees.</p>"},{"location":"getting-started/exiftool/#fallback-subprocess-per-file","title":"Fallback: subprocess per file","text":"<p>If <code>pyexiftool</code> is unavailable or the persistent process cannot be maintained, the tool falls back to spawning a new ExifTool subprocess for each file. Arguments are passed via a temporary argfile using ExifTool's <code>-@</code> switch. This is slower but functionally equivalent.</p> <p>Backend selection</p> <p>The backend is selected once at startup and logged at <code>DEBUG</code> level. Use <code>-vv</code> to see which backend is active.</p>"},{"location":"getting-started/exiftool/#file-extension-exclusion-list","title":"File Extension Exclusion List","text":"<p>By default, shruggie-indexer skips ExifTool invocation for certain file types where ExifTool tends to dump the entire file content as metadata rather than extracting meaningful embedded metadata:</p> Extension Reason <code>csv</code> Text data \u2014 no embedded metadata <code>htm</code> HTML markup <code>html</code> HTML markup <code>json</code> JSON data <code>tsv</code> Tab-separated text data <code>xml</code> XML markup <p>This exclusion list is configurable. See the Configuration page for details on modifying the <code>exiftool.exclude_extensions</code> setting.</p>"},{"location":"getting-started/exiftool/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start \u2014 Try <code>--meta</code> with a real file.</li> <li>CLI Reference \u2014 Full <code>--meta</code>, <code>--meta-merge</code>, and <code>--meta-merge-delete</code> documentation.</li> <li>Configuration \u2014 Customize ExifTool arguments and exclusion lists.</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#system-requirements","title":"System Requirements","text":"Requirement Details Python 3.12 or later Operating System Windows 10/11 (x64), Linux x64 (Ubuntu 22.04+, Fedora 38+), macOS x64/ARM64 (13 Ventura+) External binary ExifTool \u2265 12.0 (optional \u2014 required only for EXIF metadata extraction)"},{"location":"getting-started/installation/#install-via-pip","title":"Install via pip","text":"<p>The recommended way for Python developers to install shruggie-indexer:</p> <pre><code>pip install shruggie-indexer\n</code></pre> <p>This installs the core tool with its required dependencies: <code>click</code>, <code>orjson</code>, <code>pyexiftool</code>, and <code>tqdm</code>.</p>"},{"location":"getting-started/installation/#optional-dependency-groups","title":"Optional dependency groups","text":"<p>Install additional features via extras:</p> <pre><code># GUI application (CustomTkinter-based desktop interface)\npip install shruggie-indexer[gui]\n\n# Development tools (pytest, ruff, jsonschema, pydantic, rich)\npip install shruggie-indexer[dev]\n\n# Documentation tools (mkdocs, mkdocs-material)\npip install shruggie-indexer[docs]\n\n# Everything (GUI + all optional extras)\npip install shruggie-indexer[all]\n</code></pre>"},{"location":"getting-started/installation/#install-from-source","title":"Install from Source","text":"<p>Clone the repository and install in editable mode:</p> <pre><code>git clone https://github.com/shruggietech/shruggie-indexer.git\ncd shruggie-indexer\npython -m venv .venv\n</code></pre> <p>Activate the virtual environment:</p> <pre><code># Windows\n.venv\\Scripts\\activate\n\n# Linux / macOS\nsource .venv/bin/activate\n</code></pre> <p>Install with development dependencies:</p> <pre><code>pip install -e \".[dev]\"\n</code></pre> <p>For the GUI application:</p> <pre><code>pip install -e \".[dev,gui]\"\n</code></pre>"},{"location":"getting-started/installation/#standalone-executables","title":"Standalone Executables","text":"<p>Pre-built executables are available on the GitHub Releases page. These require no Python installation.</p> Platform Artifact Notes Windows x64 <code>shruggie-indexer.exe</code> Primary build target. Single-file executable. Linux x64 <code>shruggie-indexer</code> Tested on Ubuntu 22.04+. macOS ARM64 <code>shruggie-indexer</code> Apple Silicon native. <p>Download the appropriate binary, place it in a directory on your <code>PATH</code>, and run it directly.</p> <p>GUI executables</p> <p>Standalone GUI executables (<code>shruggie-indexer-gui</code>) are also available on the Releases page for each platform.</p>"},{"location":"getting-started/installation/#verification","title":"Verification","text":"<p>After installation, verify the tool is accessible:</p> <pre><code>shruggie-indexer --version\n</code></pre> <p>This should print the installed version (e.g., <code>shruggie-indexer, version 0.1.0</code>).</p>"},{"location":"getting-started/installation/#exiftool-optional","title":"ExifTool (Optional)","text":"<p>ExifTool is required only for embedded EXIF/XMP/IPTC metadata extraction (the <code>--meta</code> flag). All other functionality \u2014 hashing, timestamps, sidecar handling, renaming \u2014 works without it.</p> <p>See the ExifTool Setup page for detailed installation instructions on each platform.</p>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start \u2014 Index your first file or directory.</li> <li>ExifTool Setup \u2014 Install ExifTool for metadata extraction.</li> <li>CLI Reference \u2014 Full command-line option documentation.</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>This guide walks through the most common shruggie-indexer operations. For the full CLI reference, see the CLI Reference.</p>"},{"location":"getting-started/quickstart/#index-a-single-file","title":"Index a Single File","text":"<p>Point shruggie-indexer at any file to produce a JSON index entry on stdout:</p> <pre><code>shruggie-indexer path/to/file.jpg\n</code></pre> <p>The tool auto-detects whether the target is a file or directory. To force the interpretation, use <code>--file</code> or <code>--directory</code>.</p>"},{"location":"getting-started/quickstart/#index-a-directory","title":"Index a Directory","text":"<p>Index a directory and all its contents recursively (the default):</p> <pre><code>shruggie-indexer path/to/directory/\n</code></pre> <p>Disable recursion to index only the directory's immediate children:</p> <pre><code>shruggie-indexer path/to/directory/ --no-recursive\n</code></pre>"},{"location":"getting-started/quickstart/#save-output-to-a-file","title":"Save Output to a File","text":"<p>Write the combined JSON output to a file instead of stdout:</p> <pre><code>shruggie-indexer path/to/target --outfile index.json\n</code></pre> <p>The short form <code>-o</code> also works:</p> <pre><code>shruggie-indexer path/to/target -o index.json\n</code></pre>"},{"location":"getting-started/quickstart/#write-in-place-sidecar-files","title":"Write In-Place Sidecar Files","text":"<p>Write individual <code>_meta2.json</code> sidecar files alongside each indexed item:</p> <pre><code>shruggie-indexer path/to/directory/ --inplace\n</code></pre> <p>This creates a <code>filename_meta2.json</code> next to each file and a <code>_directorymeta2.json</code> inside each directory.</p>"},{"location":"getting-started/quickstart/#enable-metadata-extraction","title":"Enable Metadata Extraction","text":"<p>Extract embedded EXIF/XMP/IPTC metadata via ExifTool:</p> <pre><code>shruggie-indexer path/to/file.jpg --meta\n</code></pre> <p>ExifTool required</p> <p>The <code>--meta</code> flag requires ExifTool to be installed and on your <code>PATH</code>. If ExifTool is not found, a warning is logged and the <code>metadata</code> array simply omits the exiftool entry.</p> <p>Merge sidecar metadata files into the parent entry's metadata array:</p> <pre><code>shruggie-indexer path/to/directory/ --meta-merge\n</code></pre> <p>Merge sidecar metadata and delete the original sidecar files after merging:</p> <pre><code>shruggie-indexer path/to/directory/ --meta-merge-delete --outfile index.json\n</code></pre> <p>Implication chain</p> <p><code>--meta-merge-delete</code> implies <code>--meta-merge</code>, which implies <code>--meta</code>. You do not need to specify all three. Additionally, <code>--meta-merge-delete</code> requires a persistent output destination (<code>--outfile</code> or <code>--inplace</code>).</p>"},{"location":"getting-started/quickstart/#rename-files-to-storage-names","title":"Rename Files to Storage Names","text":"<p>Rename files to their deterministic, hash-based <code>storage_name</code> values:</p> <pre><code>shruggie-indexer path/to/directory/ --rename --dry-run\n</code></pre> <p>The <code>--dry-run</code> flag previews the rename operations without modifying any files. Remove <code>--dry-run</code> to execute the renames:</p> <pre><code>shruggie-indexer path/to/directory/ --rename\n</code></pre> <p>Rename implies in-place</p> <p><code>--rename</code> automatically enables <code>--inplace</code> so that sidecar files are written alongside the renamed items, preserving the original filename in the index entry.</p>"},{"location":"getting-started/quickstart/#choose-an-id-algorithm","title":"Choose an ID Algorithm","text":"<p>By default, the <code>id</code> field uses MD5. To use SHA-256 instead:</p> <pre><code>shruggie-indexer path/to/file --id-type sha256\n</code></pre> <p>To include SHA-512 in the hash output (not used for <code>id</code>, but stored in the <code>hashes</code> object):</p> <pre><code>shruggie-indexer path/to/file --compute-sha512\n</code></pre>"},{"location":"getting-started/quickstart/#example-output","title":"Example Output","text":"<p>Here is a representative JSON output for a single file (abbreviated):</p> <pre><code>{\n  \"schema_version\": 2,\n  \"id\": \"yA8A8C089A6A8583B24C85F5A4A41F5AC\",\n  \"id_algorithm\": \"md5\",\n  \"type\": \"file\",\n  \"name\": {\n    \"text\": \"flashplayer.exe\",\n    \"hashes\": {\n      \"md5\": \"3470F718BA9457335A59CE06239A9250\",\n      \"sha256\": \"4DC834B31A1A5967F7A97AAD3D62EE91CCCC99B2034748135AFC193889B9A0EB\"\n    }\n  },\n  \"extension\": \"exe\",\n  \"mime_type\": \"application/octet-stream\",\n  \"size\": { \"text\": \"15.28 MB\", \"bytes\": 16027648 },\n  \"hashes\": {\n    \"md5\": \"A8A8C089A6A8583B24C85F5A4A41F5AC\",\n    \"sha256\": \"B6BA115C2B43D87AADDF0060C44726E7AF1A12C9501FC63DE652A9517D7367DB\"\n  },\n  \"file_system\": {\n    \"relative\": \".test/flashplayer.exe\",\n    \"parent\": {\n      \"id\": \"x3B4F479E9F880E438882FC34B67D352C\",\n      \"name\": {\n        \"text\": \".test\",\n        \"hashes\": { \"md5\": \"5E7576E3CD79114D46850714E998A3B0\", \"sha256\": \"...\" }\n      }\n    }\n  },\n  \"timestamps\": {\n    \"created\":  { \"iso\": \"2026-02-15T09:28:17.408462-05:00\", \"unix\": 1771165697408 },\n    \"modified\": { \"iso\": \"2023-08-03T19:47:44.000000-04:00\", \"unix\": 1691106464000 },\n    \"accessed\": { \"iso\": \"2026-02-15T09:28:18.109390-05:00\", \"unix\": 1771165698109 }\n  },\n  \"attributes\": {\n    \"is_link\": false,\n    \"storage_name\": \"yA8A8C089A6A8583B24C85F5A4A41F5AC.exe\"\n  },\n  \"items\": null,\n  \"metadata\": null\n}\n</code></pre>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>CLI Reference \u2014 Complete flag documentation, output scenarios, and exit codes.</li> <li>Configuration \u2014 TOML config files, default values, and override behavior.</li> <li>Schema Reference \u2014 Full v2 schema documentation with field tables.</li> </ul>"},{"location":"porting-reference/","title":"Porting Reference","text":"<p>Historical Reference</p> <p>This section contains archival reference materials from the original PowerShell implementation. These documents were used during development and are preserved for traceability. They are not part of the runtime codebase and do not affect shruggie-indexer's behavior.</p>"},{"location":"porting-reference/#operations-catalog","title":"Operations Catalog","text":"<ul> <li>MakeIndex Operations Catalog \u2014 Categorized inventory of all logical operations in the original <code>MakeIndex</code> and its dependency tree, mapped to recommended Python modules.</li> </ul>"},{"location":"porting-reference/#configuration-reference","title":"Configuration Reference","text":"<ul> <li>MetadataFileParser Object \u2014 Isolated PowerShell script containing the complete <code>$global:MetadataFileParser</code> object definition. Source of truth for sidecar metadata file discovery and classification patterns.</li> </ul>"},{"location":"porting-reference/#dependency-catalogs","title":"Dependency Catalogs","text":"<p>Each catalog documents a single function from the original pslib library that <code>MakeIndex</code> depends on \u2014 its parameters, internal sub-functions, external calls, and behavioral contract.</p> Function Catalog Status in Port MakeIndex MakeIndex_DependencyCatalog.md Top-level function being ported. Base64DecodeString Base64DecodeString_DependencyCatalog.md Eliminated \u2014 exiftool arguments passed directly. Date2UnixTime Date2UnixTime_DependencyCatalog.md Eliminated \u2014 timestamps derived from stat results. DirectoryId DirectoryId_DependencyCatalog.md Ported to <code>core/hashing.py</code>. FileId FileId_DependencyCatalog.md Ported to <code>core/hashing.py</code>. MetaFileRead MetaFileRead_DependencyCatalog.md Ported to <code>core/sidecar.py</code>. TempOpen TempOpen_DependencyCatalog.md Eliminated \u2014 replaced by <code>tempfile</code>. TempClose TempClose_DependencyCatalog.md Eliminated \u2014 replaced by context manager cleanup. Vbs Vbs_DependencyCatalog.md Replaced by Python <code>logging</code> framework."},{"location":"porting-reference/#v1-output-schema","title":"V1 Output Schema","text":"<ul> <li>MakeIndex_OutputSchema.json \u2014 The original v1 output schema definition. Retained as a porting reference only \u2014 the port targets the v2 schema.</li> </ul>"},{"location":"porting-reference/#v1-output-examples","title":"V1 Output Examples","text":"<p>The v1-examples/ directory contains real-world output files from the original <code>MakeIndex</code> function:</p> <ul> <li>apktool.jar_meta.json</li> <li>exiftool.exe_meta.json</li> <li>flashplayer.exe_meta.json</li> <li>SearchMyFiles.chm_meta.json</li> </ul>"},{"location":"porting-reference/Base64DecodeString_DependencyCatalog/","title":"Base64DecodeString \u2014 Dependency Catalog","text":"<p>Source: <code>main.ps1</code>, line 764 Purpose: Decodes a Base64-encoded string into plaintext with optional URL decoding and configurable encoding type Audience: AI-first, Human-second  </p>"},{"location":"porting-reference/Base64DecodeString_DependencyCatalog/#1-external-pslib-functions-called","title":"1. External PsLib Functions Called","text":"Function Defined At Called From Purpose <code>Vbs</code> main.ps1:16412 Top-level body Verbose/logging output handler. Called with <code>-Caller</code>, <code>-Status</code> (e/w), <code>-Message</code>, <code>-Verbosity</code> <p>This function has a minimal external dependency footprint. It only calls <code>Vbs</code> for error/warning logging (e.g., empty input string, unknown encoding type).</p>"},{"location":"porting-reference/Base64DecodeString_DependencyCatalog/#2-external-variables-loaded","title":"2. External Variables Loaded","text":"Variable Defined At Type Description (none) \u2014 \u2014 This function does not reference any script-level or global variables. All state is derived from its own parameters."},{"location":"porting-reference/Base64DecodeString_DependencyCatalog/#3-external-binaries-executables-invoked","title":"3. External Binaries / Executables Invoked","text":"Binary Notes (none) This function is entirely .NET-based and does not invoke any external executables."},{"location":"porting-reference/Base64DecodeString_DependencyCatalog/#4-parameters","title":"4. Parameters","text":"Parameter Type Alias(es) Default Description <code>Help</code> <code>[Switch]</code> <code>h</code> <code>$false</code> Print detailed help text and return <code>InputString</code> <code>[System.String]</code> <code>i</code>, <code>in</code>, <code>str</code>, <code>string</code> <code>$null</code> The Base64-encoded string to decode <code>Encoding</code> <code>[System.String]</code> <code>e</code>, <code>encode</code> <code>UTF8</code> Encoding type: <code>UTF8</code> or <code>ASCII</code>. Unknown values fall back to UTF8 with a warning <code>UrlDecode</code> <code>[System.Boolean]</code> <code>u</code> <code>$false</code> If <code>$true</code>, the decoded output is additionally passed through <code>[System.Web.HttpUtility]::UrlDecode()</code> <code>Verbosity</code> <code>[System.Boolean]</code> <code>v</code> <code>$true</code> Controls whether verbose/log messages are printed to the console"},{"location":"porting-reference/Base64DecodeString_DependencyCatalog/#5-internal-logic-summary","title":"5. Internal Logic Summary","text":"<p>The function uses a numeric \"OpsCode\" pattern to select the correct decoding path. The OpsCode is computed by summing two values: one based on the <code>Encoding</code> parameter (0 for UTF8, 1 for ASCII) and one based on the <code>UrlDecode</code> parameter (0 for <code>$false</code>, 10 for <code>$true</code>). The resulting OpsCode determines which of four branches executes:</p> OpsCode Encoding UrlDecode Action 0 UTF8 No <code>[System.Text.Encoding]::UTF8.GetString(FromBase64String(...))</code> 1 ASCII No <code>[System.Text.Encoding]::ASCII.GetString(FromBase64String(...))</code> 10 UTF8 Yes UTF8 decode \u2192 <code>[System.Web.HttpUtility]::UrlDecode(...)</code> 11 ASCII Yes ASCII decode \u2192 <code>[System.Web.HttpUtility]::UrlDecode(...)</code>"},{"location":"porting-reference/Base64DecodeString_DependencyCatalog/#6-internal-sub-functions","title":"6. Internal Sub-Functions","text":"<p>This function defines no internal sub-functions.</p>"},{"location":"porting-reference/Base64DecodeString_DependencyCatalog/#7-net-types-and-methods-used","title":"7. .NET Types and Methods Used","text":"Type / Method Usage <code>[System.Convert]::FromBase64String()</code> Core Base64 \u2192 byte-array conversion <code>[System.Text.Encoding]::UTF8.GetString()</code> Byte-array \u2192 UTF8 string conversion <code>[System.Text.Encoding]::ASCII.GetString()</code> Byte-array \u2192 ASCII string conversion <code>[System.Web.HttpUtility]::UrlDecode()</code> URL-decoding of the decoded string output"},{"location":"porting-reference/Base64DecodeString_DependencyCatalog/#8-powershell-built-in-cmdlets-used","title":"8. PowerShell Built-in Cmdlets Used","text":"Cmdlet Usage Context <code>Get-Help</code> Displaying function help when <code>-Help</code> is specified"},{"location":"porting-reference/Base64DecodeString_DependencyCatalog/#9-return-value","title":"9. Return Value","text":"<p>Returns a <code>[System.String]</code> containing the decoded plaintext. Returns nothing (implicit <code>$null</code>) if the input string is empty.</p>"},{"location":"porting-reference/Base64DecodeString_DependencyCatalog/#10-call-graph","title":"10. Call Graph","text":"<pre><code>Base64DecodeString\n\u251c\u2500\u2500 [validates InputString is non-empty]\n\u2502   \u2514\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (on error)\n\u251c\u2500\u2500 [validates Encoding parameter]\n\u2502   \u2514\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (on unknown encoding warning)\n\u251c\u2500\u2500 [computes OpsCode from Encoding + UrlDecode]\n\u2514\u2500\u2500 [executes decode branch based on OpsCode]\n    \u251c\u2500\u2500 (OpsCode=0)  \u2192 UTF8 decode\n    \u251c\u2500\u2500 (OpsCode=1)  \u2192 ASCII decode\n    \u251c\u2500\u2500 (OpsCode=10) \u2192 UTF8 decode + UrlDecode\n    \u2514\u2500\u2500 (OpsCode=11) \u2192 ASCII decode + UrlDecode\n</code></pre>"},{"location":"porting-reference/Date2UnixTime_DependencyCatalog/","title":"Date2UnixTime \u2014 Dependency Catalog","text":"<p>Source: <code>main.ps1</code>, line 2517 Purpose: Converts a formatted date string to a Unix timestamp (milliseconds since epoch) with optional or auto-detected format codes Audience: AI-first, Human-second  </p>"},{"location":"porting-reference/Date2UnixTime_DependencyCatalog/#1-external-pslib-functions-called","title":"1. External PsLib Functions Called","text":"Function Defined At Called From Purpose <code>Date2FormatCode</code> main.ps1:2374 Top-level body Attempts to determine a date-time format code from a raw date string. Called when no explicit <code>-Format</code> parameter is provided. Returns a format code string or <code>$null</code> <code>Vbs</code> main.ps1:16412 Top-level body Verbose/logging output handler. Called with <code>-Caller</code>, <code>-Status</code> (e), <code>-Message</code>, <code>-Verbosity</code>"},{"location":"porting-reference/Date2UnixTime_DependencyCatalog/#dependency-note-date2formatcode","title":"Dependency Note: <code>Date2FormatCode</code>","text":"<p><code>Date2FormatCode</code> is a separate top-level pslib function (defined at main.ps1:2374) that analyzes the structure of a date string and returns a matching .NET date-time format code. It is the primary means by which <code>Date2UnixTime</code> auto-detects the format of an input date string when no explicit <code>-Format</code> is specified. If <code>Date2FormatCode</code> fails to detect a format, <code>Date2UnixTime</code> falls back to its own internal format-guessing logic via the <code>Date2UnixTimeSquash</code> \u2192 <code>Date2UnixTimeCountDigits</code> \u2192 <code>Date2UnixTimeFormatCode</code> chain.</p>"},{"location":"porting-reference/Date2UnixTime_DependencyCatalog/#2-external-variables-loaded","title":"2. External Variables Loaded","text":"Variable Defined At Type Description (none) \u2014 \u2014 This function does not reference any script-level or global variables. All state is derived from its own parameters."},{"location":"porting-reference/Date2UnixTime_DependencyCatalog/#3-external-binaries-executables-invoked","title":"3. External Binaries / Executables Invoked","text":"Binary Notes (none) This function is entirely .NET-based and does not invoke any external executables."},{"location":"porting-reference/Date2UnixTime_DependencyCatalog/#4-parameters","title":"4. Parameters","text":"Parameter Type Alias(es) Default Description <code>Date</code> <code>[System.String]</code> <code>d</code>, <code>i</code>, <code>in</code>, <code>inputdate</code> <code>$null</code> The date string to convert (e.g., <code>\"2021-12-31 23:59:59\"</code>) <code>Format</code> <code>[System.String]</code> <code>f</code>, <code>formatstring</code> <code>$null</code> An explicit .NET date-time format code (e.g., <code>\"yyyy-MM-dd HH:mm:ss\"</code>). If omitted, the function auto-detects the format <code>Help</code> <code>[Switch]</code> <code>h</code> <code>$false</code> Print detailed help text and return <code>Verbosity</code> <code>[System.Boolean]</code> <code>v</code> <code>$true</code> Controls whether verbose/log messages are printed to the console"},{"location":"porting-reference/Date2UnixTime_DependencyCatalog/#5-internal-sub-functions-defined-within-date2unixtime","title":"5. Internal Sub-Functions (Defined Within Date2UnixTime)","text":"Function Line Purpose <code>Date2UnixTimeCountDigits</code> main.ps1:2577 Counts the number of numeric characters (digits) in the input date string using regex matching <code>Date2UnixTimeFormatCode</code> main.ps1:2595 Maps a digit count (4\u201320) to a .NET date-time format code string via a switch statement. Returns <code>$null</code> for out-of-range counts <code>Date2UnixTimeSquash</code> main.ps1:2626 Strips all non-numeric characters from the input date string using regex replacement (<code>-replace '[^\\d]', ''</code>)"},{"location":"porting-reference/Date2UnixTime_DependencyCatalog/#6-internal-logic-summary","title":"6. Internal Logic Summary","text":"<p>The function follows a three-stage process:</p> <p>Stage 1 \u2014 Input Validation: Checks that a non-empty <code>-Date</code> parameter was provided. Returns an error via <code>Vbs</code> if missing.</p> <p>Stage 2 \u2014 Format Code Resolution: If an explicit <code>-Format</code> is provided, it is used directly and the date string is passed through unchanged. Otherwise, the function first attempts format detection via the external <code>Date2FormatCode</code> function. If that returns <code>$null</code>, the function falls back to its own internal pipeline: the date string is stripped of non-numeric characters (<code>Date2UnixTimeSquash</code>), digits are counted (<code>Date2UnixTimeCountDigits</code>), and the count is mapped to a format code (<code>Date2UnixTimeFormatCode</code>). Additional edge-case handling includes rejecting dates with fewer than 4 digits, truncating dates longer than 20 digits, and trimming odd-count digit strings by one character to produce an even count.</p> <p>Stage 3 \u2014 Conversion: The resolved date string and format code are passed to <code>[DateTimeOffset]::ParseExact()</code> and the result is converted to Unix time in milliseconds via <code>.ToUnixTimeMilliseconds()</code>.</p>"},{"location":"porting-reference/Date2UnixTime_DependencyCatalog/#7-net-types-and-methods-used","title":"7. .NET Types and Methods Used","text":"Type / Method Usage <code>[DateTimeOffset]::ParseExact()</code> Parses the date string using the resolved format code <code>.ToUnixTimeMilliseconds()</code> Converts the parsed <code>DateTimeOffset</code> to Unix epoch milliseconds <code>[int64]</code> Cast for the final return value"},{"location":"porting-reference/Date2UnixTime_DependencyCatalog/#8-powershell-built-in-cmdlets-used","title":"8. PowerShell Built-in Cmdlets Used","text":"Cmdlet Usage Context <code>Get-Help</code> Displaying function help when <code>-Help</code> is specified"},{"location":"porting-reference/Date2UnixTime_DependencyCatalog/#9-return-value","title":"9. Return Value","text":"<p>Returns an <code>[int64]</code> representing the Unix timestamp in milliseconds since the Unix epoch (1970-01-01T00:00:00Z). Returns nothing (implicit <code>$null</code>) if the input date is empty or has fewer than 4 numeric characters.</p>"},{"location":"porting-reference/Date2UnixTime_DependencyCatalog/#10-call-graph","title":"10. Call Graph","text":"<pre><code>Date2UnixTime\n\u251c\u2500\u2500 [validates Date parameter is non-empty]\n\u2502   \u2514\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (on error)\n\u251c\u2500\u2500 [Format code resolution]\n\u2502   \u251c\u2500\u2500 (Format provided) \u2192 use as-is\n\u2502   \u2514\u2500\u2500 (Format not provided)\n\u2502       \u251c\u2500\u2500 Date2FormatCode \u25c4\u2500\u2500 external pslib\n\u2502       \u2514\u2500\u2500 (Date2FormatCode returned $null) \u2192 fallback:\n\u2502           \u251c\u2500\u2500 Date2UnixTimeSquash (internal)\n\u2502           \u251c\u2500\u2500 Date2UnixTimeCountDigits (internal)\n\u2502           \u2502   \u2514\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (on &lt;4 digits error)\n\u2502           \u2514\u2500\u2500 Date2UnixTimeFormatCode (internal)\n\u2514\u2500\u2500 [DateTimeOffset]::ParseExact() \u2192 .ToUnixTimeMilliseconds()\n</code></pre>"},{"location":"porting-reference/DirectoryId_DependencyCatalog/","title":"DirectoryId \u2014 Dependency Catalog","text":"<p>Source: <code>main.ps1</code>, line 2819 Purpose: Generates hash-based unique identifiers for directories by combining hashes of the directory name and its parent directory name Audience: AI-first, Human-second  </p>"},{"location":"porting-reference/DirectoryId_DependencyCatalog/#1-external-pslib-functions-called","title":"1. External PsLib Functions Called","text":"Function Defined At Called From Purpose <code>Vbs</code> main.ps1:16412 Top-level body and <code>DirectoryId-ResolvePath</code> Verbose/logging output handler. Called with <code>-Caller</code>, <code>-Status</code> (i/e), <code>-Message</code>, <code>-Verbosity</code> <p>This function has a minimal external dependency footprint. It only calls <code>Vbs</code> for informational logging and error reporting (missing directory, non-existent directory, empty input in path resolution).</p>"},{"location":"porting-reference/DirectoryId_DependencyCatalog/#2-external-variables-loaded","title":"2. External Variables Loaded","text":"Variable Defined At Type Description (none) \u2014 \u2014 This function does not reference any script-level or global variables. All state is derived from its own parameters and the filesystem."},{"location":"porting-reference/DirectoryId_DependencyCatalog/#3-external-binaries-executables-invoked","title":"3. External Binaries / Executables Invoked","text":"Binary Notes (none) This function is entirely .NET-based and does not invoke any external executables."},{"location":"porting-reference/DirectoryId_DependencyCatalog/#4-parameters","title":"4. Parameters","text":"Parameter Type Alias(es) Default Description <code>Directory</code> <code>[System.String]</code> <code>d</code>, <code>dir</code>, <code>p</code>, <code>path</code> <code>$null</code> The full path to the target directory. Mandatory unless <code>-Here</code> is <code>$true</code> <code>Here</code> <code>[System.Boolean]</code> (none) <code>$false</code> If <code>$true</code>, the current working directory (<code>$PWD</code>) is used instead of <code>-Directory</code> <code>OutputObject</code> <code>[Switch]</code> <code>o</code> <code>$false</code> Return a <code>[PSCustomObject]</code> with all properties instead of a single hash string <code>OutputJson</code> <code>[Switch]</code> <code>j</code> <code>$false</code> Return a JSON-formatted string of the full result object <code>Verbosity</code> <code>[System.Boolean]</code> <code>v</code> <code>$false</code> Controls whether verbose/log messages are printed to the console"},{"location":"porting-reference/DirectoryId_DependencyCatalog/#5-internal-sub-functions-defined-within-directoryid","title":"5. Internal Sub-Functions (Defined Within DirectoryId)","text":"Function Line Purpose Nesting <code>DirectoryId-GetName</code> main.ps1:2939 Extracts the leaf name from a directory path using <code>[System.IO.Path]::GetFileName()</code>. Returns <code>$null</code> for root-level paths Top-level internal <code>DirectoryId-HashString</code> main.ps1:2963 Dispatcher function that routes hashing requests to the appropriate algorithm-specific sub-function based on a <code>-Type</code> parameter (<code>MD5</code>, <code>SHA1</code>, <code>SHA256</code>, <code>SHA512</code>) Top-level internal <code>DirectoryId-HashString-Md5</code> main.ps1:2973 Hashes a string using <code>[System.Security.Cryptography.MD5]::Create()</code>. Returns the null-hash constant <code>D41D8CD98F00B204E9800998ECF8427E</code> for empty/null inputs Nested inside <code>DirectoryId-HashString</code> <code>DirectoryId-HashString-Sha1</code> main.ps1:2993 Hashes a string using <code>[System.Security.Cryptography.SHA1]::Create()</code>. Returns the null-hash constant for empty/null inputs Nested inside <code>DirectoryId-HashString</code> <code>DirectoryId-HashString-Sha256</code> main.ps1:3013 Hashes a string using <code>[System.Security.Cryptography.SHA256]::Create()</code>. Returns the null-hash constant for empty/null inputs Nested inside <code>DirectoryId-HashString</code> <code>DirectoryId-HashString-Sha512</code> main.ps1:3033 Hashes a string using <code>[System.Security.Cryptography.SHA512]::Create()</code>. Returns the null-hash constant for empty/null inputs Nested inside <code>DirectoryId-HashString</code> <code>DirectoryId-ParentName</code> main.ps1:3063 Derives the parent directory's name by calling <code>Split-Path</code> then <code>DirectoryId-GetName</code>. Returns <code>$null</code> for root-level directories Top-level internal <code>DirectoryId-ResolvePath</code> main.ps1:3086 Resolves a path to its absolute form using <code>Resolve-Path</code> with a <code>[System.IO.Path]::GetFullPath()</code> fallback for hypothetical paths Top-level internal"},{"location":"porting-reference/DirectoryId_DependencyCatalog/#6-internal-logic-summary","title":"6. Internal Logic Summary","text":"<p>ID Generation Algorithm:</p> <p>The directory ID is computed by a two-layer hashing scheme:</p> <ol> <li>Hash the directory's own name \u2192 <code>DirectoryNameHash</code></li> <li>Hash the parent directory's name \u2192 <code>ParentNameHash</code></li> <li>Concatenate both hash strings \u2192 <code>CombinedParts</code></li> <li>Hash the concatenated string \u2192 Final <code>Id</code></li> </ol> <p>This is performed independently for each of four hash algorithms (MD5, SHA1, SHA256, SHA512), producing four distinct IDs.</p> <p>The final IDs are prefixed with <code>\"x\"</code> to distinguish directory IDs from file IDs (which use the <code>\"y\"</code> prefix in the companion function <code>FileId</code>).</p> <p>Null Hash Handling:</p> <p>When a directory is at the root of a filesystem (and thus has no parent name), the hash of an empty string is used for the parent component. The known null-hash constants for each algorithm are hardcoded in the sub-functions:</p> Algorithm Null Hash MD5 <code>D41D8CD98F00B204E9800998ECF8427E</code> SHA1 <code>DA39A3EE5E6B4B0D3255BFEF95601890AFD80709</code> SHA256 <code>E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B855</code> SHA512 <code>CF83E1357EEFB8BDF1542850D66D8007D620E4050B5715DC83F4A921D36CE9CE47D0D13C5D85F2B0FF8318D2877EEC2F63B931BD47417A81A538327AF927DA3E</code>"},{"location":"porting-reference/DirectoryId_DependencyCatalog/#7-output-object-properties","title":"7. Output Object Properties","text":"<p>The full <code>[PSCustomObject]</code> (returned when <code>-OutputObject</code> is used) contains:</p> Property Type Description <code>IsDirectory</code> <code>[Boolean]</code> Always <code>$true</code> for valid directory inputs <code>IsFile</code> <code>[Boolean]</code> Always <code>$false</code> (inverse of <code>IsDirectory</code>) <code>IsLink</code> <code>[Boolean]</code> Always hardcoded to <code>$false</code> (symlink detection is not performed in this function) <code>DirectoryName</code> <code>[String]</code> The leaf name of the directory <code>DirectoryNameMD5</code> <code>[String]</code> MD5 hash of the directory name <code>DirectoryNameSHA1</code> <code>[String]</code> SHA1 hash of the directory name <code>DirectoryNameSHA256</code> <code>[String]</code> SHA256 hash of the directory name <code>DirectoryNameSHA512</code> <code>[String]</code> SHA512 hash of the directory name <code>ParentName</code> <code>[String]</code> The leaf name of the parent directory <code>ParentNameMD5</code> <code>[String]</code> MD5 hash of the parent name <code>ParentNameSHA1</code> <code>[String]</code> SHA1 hash of the parent name <code>ParentNameSHA256</code> <code>[String]</code> SHA256 hash of the parent name <code>ParentNameSHA512</code> <code>[String]</code> SHA512 hash of the parent name <code>IdMD5</code> <code>[String]</code> Final directory ID (MD5), prefixed with <code>\"x\"</code> <code>IdSHA1</code> <code>[String]</code> Final directory ID (SHA1), prefixed with <code>\"x\"</code> <code>IdSHA256</code> <code>[String]</code> Final directory ID (SHA256), prefixed with <code>\"x\"</code> <code>IdSHA512</code> <code>[String]</code> Final directory ID (SHA512), prefixed with <code>\"x\"</code>"},{"location":"porting-reference/DirectoryId_DependencyCatalog/#8-net-types-and-methods-used","title":"8. .NET Types and Methods Used","text":"Type / Method Usage <code>[System.IO.Path]::GetFileName()</code> Extracting directory leaf name <code>[System.IO.Path]::GetFullPath()</code> Resolving hypothetical paths <code>[System.Security.Cryptography.MD5]::Create()</code> MD5 hash computation <code>[System.Security.Cryptography.SHA1]::Create()</code> SHA1 hash computation <code>[System.Security.Cryptography.SHA256]::Create()</code> SHA256 hash computation <code>[System.Security.Cryptography.SHA512]::Create()</code> SHA512 hash computation <code>[System.Text.Encoding]::UTF8.GetBytes()</code> String \u2192 byte-array conversion for hashing <code>[BitConverter]::ToString()</code> Byte-array \u2192 hex-string conversion <code>[PSCustomObject]@{}</code> Output object construction"},{"location":"porting-reference/DirectoryId_DependencyCatalog/#9-powershell-built-in-cmdlets-used","title":"9. PowerShell Built-in Cmdlets Used","text":"Cmdlet Usage Context <code>ConvertTo-Json</code> Serializing output object when <code>-OutputJson</code> is specified (<code>-Depth 100</code>) <code>Resolve-Path</code> Resolving directory paths to absolute form (<code>-LiteralPath</code>) <code>Select-Object</code> Extracting <code>$PWD</code> path (<code>-Expand Path</code>) <code>Split-Path</code> Extracting parent directory path (<code>-LiteralPath</code>) <code>Test-Path</code> Validating directory existence (<code>-LiteralPath</code>, <code>-PathType Container</code>)"},{"location":"porting-reference/DirectoryId_DependencyCatalog/#10-return-value","title":"10. Return Value","text":"<p>Default (no output switches): Returns a <code>[System.String]</code> containing the SHA256-based directory ID (prefixed with <code>\"x\"</code>).</p> <p>With <code>-OutputObject</code>: Returns the full <code>[PSCustomObject]</code> described in Section 7.</p> <p>With <code>-OutputJson</code>: Returns a JSON-formatted string of the full result object.</p> <p>Returns <code>$null</code> if the input directory is missing or does not exist.</p>"},{"location":"porting-reference/DirectoryId_DependencyCatalog/#11-call-graph","title":"11. Call Graph","text":"<pre><code>DirectoryId\n\u251c\u2500\u2500 [resolves -Here or -Directory input]\n\u2502   \u2514\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (on missing/invalid directory)\n\u251c\u2500\u2500 DirectoryId-ResolvePath\n\u2502   \u2514\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (on empty input)\n\u251c\u2500\u2500 DirectoryId-GetName (directory name)\n\u251c\u2500\u2500 DirectoryId-HashString (\u00d74 algorithms, directory name)\n\u2502   \u251c\u2500\u2500 DirectoryId-HashString-Md5\n\u2502   \u251c\u2500\u2500 DirectoryId-HashString-Sha1\n\u2502   \u251c\u2500\u2500 DirectoryId-HashString-Sha256\n\u2502   \u2514\u2500\u2500 DirectoryId-HashString-Sha512\n\u251c\u2500\u2500 DirectoryId-ParentName\n\u2502   \u251c\u2500\u2500 Split-Path\n\u2502   \u2514\u2500\u2500 DirectoryId-GetName (parent name)\n\u251c\u2500\u2500 DirectoryId-HashString (\u00d74 algorithms, parent name)\n\u251c\u2500\u2500 [concatenate directory + parent hashes]\n\u251c\u2500\u2500 DirectoryId-HashString (\u00d74 algorithms, concatenated parts \u2192 final IDs)\n\u2514\u2500\u2500 [format output based on switches]\n</code></pre>"},{"location":"porting-reference/FileId_DependencyCatalog/","title":"FileId \u2014 Dependency Catalog","text":"<p>Source: <code>main.ps1</code>, line 4941 Purpose: Generates hash-based unique identifiers for files based on file content hashing (or name hashing for symbolic links) Audience: AI-first, Human-second  </p>"},{"location":"porting-reference/FileId_DependencyCatalog/#1-external-pslib-functions-called","title":"1. External PsLib Functions Called","text":"Function Defined At Called From Purpose <code>Vbs</code> main.ps1:16412 Top-level body and <code>FileId-ResolvePath</code> Verbose/logging output handler. Called with <code>-Caller</code>, <code>-Status</code> (e/w), <code>-Message</code>, <code>-Verbosity</code> <p>This function has a minimal external dependency footprint. It only calls <code>Vbs</code> for error/warning logging (missing input, invalid file, invalid hash types, empty path in resolution).</p>"},{"location":"porting-reference/FileId_DependencyCatalog/#2-external-variables-loaded","title":"2. External Variables Loaded","text":"Variable Defined At Type Description (none) \u2014 \u2014 This function does not reference any script-level or global variables. All state is derived from its own parameters and the filesystem."},{"location":"porting-reference/FileId_DependencyCatalog/#3-external-binaries-executables-invoked","title":"3. External Binaries / Executables Invoked","text":"Binary Notes (none) This function is entirely .NET-based and does not invoke any external executables."},{"location":"porting-reference/FileId_DependencyCatalog/#4-parameters","title":"4. Parameters","text":"Parameter Type Alias(es) Default Description <code>FileIdPendingFile</code> <code>[System.String]</code> (none) <code>$null</code> The file path to generate an identifier for <code>OutputObject</code> <code>[Switch]</code> <code>o</code> <code>$false</code> Return a <code>[PSCustomObject]</code> with all properties <code>OutputJson</code> <code>[Switch]</code> <code>j</code> <code>$false</code> Return a JSON-formatted string of the full result object <code>IncludeHashTypes</code> <code>[System.Array]</code> (none) <code>@('md5','sha256')</code> Array of hash algorithms to use. Valid values: <code>md5</code>, <code>sha1</code>, <code>sha256</code>, <code>sha512</code>, <code>all</code>. Case-insensitive. Specifying <code>all</code> expands to all four types <code>Verbosity</code> <code>[System.Boolean]</code> <code>v</code> <code>$true</code> Controls whether verbose/log messages are printed to the console"},{"location":"porting-reference/FileId_DependencyCatalog/#5-internal-sub-functions-defined-within-fileid","title":"5. Internal Sub-Functions (Defined Within FileId)","text":"Function Line Purpose Nesting <code>FileId-GetName</code> main.ps1:5041 Extracts the simple file name from a path using <code>[System.IO.Path]::GetFileName()</code>. Returns <code>$null</code> for empty paths Top-level internal <code>FileId-HashMd5</code> main.ps1:5063 Computes MD5 hash of file contents via <code>[System.IO.File]::OpenRead()</code> and <code>[System.Security.Cryptography.MD5]::Create()</code> Top-level internal <code>FileId-HashMd5-String</code> main.ps1:5076 Computes MD5 hash of a string value. Returns null-hash constant for empty/null inputs Top-level internal <code>FileId-HashSha1</code> main.ps1:5094 Computes SHA1 hash of file contents Top-level internal <code>FileId-HashSha1-String</code> main.ps1:5107 Computes SHA1 hash of a string value. Returns null-hash constant for empty/null inputs Top-level internal <code>FileId-HashSha256</code> main.ps1:5125 Computes SHA256 hash of file contents Top-level internal <code>FileId-HashSha256-String</code> main.ps1:5138 Computes SHA256 hash of a string value. Returns null-hash constant for empty/null inputs Top-level internal <code>FileId-HashSha512</code> main.ps1:5156 Computes SHA512 hash of file contents Top-level internal <code>FileId-HashSha512-String</code> main.ps1:5169 Computes SHA512 hash of a string value. Returns null-hash constant for empty/null inputs Top-level internal <code>FileId-ResolvePath</code> main.ps1:5187 Resolves a file path to its absolute form using <code>Resolve-Path</code> with a <code>[System.IO.Path]::GetFullPath()</code> fallback Top-level internal"},{"location":"porting-reference/FileId_DependencyCatalog/#6-internal-logic-summary","title":"6. Internal Logic Summary","text":"<p>ID Generation Algorithm:</p> <p>Unlike <code>DirectoryId</code> (which hashes directory + parent name), <code>FileId</code> hashes file contents directly:</p> <ol> <li>Resolve the file path to absolute form</li> <li>Detect if the file is a symbolic link (via <code>ReparsePoint</code> attribute check)</li> <li>For each requested hash type:</li> <li>If the file is a symbolic link \u2192 hash the file name string instead of contents</li> <li>If the file is not a symbolic link \u2192 hash the file contents via file stream</li> <li>Prepend <code>\"y\"</code> to each content hash to form the final ID</li> </ol> <p>The <code>\"y\"</code> prefix distinguishes file IDs from directory IDs (which use the <code>\"x\"</code> prefix in <code>DirectoryId</code>).</p> <p>Symlink Handling:</p> <p>Symbolic links are detected via: <code>(Get-Item -LiteralPath $FilePath -Force).Attributes -band [System.IO.FileAttributes]::ReparsePoint</code></p> <p>When a file is a symlink, the content hash is replaced with the name hash, ensuring the ID remains deterministic without requiring the link target to be accessible.</p> <p>Name Hashes:</p> <p>Name hashes (MD5, SHA1, SHA256, SHA512 of the file name string) are always computed regardless of the <code>IncludeHashTypes</code> parameter, as they are low-overhead and are needed for the symlink fallback path.</p>"},{"location":"porting-reference/FileId_DependencyCatalog/#7-output-object-properties","title":"7. Output Object Properties","text":"<p>The full <code>[PSCustomObject]</code> (returned when <code>-OutputObject</code> is used) contains:</p> Property Type Description <code>IsDirectory</code> <code>[Boolean]</code> Always <code>$false</code> for valid file inputs <code>IsFile</code> <code>[Boolean]</code> <code>$true</code> if the file exists <code>IsLink</code> <code>[Boolean]</code> <code>$true</code> if the file is a symbolic link (ReparsePoint) <code>Name</code> <code>[String]</code> The simple file name (with extension, no path) <code>Path</code> <code>[String]</code> The resolved absolute file path <code>NameMD5</code> <code>[String]</code> MD5 hash of the file name string <code>NameSHA1</code> <code>[String]</code> SHA1 hash of the file name string <code>NameSHA256</code> <code>[String]</code> SHA256 hash of the file name string <code>NameSHA512</code> <code>[String]</code> SHA512 hash of the file name string <code>ContentMD5</code> <code>[String]</code> or <code>$null</code> MD5 hash of file contents (or name hash if symlink). <code>$null</code> if not in <code>IncludeHashTypes</code> <code>ContentSHA1</code> <code>[String]</code> or <code>$null</code> SHA1 hash of file contents (or name hash if symlink). <code>$null</code> if not requested <code>ContentSHA256</code> <code>[String]</code> or <code>$null</code> SHA256 hash of file contents (or name hash if symlink). <code>$null</code> if not requested <code>ContentSHA512</code> <code>[String]</code> or <code>$null</code> SHA512 hash of file contents (or name hash if symlink). <code>$null</code> if not requested <code>IdMD5</code> <code>[String]</code> or <code>$null</code> <code>\"y\"</code> + ContentMD5. <code>$null</code> if not requested <code>IdSHA1</code> <code>[String]</code> or <code>$null</code> <code>\"y\"</code> + ContentSHA1. <code>$null</code> if not requested <code>IdSHA256</code> <code>[String]</code> or <code>$null</code> <code>\"y\"</code> + ContentSHA256. <code>$null</code> if not requested <code>IdSHA512</code> <code>[String]</code> or <code>$null</code> <code>\"y\"</code> + ContentSHA512. <code>$null</code> if not requested <code>ContentHashTypes</code> <code>[Array]</code> Array of hash type strings that were actually processed"},{"location":"porting-reference/FileId_DependencyCatalog/#8-net-types-and-methods-used","title":"8. .NET Types and Methods Used","text":"Type / Method Usage <code>[System.IO.File]::OpenRead()</code> Opening file stream for content hashing <code>[System.IO.FileAttributes]::ReparsePoint</code> Symbolic link detection via bitwise AND <code>[System.IO.Path]::GetFileName()</code> Extracting file name from path <code>[System.IO.Path]::GetFullPath()</code> Resolving hypothetical paths <code>[System.Security.Cryptography.MD5]::Create()</code> MD5 hash computation <code>[System.Security.Cryptography.SHA1]::Create()</code> SHA1 hash computation <code>[System.Security.Cryptography.SHA256]::Create()</code> SHA256 hash computation <code>[System.Security.Cryptography.SHA512]::Create()</code> SHA512 hash computation <code>[System.Text.Encoding]::UTF8.GetBytes()</code> String \u2192 byte-array conversion for name hashing <code>[BitConverter]::ToString()</code> Byte-array \u2192 hex-string conversion <code>[PSCustomObject]@{}</code> Output object construction"},{"location":"porting-reference/FileId_DependencyCatalog/#9-powershell-built-in-cmdlets-used","title":"9. PowerShell Built-in Cmdlets Used","text":"Cmdlet Usage Context <code>ConvertTo-Json</code> Serializing output when <code>-OutputJson</code> is specified (<code>-Depth 100</code>) <code>Get-Item</code> Checking file attributes for symlink detection (<code>-Force</code>, <code>-LiteralPath</code>) <code>Resolve-Path</code> Resolving file paths to absolute form (<code>-LiteralPath</code>) <code>Test-Path</code> Validating file existence (<code>-LiteralPath</code>, <code>-PathType Leaf/Container</code>)"},{"location":"porting-reference/FileId_DependencyCatalog/#10-return-value","title":"10. Return Value","text":"<p>Default (no output switches): Returns a <code>[System.String]</code> containing the last content hash ID processed (corresponds to the last element in the <code>IncludeHashTypes</code> array; with defaults this is the SHA256-based ID prefixed with <code>\"y\"</code>).</p> <p>With <code>-OutputObject</code>: Returns the full <code>[PSCustomObject]</code> described in Section 7.</p> <p>With <code>-OutputJson</code>: Returns a JSON-formatted string of the full result object.</p> <p>Returns <code>$null</code> if the input file is missing, does not exist, or no valid hash types were processed.</p>"},{"location":"porting-reference/FileId_DependencyCatalog/#11-call-graph","title":"11. Call Graph","text":"<pre><code>FileId\n\u251c\u2500\u2500 [validates FileIdPendingFile is non-empty and exists]\n\u2502   \u2514\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (on error)\n\u251c\u2500\u2500 FileId-ResolvePath\n\u2502   \u2514\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (on empty input)\n\u251c\u2500\u2500 FileId-GetName\n\u251c\u2500\u2500 [compute name hashes \u2014 always performed]\n\u2502   \u251c\u2500\u2500 FileId-HashMd5-String\n\u2502   \u251c\u2500\u2500 FileId-HashSha1-String\n\u2502   \u251c\u2500\u2500 FileId-HashSha256-String\n\u2502   \u2514\u2500\u2500 FileId-HashSha512-String\n\u251c\u2500\u2500 [detect symbolic link via ReparsePoint]\n\u251c\u2500\u2500 [expand \"all\" keyword in IncludeHashTypes]\n\u251c\u2500\u2500 [for each requested hash type]\n\u2502   \u251c\u2500\u2500 (is symlink) \u2192 use name hash as content hash\n\u2502   \u2514\u2500\u2500 (not symlink) \u2192 compute content hash via:\n\u2502       \u251c\u2500\u2500 FileId-HashMd5 (file stream)\n\u2502       \u251c\u2500\u2500 FileId-HashSha1 (file stream)\n\u2502       \u251c\u2500\u2500 FileId-HashSha256 (file stream)\n\u2502       \u2514\u2500\u2500 FileId-HashSha512 (file stream)\n\u2502   \u2514\u2500\u2500 prepend \"y\" to form final ID\n\u2514\u2500\u2500 [format output based on switches]\n</code></pre>"},{"location":"porting-reference/MakeIndex_DependencyCatalog/","title":"MakeIndex \u2014 Dependency Catalog","text":"<p>Source: <code>main.ps1</code>, line 7531 Purpose: Generates JSON-formatted nested indexes of files and directories with metadata Audience: AI-first, Human-second  </p>"},{"location":"porting-reference/MakeIndex_DependencyCatalog/#1-external-pslib-functions-called","title":"1. External PsLib Functions Called","text":"<p>These functions are defined at the top level of <code>main.ps1</code> (outside of MakeIndex) and are called from within MakeIndex or its nested sub-functions.</p> Function Defined At Called From (within MakeIndex) Purpose <code>Base64DecodeString</code> main.ps1:764 <code>GetFileExif</code> \u2192 <code>GetFileExifArgsWrite</code> Decodes Base64-encoded exiftool argument strings (with URL-decode and UTF8 encoding support) <code>Date2UnixTime</code> main.ps1:2517 <code>MakeObject</code> Converts formatted date strings to Unix timestamps <code>DirectoryId</code> main.ps1:2819 <code>MakeObject</code> Generates unique identifiers (MD5, SHA256) for directories based on directory name hashing. Returns an object with <code>.IdMD5</code>, <code>.IdSHA256</code>, <code>.DirectoryName</code>, <code>.DirectoryNameMD5</code>, <code>.DirectoryNameSHA256</code>, <code>.IsLink</code> properties <code>FileId</code> main.ps1:4941 <code>MakeObject</code> Generates unique identifiers (MD5, SHA256) for files based on content hashing. Returns an object with <code>.IdMD5</code>, <code>.IdSHA256</code>, <code>.ContentMD5</code>, <code>.ContentSHA256</code>, <code>.NameMD5</code>, <code>.NameSHA256</code>, <code>.IsLink</code> properties <code>MetaFileRead</code> main.ps1:10233 <code>ReadMetaFile</code> Reads and parses external metadata files (sidecar files). Accepts <code>-InputFile</code>, <code>-Format \"object\"</code>, <code>-ProgressString</code>, <code>-Verbosity</code>. Returns an object with <code>.Type</code>, <code>.Data</code>, <code>.Name</code> properties <code>TempOpen</code> main.ps1:15119 <code>GetFileExif</code> Creates a temporary file and returns its path. Called with <code>-Type 'txt'</code> <code>TempClose</code> main.ps1:15044 <code>GetFileExif</code> Deletes a temporary file. Called with <code>-Target &lt;path&gt;</code> <code>Vbs</code> main.ps1:16412 Throughout (all sub-functions) Verbose/logging output handler. Called with <code>-Caller</code>, <code>-Status</code> (i/d/w/e), <code>-Message</code>, <code>-Verbosity</code>"},{"location":"porting-reference/MakeIndex_DependencyCatalog/#listed-but-not-directly-called","title":"Listed but Not Directly Called","text":"Function Notes <code>ValidateIsLink</code> Listed in the MakeIndex docstring under \"Function Dependencies\" but never directly invoked within MakeIndex code. The <code>.IsLink</code> property is obtained indirectly via the return objects of <code>DirectoryId</code> and <code>FileId</code>, which likely call <code>ValidateIsLink</code> internally."},{"location":"porting-reference/MakeIndex_DependencyCatalog/#2-external-variables-loaded","title":"2. External Variables Loaded","text":"<p>These variables are defined at the script level of <code>main.ps1</code> (in the variable declarations section, lines ~17383\u201317441) and are accessed by MakeIndex through scope inheritance or the <code>$global:</code> prefix.</p> Variable Defined At Type Description <code>$global:MetadataFileParser</code> main.ps1:16977 <code>[ordered]@{}</code> (Hashtable) Large configuration object governing metadata file parsing behavior. MakeIndex consumes the following sub-properties:<code>.Exiftool.Exclude</code> \u2014 Array of file extensions to skip for exiftool processing<code>.Indexer.Include</code> \u2014 Array of regex patterns identifying metadata sidecar file suffixes<code>.Indexer.IncludeString</code> \u2014 Joined regex string of the Include array<code>.Indexer.Exclude</code> \u2014 Array of regex patterns for metadata files to exclude<code>.Indexer.ExcludeString</code> \u2014 Joined regex string of the Exclude array<code>.Identify.&lt;Key&gt;</code> \u2014 Sub-objects mapping metadata file types to their regex patterns (used by <code>MetaFileRead</code> downstream) <code>$Sep</code> main.ps1:17383 <code>[System.Char]</code> Directory separator character (<code>[System.IO.Path]::DirectorySeparatorChar</code>). Used when constructing renamed file paths in <code>MakeDirectoryIndexLogic</code>, <code>MakeDirectoryIndexRecursiveLogic</code>, and <code>MakeFileIndex</code>"},{"location":"porting-reference/MakeIndex_DependencyCatalog/#global-variables-createdmanaged-at-runtime","title":"Global Variables Created/Managed at Runtime","text":"<p>MakeIndex promotes several local parameter values to global scope for access by deeply nested sub-functions, then cleans them up at the end of execution:</p> Variable Lifecycle Purpose <code>$global:ExiftoolRejectList</code> Created at start, removed at end Copy of <code>$MetadataFileParser.Exiftool.Exclude</code> <code>$global:MetaSuffixInclude</code> Created at start, removed at end Copy of <code>$MetadataFileParser.Indexer.Include</code> <code>$global:MetaSuffixIncludeString</code> Created at start, removed at end Copy of <code>$MetadataFileParser.Indexer.IncludeString</code> <code>$global:MetaSuffixExclude</code> Created at start, removed at end Copy of <code>$MetadataFileParser.Indexer.Exclude</code> <code>$global:MetaSuffixExcludeString</code> Created at start, removed at end Copy of <code>$MetadataFileParser.Indexer.ExcludeString</code> <code>$global:DeleteQueue</code> Created at start (<code>@()</code>), removed at end Accumulates file paths of metadata sidecar files to delete when <code>-MetaMergeDelete</code> is active"},{"location":"porting-reference/MakeIndex_DependencyCatalog/#3-external-binaries-executables-invoked","title":"3. External Binaries / Executables Invoked","text":"Binary Called From (within MakeIndex) How Invoked Purpose <code>exiftool</code> <code>GetFileExif</code> \u2192 <code>GetFileExifRun</code> <code>exiftool -@ \"$ArgsFile\" 2&gt; $null</code> \u2014 Invoked via bare command name (must be in system PATH). Receives arguments from a temporary file written by <code>GetFileExifArgsWrite</code>. Extracts EXIF/metadata from files. Arguments include: <code>-extractEmbedded3</code>, <code>-scanForXMP</code>, <code>-unknown2</code>, <code>-json</code>, <code>-G3:1</code>, <code>-struct</code>, <code>-ignoreMinorErrors</code>, <code>-charset filename=utf8</code>, <code>-api requestall=3</code>, <code>-api largefilesupport=1</code> (plus <code>-quiet</code> when verbosity is off) <code>jq</code> <code>GetFileExif</code> \u2192 <code>GetFileExifRun</code> <code>$ExiftoolOutput \\| jq -c '.[] \\| .' 2&gt; $null</code> and a second pass with <code>jq -c 'del(\u2026)'</code> to strip unwanted keys Parses and filters JSON output from exiftool. Removes system/exiftool metadata keys (ExifToolVersion, FileSequence, NewGUID, Directory, FileName, FilePath, BaseName, FilePermissions, etc.)"},{"location":"porting-reference/MakeIndex_DependencyCatalog/#note-on-binary-resolution","title":"Note on Binary Resolution","text":"<p>Neither <code>exiftool</code> nor <code>jq</code> are referenced via absolute paths. Both must be available in the system <code>PATH</code> environment variable at runtime. The MakeIndex docstring explicitly states: \"exiftool must be installed and available in the system PATH. This function will not work without it.\" The <code>jq</code> dependency is implicit (not mentioned in the docstring) but is equally required for metadata extraction to work.</p>"},{"location":"porting-reference/MakeIndex_DependencyCatalog/#4-internal-sub-functions-defined-within-makeindex","title":"4. Internal Sub-Functions (Defined Within MakeIndex)","text":"<p>For completeness and call-chain tracing, these are the functions defined inside the MakeIndex function body. They are not accessible outside of MakeIndex.</p>"},{"location":"porting-reference/MakeIndex_DependencyCatalog/#top-level-internal-functions","title":"Top-Level Internal Functions","text":"Function Purpose Calls (internal) Calls (external PsLib) <code>GetFileEncoding</code> Detects file encoding via BOM byte inspection \u2014 \u2014 <code>GetFileExif</code> Orchestrates exiftool execution for a single file <code>GetFileExifArgsWrite</code>, <code>GetFileExifRun</code>, <code>UpdateFunctionStack</code> <code>Base64DecodeString</code>, <code>TempOpen</code>, <code>TempClose</code>, <code>Vbs</code> <code>GetFileMetaSiblings</code> Finds sibling metadata files matching a given file's basename <code>GetParentPath</code>, <code>UpdateFunctionStack</code> <code>Vbs</code> <code>GetParentPath</code> Extracts parent directory path from a full path string \u2014 \u2014 <code>MakeDirectoryIndex</code> Entry point for non-recursive directory indexing <code>MakeDirectoryIndexLogic</code>, <code>UpdateFunctionStack</code> <code>Vbs</code> <code>MakeDirectoryIndexRecursive</code> Entry point for recursive directory indexing <code>MakeDirectoryIndexRecursiveLogic</code>, <code>UpdateFunctionStack</code> <code>Vbs</code> <code>MakeFileIndex</code> Entry point for single-file indexing <code>MakeObject</code>, <code>GetParentPath</code>, <code>UpdateFunctionStack</code> <code>Vbs</code> <code>MakeObject</code> Core object builder \u2014 constructs the PSCustomObject for any file or directory <code>GetFileEncoding</code>, <code>GetFileExif</code>, <code>GetFileMetaSiblings</code>, <code>GetParentPath</code>, <code>ReadMetaFile</code>, <code>VariableStringify</code>, <code>UpdateFunctionStack</code> <code>Date2UnixTime</code>, <code>DirectoryId</code>, <code>FileId</code>, <code>Vbs</code> <code>ReadMetaFile</code> Reads a metadata sidecar file and wraps it in a standard object <code>ReadMetaFile-GetNameHashMD5</code>, <code>ReadMetaFile-GetNameHashSHA256</code>, <code>UpdateFunctionStack</code> <code>MetaFileRead</code>, <code>Vbs</code> <code>ResolvePath</code> Resolves real or hypothetical filesystem paths <code>UpdateFunctionStack</code> <code>Vbs</code> <code>UpdateFunctionStack</code> Maintains a colon-delimited call-stack string for logging \u2014 \u2014 <code>VariableStringify</code> Converts variables to string representations (handles null/empty) \u2014 \u2014"},{"location":"porting-reference/MakeIndex_DependencyCatalog/#nested-internal-functions-defined-inside-other-internal-functions","title":"Nested Internal Functions (defined inside other internal functions)","text":"Function Parent Function Purpose <code>GetFileExifArgsWrite</code> <code>GetFileExif</code> Writes decoded exiftool argument strings to a temp file <code>GetFileExifRun</code> <code>GetFileExif</code> Executes <code>exiftool</code> and pipes output through <code>jq</code> <code>MakeDirectoryIndexLogic</code> <code>MakeDirectoryIndex</code> Core non-recursive directory traversal and object assembly <code>MakeDirectoryIndexRecursiveLogic</code> <code>MakeDirectoryIndexRecursive</code> Core recursive directory traversal and object assembly (calls itself recursively for child directories) <code>ReadMetaFile-GetNameHashMD5</code> <code>ReadMetaFile</code> Computes MD5 hash of a filename string <code>ReadMetaFile-GetNameHashSHA256</code> <code>ReadMetaFile</code> Computes SHA256 hash of a filename string"},{"location":"porting-reference/MakeIndex_DependencyCatalog/#5-powershell-built-in-cmdlets-and-net-types-used","title":"5. PowerShell Built-in Cmdlets and .NET Types Used","text":"<p>For porting reference, MakeIndex relies on these PowerShell cmdlets and .NET framework types.</p>"},{"location":"porting-reference/MakeIndex_DependencyCatalog/#cmdlets","title":"Cmdlets","text":"Cmdlet Usage Context <code>Add-Content</code> Appending filename to exiftool args file <code>ConvertFrom-Json</code> Parsing exiftool JSON output (<code>-AsHashtable</code>) <code>ConvertTo-Json</code> Serializing output objects (<code>-Depth 100</code>) <code>Get-ChildItem</code> Directory listing (with <code>-Force</code>, <code>-File</code>, <code>-Recurse</code>, <code>-LiteralPath</code>) <code>Get-Help</code> (not directly, but pattern exists in other functions) <code>Get-Item</code> File/directory info retrieval (<code>-Force</code>, <code>-LiteralPath</code>) <code>Measure-Object</code> Directory size calculation (<code>-Property Length -Sum</code>) <code>Move-Item</code> File renaming (<code>-LiteralPath</code>, <code>-Destination</code>, <code>-Force</code>) <code>Out-File</code> Writing final JSON output (<code>-Encoding UTF8</code>) <code>Out-Null</code> Suppressing output from <code>Remove-Item</code> <code>Remove-Item</code> Deleting metadata files from DeleteQueue (<code>-LiteralPath</code>, <code>-Force</code>) <code>Remove-Variable</code> Cleaning up global variables at end of execution <code>Resolve-Path</code> Path resolution (<code>-LiteralPath</code>) <code>Select-Object</code> Property selection and exclusion <code>Set-Content</code> Writing in-place metadata JSON files (<code>-LiteralPath</code>, <code>-Force</code>) <code>Set-Location</code> Changing working directory for exiftool and directory traversal <code>Split-Path</code> Extracting parent path <code>Test-Path</code> Validating file/directory existence (<code>-LiteralPath</code>, <code>-PathType Leaf/Container</code>) <code>Where-Object</code> Filtering child items (excluding <code>$RECYCLE.BIN</code>, <code>System Volume Information</code>; separating files from directories)"},{"location":"porting-reference/MakeIndex_DependencyCatalog/#net-types-and-methods","title":".NET Types and Methods","text":"Type / Method Usage <code>[math]::Round()</code> Progress percentage calculation <code>[System.Collections.ArrayList]</code> Combining file and directory child item arrays <code>[System.IO.FileStream]</code> BOM-based encoding detection <code>[System.IO.Path]::GetFileName()</code> Extracting filename from full path <code>[System.IO.Path]::GetFileNameWithoutExtension()</code> Extracting basename <code>[System.IO.Path]::GetFullPath()</code> Resolving hypothetical paths <code>[System.IO.Path]::GetDirectoryName()</code> Extracting directory from file path <code>[System.Security.Cryptography.MD5]::Create()</code> MD5 hashing (in ReadMetaFile sub-functions) <code>[System.Security.Cryptography.SHA256]::Create()</code> SHA256 hashing (in ReadMetaFile sub-functions) <code>[System.Text.Encoding]::UTF8</code> Encoding for hash computation <code>[System.Text.RegularExpressions.Regex]::Escape()</code> Escaping basename for regex matching <code>[BitConverter]::ToString()</code> Converting hash bytes to hex string <code>[DateTimeOffset]::Now.ToUnixTimeMilliseconds()</code> Session ID generation <code>[PSCustomObject]@{}</code> All output object construction <code>[Text.Encoding]::ASCII/UTF7/Unicode/BigEndianUnicode/UTF32/UTF8</code> Encoding type constants for BOM detection"},{"location":"porting-reference/MakeIndex_DependencyCatalog/#6-summary-call-graph","title":"6. Summary Call Graph","text":"<pre><code>MakeIndex\n\u251c\u2500\u2500 [validates inputs, resolves paths, sets up globals]\n\u251c\u2500\u2500 ResolvePath \u2192 Vbs\n\u251c\u2500\u2500 GetParentPath\n\u2502\n\u251c\u2500\u2500 (TargetTyp=0) MakeDirectoryIndexRecursive \u2192 Vbs\n\u2502   \u2514\u2500\u2500 MakeDirectoryIndexRecursiveLogic (recursive)\n\u2502       \u251c\u2500\u2500 MakeObject \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       \u2502   \u251c\u2500\u2500 VariableStringify                    \u2502\n\u2502       \u2502   \u251c\u2500\u2500 GetParentPath                        \u2502\n\u2502       \u2502   \u251c\u2500\u2500 DirectoryId \u25c4\u2500\u2500\u2500\u2500\u2500\u2500 external pslib   \u2502\n\u2502       \u2502   \u251c\u2500\u2500 FileId \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 external pslib    \u2502\n\u2502       \u2502   \u251c\u2500\u2500 Date2UnixTime \u25c4\u2500\u2500\u2500\u2500 external pslib   \u2502\n\u2502       \u2502   \u251c\u2500\u2500 GetFileEncoding                      \u2502\n\u2502       \u2502   \u251c\u2500\u2500 GetFileExif                          \u2502\n\u2502       \u2502   \u2502   \u251c\u2500\u2500 Base64DecodeString \u25c4\u2500\u2500 ext pslib \u2502\n\u2502       \u2502   \u2502   \u251c\u2500\u2500 TempOpen \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 ext pslib \u2502\n\u2502       \u2502   \u2502   \u251c\u2500\u2500 TempClose \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 ext pslib \u2502\n\u2502       \u2502   \u2502   \u251c\u2500\u2500 [exiftool] \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 BINARY    \u2502\n\u2502       \u2502   \u2502   \u2514\u2500\u2500 [jq] \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 BINARY     \u2502\n\u2502       \u2502   \u251c\u2500\u2500 GetFileMetaSiblings                  \u2502\n\u2502       \u2502   \u251c\u2500\u2500 ReadMetaFile                         \u2502\n\u2502       \u2502   \u2502   \u251c\u2500\u2500 MetaFileRead \u25c4\u2500\u2500\u2500\u2500 external pslib\u2502\n\u2502       \u2502   \u2502   \u251c\u2500\u2500 ReadMetaFile-GetNameHashMD5      \u2502\n\u2502       \u2502   \u2502   \u2514\u2500\u2500 ReadMetaFile-GetNameHashSHA256   \u2502\n\u2502       \u2502   \u2514\u2500\u2500 Vbs \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 external pslib     \u2502\n\u2502       \u2514\u2500\u2500 MakeDirectoryIndexRecursiveLogic (self)  \u2502\n\u2502                                                    \u2502\n\u251c\u2500\u2500 (TargetTyp=1) MakeFileIndex \u2192 Vbs                \u2502\n\u2502   \u2514\u2500\u2500 MakeObject \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2502\n\u251c\u2500\u2500 (TargetTyp=2) MakeDirectoryIndex \u2192 Vbs\n\u2502   \u2514\u2500\u2500 MakeDirectoryIndexLogic\n\u2502       \u2514\u2500\u2500 MakeObject (same as above)\n\u2502\n\u251c\u2500\u2500 [DeleteQueue processing]\n\u251c\u2500\u2500 [Global variable cleanup via Remove-Variable]\n\u251c\u2500\u2500 [OutFile via ConvertTo-Json | Out-File]\n\u2514\u2500\u2500 [StandardOutput via ConvertTo-Json]\n</code></pre>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/","title":"Operations Catalog \u2014 MakeIndex Port to Python","text":"<p>Purpose: Categorize all logical operations found in the original MakeIndex function (and its dependency tree) into defined groups, correlate each group to recommended Python modules/libraries, and flag improvements over the original implementation. Audience: AI-first, Human-second Scope: Covers MakeIndex, its 8 external pslib dependencies (Base64DecodeString, Date2UnixTime, DirectoryId, FileId, MetaFileRead, TempOpen, TempClose, Vbs), 2 external binaries (exiftool, jq), and all internal sub-functions. Schema Reference: <code>MakeIndex_OutputSchema.json</code> \u2014 the <code>Encoding</code> key is intentionally excluded from the ported software per project requirements.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#how-to-read-this-document","title":"How to Read This Document","text":"<p>Each operation category below contains:</p> <ul> <li>What It Does: A summary of the original behavior across MakeIndex and its dependencies.</li> <li>Where It Lives (Original): The specific functions/sub-functions in the PowerShell source that implement the operation.</li> <li>Python Modules: The recommended Python standard-library or third-party modules for the ported implementation.</li> <li>Improvement Notes: Where the original logic was inefficient, fragile, or platform-locked, and how the Python port should diverge.</li> </ul> <p>Categories are ordered by architectural importance (foundational operations first, output/presentation operations last).</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#category-index","title":"Category Index","text":"# Category Primary Python Modules 1 Filesystem Traversal &amp; Discovery <code>pathlib</code>, <code>os</code> 2 Path Resolution &amp; Manipulation <code>pathlib</code> 3 Hashing &amp; Identity Generation <code>hashlib</code> 4 Symlink Detection <code>pathlib</code> 5 Filesystem Timestamps &amp; Date Conversion <code>datetime</code> 6 EXIF / Embedded Metadata Extraction <code>subprocess</code> + <code>exiftool</code>, <code>json</code> 7 Sidecar Metadata File Handling <code>json</code>, <code>re</code>, <code>pathlib</code> 8 Output Object Construction &amp; Schema <code>dataclasses</code>, <code>json</code> 9 JSON Serialization &amp; Output Routing <code>json</code> (or <code>orjson</code>), <code>pathlib</code>, <code>sys</code> 10 File Rename &amp; In-Place Write Operations <code>pathlib</code>, <code>shutil</code> 11 Configuration Management <code>dataclasses</code>, <code>tomllib</code> (or <code>pyyaml</code>) 12 Logging &amp; Verbosity <code>logging</code> 13 Progress Reporting <code>tqdm</code> (or <code>rich</code>) 14 CLI Argument Parsing &amp; Entry Point <code>click</code> (or <code>argparse</code>) 15 Temporary File Management <code>tempfile</code>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#1-filesystem-traversal-discovery","title":"1. Filesystem Traversal &amp; Discovery","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does","title":"What It Does","text":"<p>Enumerates files and directories within a target path. Supports recursive and non-recursive modes. Filters out system artifacts (<code>$RECYCLE.BIN</code>, <code>System Volume Information</code>). Separates child items into file and directory lists. Counts items for progress reporting. Handles the three input scenarios: single file, single directory (flat), and directory tree (recursive).</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original","title":"Where It Lives (Original)","text":"Function Role <code>MakeDirectoryIndexRecursiveLogic</code> Recursive tree walk via <code>Get-ChildItem -Force -Recurse</code> combined with self-recursive calls per child directory <code>MakeDirectoryIndexLogic</code> Non-recursive single-directory enumeration via <code>Get-ChildItem -Force</code> <code>MakeFileIndex</code> Single-file path; skips traversal entirely, calls <code>Get-Item</code> on one file <code>Where-Object</code> filters Excludes <code>$RECYCLE.BIN</code> and <code>System Volume Information</code> by name match <code>[System.Collections.ArrayList]</code> Combines file and directory child arrays into a single ordered collection"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules","title":"Python Modules","text":"Module Usage <code>pathlib.Path.iterdir()</code> Non-recursive directory listing <code>pathlib.Path.rglob('*')</code> Recursive traversal (replaces <code>Get-ChildItem -Recurse</code>) <code>os.scandir()</code> High-performance directory iteration when <code>pathlib</code> overhead matters (large trees) <code>pathlib.Path.is_file()</code> / <code>.is_dir()</code> Item type classification (replaces <code>Where-Object</code> separation)"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes","title":"Improvement Notes","text":"<p>The original uses two entirely separate code paths for recursive vs. non-recursive traversal (<code>MakeDirectoryIndexRecursiveLogic</code> which calls itself, vs. <code>MakeDirectoryIndexLogic</code>). This created near-complete code duplication. The Python port should use a single traversal function parameterized by a <code>recursive: bool</code> flag. When <code>recursive=True</code>, use <code>Path.rglob('*')</code> or <code>os.walk()</code>. When <code>recursive=False</code>, use <code>Path.iterdir()</code>. Both paths feed into the same object-construction pipeline.</p> <p>The original manually assembles an <code>ArrayList</code> from two separate <code>Get-ChildItem</code> calls (one for files, one for directories). Python's <code>os.scandir()</code> returns <code>DirEntry</code> objects that already expose <code>.is_file()</code> and <code>.is_dir()</code> without additional stat calls, making the separation trivially cheap in a single pass.</p> <p>The hardcoded exclusion of <code>$RECYCLE.BIN</code> and <code>System Volume Information</code> is Windows-specific. The port should externalize the exclusion list into configuration (see Category 11) and default to a cross-platform set that also covers <code>.DS_Store</code>, <code>.Spotlight-V100</code>, <code>.Trashes</code>, and similar platform artifacts.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#2-path-resolution-manipulation","title":"2. Path Resolution &amp; Manipulation","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_1","title":"What It Does","text":"<p>Resolves relative, hypothetical, or symbolic paths into absolute canonical forms. Extracts parent directories, basenames, extensions, and filenames from path strings. Constructs new paths for renamed files and sidecar metadata outputs. Validates extension strings against a regex pattern to reject malformed or suspiciously long extensions.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_1","title":"Where It Lives (Original)","text":"Function Role <code>ResolvePath</code> Resolves real paths via <code>Resolve-Path</code>; falls back to <code>[System.IO.Path]::GetFullPath()</code> for hypothetical (non-existent) paths <code>GetParentPath</code> Extracts parent directory via <code>Split-Path</code> <code>MakeObject</code> Extracts extension, basename, filename via <code>[System.IO.Path]</code> methods; validates extension with regex <code>^(([a-z0-9]){1,2}\\|([a-z0-9]){1}([a-z0-9\\-]){1,12}([a-z0-9]){1})$</code> <code>FileId-ResolvePath</code> / <code>DirectoryId-ResolvePath</code> Redundant copies of the same resolve logic inside FileId and DirectoryId <code>$Sep</code> (global) <code>[System.IO.Path]::DirectorySeparatorChar</code> used for manual string concatenation of paths"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_1","title":"Python Modules","text":"Module Usage <code>pathlib.Path.resolve()</code> Canonical absolute path resolution (replaces <code>Resolve-Path</code> + <code>GetFullPath</code> fallback) <code>pathlib.Path.parent</code> Parent directory extraction (replaces <code>Split-Path</code> and <code>GetParentPath</code>) <code>pathlib.Path.name</code> / <code>.stem</code> / <code>.suffix</code> Filename, basename, and extension extraction (replaces all <code>[System.IO.Path]</code> calls) <code>pathlib.PurePosixPath</code> / <code>PureWindowsPath</code> Cross-platform path construction without touching the filesystem"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_1","title":"Improvement Notes","text":"<p>The original has three independent copies of the \"resolve path\" logic: <code>ResolvePath</code> in MakeIndex, <code>FileId-ResolvePath</code> in FileId, and <code>DirectoryId-ResolvePath</code> in DirectoryId. All three do the same thing. The Python port should have exactly one path resolution utility.</p> <p>The original constructs paths by string-concatenating components with <code>$Sep</code> as a manual separator character. This is brittle and unnecessary. <code>pathlib</code> operator overloading (<code>parent / filename</code>) handles path construction correctly across platforms with no separator management.</p> <p>The extension validation regex in the original rejects extensions longer than 14 characters or those containing non-alphanumeric characters (beyond hyphens). This is reasonable but should be made configurable rather than hardcoded, as some legitimate extensions (e.g., <code>.numbers</code>, <code>.download</code>) may be affected.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#3-hashing-identity-generation","title":"3. Hashing &amp; Identity Generation","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_2","title":"What It Does","text":"<p>Computes cryptographic hashes of file contents and name strings to produce deterministic unique identifiers. Files get content-based IDs (prefixed <code>y</code>); directories get name-based IDs computed from a two-layer scheme: <code>hash( hash(dirName) + hash(parentDirName) )</code> (prefixed <code>x</code>). Handles null/empty inputs with known null-hash constants. Handles symlinks by falling back to name hashing instead of content hashing.</p> <p>The original only computes MD5 and SHA256 at runtime, despite the output schema defining fields for SHA1 and SHA512 as well.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_2","title":"Where It Lives (Original)","text":"Function Role <code>FileId</code> + 8 nested hash sub-functions File content hashing (MD5, SHA1, SHA256, SHA512) via <code>[System.Security.Cryptography.*]::Create()</code> + <code>[System.IO.File]::OpenRead()</code> stream hashing; name string hashing via same algorithms on UTF-8 byte encoding <code>DirectoryId</code> + 8 nested hash sub-functions Directory name hashing using the two-layer <code>hash(hash(name) + hash(parentName))</code> scheme <code>ReadMetaFile-GetNameHashMD5</code> / <code>ReadMetaFile-GetNameHashSHA256</code> Yet more copies of string hashing logic, duplicated inside <code>ReadMetaFile</code> <code>MetaFileRead-Sha256-File</code> / <code>MetaFileRead-Sha256-String</code> Even more copies inside <code>MetaFileRead</code> itself Null-hash constants Hardcoded per-algorithm empty-string hash values for edge cases"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_2","title":"Python Modules","text":"Module Usage <code>hashlib</code> All hash computation: <code>hashlib.md5()</code>, <code>hashlib.sha1()</code>, <code>hashlib.sha256()</code>, <code>hashlib.sha512()</code> \u2014 supports both file stream hashing (via <code>.update()</code> in chunks) and string hashing (via <code>.update(s.encode('utf-8'))</code>) <code>hashlib.file_digest()</code> Python 3.11+ convenience function for hashing file contents directly from a file object; ideal for the file content hashing path"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_2","title":"Improvement Notes","text":"<p>Critical code duplication problem. The original has no fewer than four separate locations where hashing logic is independently implemented: <code>FileId</code>, <code>DirectoryId</code>, <code>ReadMetaFile</code> sub-functions, and <code>MetaFileRead</code> sub-functions. Each reimplements the same <code>Create() \u2192 ComputeHash() \u2192 ToString() \u2192 replace('-','')</code> pattern. The Python port should provide exactly one hashing utility module exposing functions like <code>hash_file(path, algorithm) -&gt; str</code> and <code>hash_string(value, algorithm) -&gt; str</code>, called from everywhere.</p> <p>Expand runtime hash coverage. The original only computes MD5 and SHA256 at runtime, but the output schema defines SHA1 and SHA512 fields. Since <code>hashlib</code> can compute all four algorithms in a single file read pass (feeding the same byte chunks to four hash objects simultaneously), the Python port should compute all four by default with near-zero marginal cost. This fills the previously-empty schema fields and enables downstream consumers to select their preferred algorithm.</p> <p>Chunked file reading. The original opens the entire file stream and calls <code>ComputeHash()</code> on it in one pass. For very large files this is fine at the .NET level (it streams internally), but the Python port should be explicit about chunked reads (e.g., 8 KB or 64 KB chunks fed to <code>hashlib.update()</code>) to keep memory usage bounded and to enable multi-algorithm hashing in a single pass.</p> <p>The <code>x</code>/<code>y</code> prefix convention for directory vs. file IDs is a design choice carried forward from the original. It should be preserved for backward compatibility with the output schema.</p> <p>Null-hash constants should not be hardcoded. Instead, the Python port can compute them once at module load time: <code>hashlib.md5(b'').hexdigest().upper()</code>, etc. This is self-documenting and eliminates the risk of copy-paste errors in long hex strings.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#4-symlink-detection","title":"4. Symlink Detection","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_3","title":"What It Does","text":"<p>Determines whether a file or directory is a symbolic link (reparse point). When a file is a symlink, the identity system falls back to hashing the file's name string rather than its content (because the link target may not be accessible). The <code>IsLink</code> boolean is included in the output schema.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_3","title":"Where It Lives (Original)","text":"Function Role <code>FileId</code> Checks <code>(Get-Item).Attributes -band [System.IO.FileAttributes]::ReparsePoint</code> <code>DirectoryId</code> Same reparse point check for directories <code>ValidateIsLink</code> Listed as a dependency but never directly called; <code>FileId</code> and <code>DirectoryId</code> perform the check inline <code>MakeObject</code> Reads <code>.IsLink</code> from the <code>FileId</code>/<code>DirectoryId</code> return object; skips encoding detection and exiftool for symlinks"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_3","title":"Python Modules","text":"Module Usage <code>pathlib.Path.is_symlink()</code> Single cross-platform call; returns <code>True</code> for both file and directory symlinks <code>os.path.islink()</code> Alternative for string-path interfaces"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_3","title":"Improvement Notes","text":"<p>The original checks for the <code>ReparsePoint</code> attribute, which is a Windows-specific concept that covers symlinks but also covers junction points and other reparse point types. <code>pathlib.Path.is_symlink()</code> is the correct cross-platform equivalent. On Windows it still detects reparse points; on Linux/macOS it detects POSIX symlinks. This is a strict improvement in portability.</p> <p>The <code>ValidateIsLink</code> function listed in the original docstring but never called is dead code. It should not be carried forward.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#5-filesystem-timestamps-date-conversion","title":"5. Filesystem Timestamps &amp; Date Conversion","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_4","title":"What It Does","text":"<p>Reads filesystem timestamps (created, modified, accessed) from file/directory stat data. Formats them as ISO 8601 strings with timezone offset (format: <code>yyyy-MM-ddTHH:mm:ss.fffffffzzz</code>). Converts those formatted strings to Unix timestamps (milliseconds since epoch) via the external <code>Date2UnixTime</code> function.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_4","title":"Where It Lives (Original)","text":"Function Role <code>MakeObject</code> Reads <code>.LastAccessTime</code>, <code>.CreationTime</code>, <code>.LastWriteTime</code> from <code>Get-Item</code>; formats via <code>.ToString($DateFormat)</code> <code>Date2UnixTime</code> (external pslib) Parses formatted date strings back into <code>[DateTimeOffset]</code> objects and calls <code>.ToUnixTimeMilliseconds()</code>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_4","title":"Python Modules","text":"Module Usage <code>datetime.datetime</code> Timestamp formatting via <code>.isoformat()</code> or <code>.strftime()</code> <code>datetime.datetime.timestamp()</code> Direct conversion to Unix epoch seconds (multiply by 1000 for milliseconds) <code>os.stat_result</code> / <code>pathlib.Path.stat()</code> Reading <code>st_mtime</code>, <code>st_atime</code>, <code>st_ctime</code> (or <code>st_birthtime</code> on macOS)"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_4","title":"Improvement Notes","text":"<p>The original performs an unnecessary round-trip. It formats a datetime to a string, then passes that string to <code>Date2UnixTime</code> which parses it back into a datetime object just to call <code>.ToUnixTimeMilliseconds()</code>. The Python port should extract the Unix timestamp directly from the stat result's float value: <code>int(stat_result.st_mtime * 1000)</code>. The formatted ISO string can be produced separately from the same source datetime. No round-trip parsing needed.</p> <p>Creation time portability. Windows provides a true creation time (<code>CreationTime</code>). Linux typically does not expose birth time in <code>os.stat()</code> unless the filesystem and kernel support <code>st_birthtime</code> (available on some systems via <code>os.stat_result.st_birthtime</code>). The port should attempt <code>st_birthtime</code> and fall back to <code>st_ctime</code> (metadata change time on Linux) with a documented caveat. This is a platform reality, not a bug.</p> <p>The date format string <code>yyyy-MM-ddTHH:mm:ss.fffffffzzz</code> uses .NET formatting tokens. The Python equivalent is <code>%Y-%m-%dT%H:%M:%S.%f%z</code>, noting that Python's <code>%f</code> gives microseconds (6 digits) rather than .NET's 7-digit fractional seconds. For backward compatibility, the port should zero-pad to 7 digits if exact schema match is required, or accept the 6-digit microsecond precision as a minor, acceptable deviation.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#6-exif-embedded-metadata-extraction","title":"6. EXIF / Embedded Metadata Extraction","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_5","title":"What It Does","text":"<p>Invokes the <code>exiftool</code> binary against individual files to extract embedded EXIF/XMP/IPTC metadata. The exiftool arguments are Base64-encoded in the source and decoded at runtime, written to a temporary argument file, and passed to exiftool via its <code>-@</code> (argfile) switch. The raw JSON output from exiftool is piped through <code>jq</code> to compact it and strip unwanted system keys (ExifToolVersion, FileName, FilePath, Directory, FilePermissions, etc.). Certain file types (<code>.csv</code>, <code>.htm</code>, <code>.html</code>, <code>.json</code>, <code>.tsv</code>, <code>.xml</code>) are excluded because exiftool tends to dump their entire content into the metadata output.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_5","title":"Where It Lives (Original)","text":"Function Role <code>GetFileExif</code> Orchestrator: decodes args, manages temp file lifecycle, calls runner <code>GetFileExifArgsWrite</code> Decodes Base64 argument strings via <code>Base64DecodeString</code>, writes them to a temp file via <code>Add-Content</code> <code>GetFileExifRun</code> Executes <code>exiftool -@ $ArgsFile</code> and pipes output through <code>jq -c '.[] \\| .'</code> then a second <code>jq</code> pass to delete unwanted keys <code>Base64DecodeString</code> (external pslib) URL-decodes and Base64-decodes the argument strings with UTF-8 encoding support <code>TempOpen</code> / <code>TempClose</code> (external pslib) Creates and deletes the temporary argument file"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_5","title":"Python Modules","text":"Module Usage <code>subprocess.run()</code> Invoking <code>exiftool</code> with arguments passed directly (no temp file needed) <code>json</code> Parsing exiftool's <code>-json</code> output directly (replaces <code>jq</code> entirely) <code>PyExifTool</code> (third-party, optional) A Python wrapper around exiftool that manages a persistent exiftool process for batch operations; significantly faster for large directory trees"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_5","title":"Improvement Notes","text":"<p>Eliminate jq dependency entirely. The original pipes exiftool output through <code>jq</code> for two purposes: JSON compaction and key deletion. Python's <code>json.loads()</code> handles the parsing natively, and unwanted keys can be removed with a simple dict comprehension: <code>{k: v for k, v in data.items() if k not in EXCLUDED_KEYS}</code>. This eliminates a binary dependency with zero functionality loss.</p> <p>Eliminate the Base64 argument encoding scheme. The original stores exiftool arguments as Base64-encoded strings and decodes them at runtime via <code>Base64DecodeString</code> (which itself has a complex OpsCode-based branching pattern and calls <code>certutil</code> on Windows). This appears to have been a mechanism for safely embedding complex argument strings in the PowerShell source. In Python, we can simply define the arguments as a list of strings and pass them directly to <code>subprocess.run()</code>. This eliminates the entire <code>Base64DecodeString</code> \u2192 <code>TempOpen</code> \u2192 write-args \u2192 <code>TempClose</code> pipeline.</p> <p>Eliminate the temporary argument file. The original writes decoded arguments to a temp <code>.txt</code> file and passes it to exiftool via <code>-@</code>. The Python port should pass arguments directly via <code>subprocess.run(['exiftool', ...args, filepath])</code>. If argument lists are very long, <code>subprocess</code> handles them correctly on all platforms.</p> <p>Consider PyExifTool for batch mode. When indexing large directory trees, the original invokes <code>exiftool</code> once per file (a separate process spawn each time). <code>PyExifTool</code> keeps a single exiftool process alive and communicates with it via stdin/stdout, which is dramatically faster for batch operations. The port should support both modes: direct <code>subprocess</code> invocation for single-file use, and <code>PyExifTool</code> batch mode for directory traversal.</p> <p>The extension exclusion list (<code>.csv</code>, <code>.htm</code>, <code>.html</code>, <code>.json</code>, <code>.tsv</code>, <code>.xml</code>) should be externalized into configuration (see Category 11) rather than hardcoded, so users can customize it.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#7-sidecar-metadata-file-handling","title":"7. Sidecar Metadata File Handling","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_6","title":"What It Does","text":"<p>Discovers, reads, parses, and optionally merges external metadata \"sidecar\" files that live alongside the files they describe. Sidecar files are identified by regex patterns matching known suffixes (defined in <code>$global:MetadataFileParser</code>). Each sidecar file undergoes type detection (matching against the <code>Identify</code> configuration), format-specific reading (JSON, plain text, binary/Base64, subtitles, hash files, URL/LNK shortcuts), and construction of a metadata entry object with source attribution, type, name, name hashes, and data payload. When <code>MetaMerge</code> is active, sidecar metadata is folded into the parent item's <code>Metadata</code> array. When <code>MetaMergeDelete</code> is active, merged sidecar files are queued for deletion after processing.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_6","title":"Where It Lives (Original)","text":"Function Role <code>GetFileMetaSiblings</code> Scans the parent directory for files matching the target basename + known metadata suffixes; uses regex with <code>[System.Text.RegularExpressions.Regex]::Escape()</code> for basename escaping <code>ReadMetaFile</code> Wrapper: calls <code>MetaFileRead</code>, adds name hashes, constructs standardized metadata entry objects <code>MetaFileRead</code> (external pslib) The actual parser: type detection, format-specific readers (<code>ReadJson</code>, <code>ReadText</code>, <code>ReadBinary</code>, <code>ReadText-Hash</code>, <code>ReadText-Subtitles</code>, <code>ReadLink</code>), parent file resolution, SHA256 hashing <code>ReadMetaFile-GetNameHashMD5</code> / <code>-SHA256</code> Hash the sidecar filename for the <code>NameHashes</code> field <code>$global:MetadataFileParser</code> Configuration object defining suffix patterns, exclusion patterns, and type identification rules <code>$global:DeleteQueue</code> Runtime accumulator for sidecar file paths to delete when <code>MetaMergeDelete</code> is active"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_6","title":"Python Modules","text":"Module Usage <code>re</code> Regex pattern matching for sidecar file identification and type detection <code>json</code> Reading JSON-format sidecar files (replaces <code>jq -c '.'</code> piped through <code>ConvertFrom-Json</code>) <code>pathlib</code> Directory scanning for sibling files, basename extraction, suffix matching <code>hashlib</code> Name hashing for sidecar files (shared with Category 3) <code>base64</code> Reading binary sidecar files as Base64-encoded data (replaces <code>certutil -encode</code>)"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_6","title":"Improvement Notes","text":"<p>Eliminate certutil dependency. The original uses <code>certutil -encode</code> to convert binary sidecar file data to Base64 strings. Python's <code>base64.b64encode()</code> does this natively and portably.</p> <p>Simplify type detection. The original iterates through all keys in <code>$MetadataFileParser.Identify</code> and matches each file against regex pattern arrays. This is fine algorithmically but the Python port should express this as a clean mapping structure (a dict of <code>{type_name: [compiled_regex_patterns]}</code>) rather than the deeply nested ordered hashtable structure of the original.</p> <p>The DeleteQueue pattern (accumulate paths during traversal, delete after completion) is sound and should be preserved. In Python this is simply a <code>list[Path]</code> built up during traversal and iterated at the end with <code>Path.unlink()</code>.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#8-output-object-construction-schema","title":"8. Output Object Construction &amp; Schema","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_7","title":"What It Does","text":"<p>Assembles a structured data object (the \"index entry\") for every file and directory processed. Each entry contains identity fields (<code>_id</code>, <code>Ids</code>, <code>NameHashes</code>, <code>ContentHashes</code>), filesystem metadata (<code>Name</code>, <code>BaseName</code>, <code>Extension</code>, <code>StorageName</code>, <code>Size</code>, <code>IsDirectory</code>, <code>IsLink</code>), relationship fields (<code>ParentId</code>, <code>ParentIds</code>, <code>ParentName</code>, <code>ParentNameHashes</code>), timestamps (<code>TimeAccessed/Created/Modified</code>, <code>UnixTimeAccessed/Created/Modified</code>), child items (<code>Items</code> array for directories), and extracted metadata (<code>Metadata</code> array).</p> <p>The original output schema also includes an <code>Encoding</code> key (a complex object describing file encoding properties from BOM detection). This key is being intentionally dropped from the ported software.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_7","title":"Where It Lives (Original)","text":"Function Role <code>MakeObject</code> The core builder. Contains a massive <code>switch</code> on <code>$ObjectType</code> (<code>makeobjectfile</code>, <code>makeobjectdirectory</code>, <code>makeobjectdirectoryrecursive</code>) that constructs <code>[PSCustomObject]@{...}</code> with all schema fields. Repeated near-identically across 5+ switch branches. <code>VariableStringify</code> Null-safe string conversion used before inserting values into the output object <code>GetFileEncoding</code> BOM byte inspection for the <code>Encoding</code> field (being dropped)"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_7","title":"Python Modules","text":"Module Usage <code>dataclasses</code> Define the output schema as <code>@dataclass</code> classes with type annotations; provides <code>asdict()</code> for JSON serialization. Strongly preferred for a project of this scope. <code>pydantic</code> (third-party, optional) Alternative to dataclasses with built-in validation, JSON schema generation, and serialization. More powerful but heavier dependency. Worth considering if schema validation against legacy consumers is important. <code>typing</code> Type annotations for nullable fields, union types, and recursive structures (<code>Items</code> referencing the same schema)"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_7","title":"Improvement Notes","text":"<p>Eliminate the ObjectType switch duplication. The original <code>MakeObject</code> constructs the output object inside a <code>switch</code> statement with 5+ branches (<code>makeobjectfile</code>, <code>makeobjectdirectory</code>, <code>makeobjectdirectoryrecursive</code>, plus <code>default</code> branches). The actual fields are nearly identical across all branches \u2014 the only differences are: directories get <code>Items = @()</code> while files do not, and recursive directories get <code>Items = @()</code> for later population. The Python port should define one <code>IndexEntry</code> dataclass and conditionally populate <code>Items</code> and <code>Metadata</code> based on item type. One class, one construction path.</p> <p>Drop the <code>Encoding</code> key. As specified. The <code>GetFileEncoding</code> sub-function (BOM byte inspection) and all <code>$IEncoding</code> variable assignments are omitted from the port. For backward compatibility, the output schema can include <code>\"Encoding\": null</code> for all items if legacy consumers expect the field to exist. Alternatively, omit it entirely and let legacy consumers handle the missing key. This is a project decision to be made when we address backward compatibility testing.</p> <p>Typed schema definition. The original <code>[PSCustomObject]@{...}</code> has no compile-time type checking. Using Python <code>dataclasses</code> gives us type annotations, IDE support, and <code>dataclasses.asdict()</code> for clean JSON serialization. A rough sketch of the core structure:</p> <pre><code>IndexEntry:\n    _id: str\n    Ids: HashIds            # {MD5: str, SHA256: str, ...}\n    Name: str\n    NameHashes: HashIds | None\n    ContentHashes: HashIds | None\n    Extension: str | None\n    BaseName: str\n    StorageName: str\n    Size: int\n    IsDirectory: bool\n    IsLink: bool\n    ParentId: str | None\n    ParentIds: HashIds | None\n    ParentName: str | None\n    ParentNameHashes: HashIds | None\n    UnixTimeAccessed: int\n    UnixTimeCreated: int\n    UnixTimeModified: int\n    TimeAccessed: str\n    TimeCreated: str\n    TimeModified: str\n    Items: list[IndexEntry] | None   # Recursive reference; None for files\n    Metadata: list[MetadataEntry] | None\n</code></pre> <p>This sketch is illustrative. The actual implementation should be derived from the output schema JSON with adjustments for the dropped <code>Encoding</code> key and expanded hash fields.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#9-json-serialization-output-routing","title":"9. JSON Serialization &amp; Output Routing","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_8","title":"What It Does","text":"<p>Converts the assembled index tree into JSON format and routes it to one or more output destinations. The original supports 7 distinct output scenarios combining three flags: <code>StandardOutput</code> (write to stdout), <code>OutFile</code> (write to a single aggregate file), and <code>OutFileInPlace</code> (write individual <code>_meta.json</code> sidecar files alongside each processed item). The <code>ConvertTo-Json -Depth 100</code> cmdlet is used for serialization, with a documented known issue: extremely large output trees can cause out-of-memory errors.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_8","title":"Where It Lives (Original)","text":"Function Role <code>MakeIndex</code> (top-level output logic) The 7-scenario routing switch at the end of the function; calls <code>ConvertTo-Json -Depth 100</code> and <code>Out-File -Encoding UTF8</code> or writes to stdout <code>MakeDirectoryIndexLogic</code> / <code>MakeDirectoryIndexRecursiveLogic</code> In-place sidecar writing via <code>ConvertTo-Json -Depth 100 \\| Set-Content -LiteralPath $FileMetaPath</code>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_8","title":"Python Modules","text":"Module Usage <code>json</code> Standard library JSON serialization via <code>json.dumps()</code> with <code>indent</code> and <code>ensure_ascii=False</code> for UTF-8 output <code>orjson</code> (third-party, optional) Significantly faster JSON serialization for large trees; outputs bytes directly; handles <code>dataclasses</code> natively <code>sys.stdout</code> Standard output routing <code>pathlib.Path.write_text()</code> Writing JSON to output files and in-place sidecar files"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_8","title":"Improvement Notes","text":"<p>The ConvertTo-Json memory problem does not exist in Python. Python's <code>json.dumps()</code> handles arbitrarily large nested structures without the memory ceiling that plagues PowerShell's <code>ConvertTo-Json</code>. If performance is a concern for very large trees (hundreds of thousands of items), <code>orjson</code> is a drop-in replacement that serializes 5-10x faster and produces bytes directly. The note in the original docstring about \"good luck, take it up with Microsoft\" can be retired.</p> <p>Simplify the output routing model. The original's 7-scenario matrix is confusing. The Python port should express this as three independent boolean flags that compose naturally: <code>--stdout</code>, <code>--outfile PATH</code>, <code>--inplace</code>. Any combination is valid. The routing logic becomes a simple loop over enabled destinations after the index tree is built (or during traversal for in-place writes).</p> <p>Streaming in-place writes. For in-place mode, the original writes each sidecar file as it processes items within the traversal loop. This is correct and should be preserved \u2014 it means partial results are available even if the process is interrupted. The aggregate output file and stdout writes happen after traversal completes, which is also correct.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#10-file-rename-in-place-write-operations","title":"10. File Rename &amp; In-Place Write Operations","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_9","title":"What It Does","text":"<p>When the <code>Rename</code> flag is active, processed files are renamed from their original name to their hash-based <code>StorageName</code> (format: <code>&lt;_id&gt;.&lt;extension&gt;</code>). The original file is destroyed and replaced with the renamed version. A sidecar <code>_meta.json</code> file is written alongside each renamed file. Directory items get <code>_directorymeta.json</code> sidecar files. The <code>Rename</code> flag implies <code>OutFileInPlace</code>.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_9","title":"Where It Lives (Original)","text":"Function Role <code>MakeDirectoryIndexLogic</code> / <code>MakeDirectoryIndexRecursiveLogic</code> Contains the rename-or-not branching logic using <code>Move-Item -LiteralPath -Destination -Force</code> for renames and <code>Set-Content -LiteralPath -Force</code> for sidecar writes <code>MakeIndex</code> (parameter validation) Forces <code>OutFileInPlace = $true</code> when <code>Rename = $true</code> (safety measure)"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_9","title":"Python Modules","text":"Module Usage <code>pathlib.Path.rename()</code> Atomic file rename (same filesystem) <code>shutil.move()</code> Cross-filesystem move if needed (fallback) <code>pathlib.Path.write_text()</code> Writing sidecar <code>_meta.json</code> files"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_9","title":"Improvement Notes","text":"<p>The rename operation is destructive and irreversible in the original. The original docstring includes a \"To-Do\" note about adding a <code>Revert</code> parameter. The Python port should consider implementing revert capability from the start, since the in-place sidecar files contain the original filename in the <code>Name</code> field and can serve as the revert manifest.</p> <p>Safety: MetaMergeDelete guard. The original has a <code>$MMDSafe</code> variable that prevents <code>MetaMergeDelete</code> from activating unless an output mechanism (<code>OutFile</code> or <code>OutFileInPlace</code>) is specified, protecting against accidental metadata file deletion when no output is being captured. This safety logic should be preserved.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#11-configuration-management","title":"11. Configuration Management","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_10","title":"What It Does","text":"<p>Loads and provides access to the parser configuration that governs metadata file behavior: which file suffixes are recognized as sidecar files, which types they map to, which file extensions are excluded from exiftool processing, and the regex patterns used for identification. The original stores this in a large <code>[ordered]@{}</code> hashtable (<code>$global:MetadataFileParser</code>) defined at the script level and promoted to global scope for access by deeply nested sub-functions.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_10","title":"Where It Lives (Original)","text":"Function Role <code>$global:MetadataFileParser</code> (script-level variable, line ~16977) The master configuration object containing <code>.Exiftool.Exclude</code>, <code>.Indexer.Include/Exclude/IncludeString/ExcludeString</code>, <code>.Identify.&lt;Key&gt;</code> sub-objects <code>MakeIndex</code> (parameter block) Copies sub-properties from <code>$MetadataFileParser</code> into global variables (<code>$global:ExiftoolRejectList</code>, <code>$global:MetaSuffixInclude</code>, etc.) at function start; cleans them up via <code>Remove-Variable</code> at function end"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_10","title":"Python Modules","text":"Module Usage <code>dataclasses</code> Define configuration as typed <code>@dataclass</code> objects that can be validated at load time <code>tomllib</code> (Python 3.11+ stdlib) Load configuration from a TOML file; human-readable, well-suited for this kind of structured config <code>pyyaml</code> (third-party, optional) Alternative config format if TOML is insufficient <code>json</code> Alternative config format; the least human-friendly but the most schema-compatible"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_10","title":"Improvement Notes","text":"<p>Eliminate global variable promotion entirely. The original promotes configuration values to <code>$global:</code> scope because PowerShell's nested function scoping makes it difficult to pass data into deeply nested sub-functions cleanly. Python has no such limitation. The configuration object should be instantiated once and passed through the call chain via function parameters, or held on a class instance if using an OOP architecture. No global state needed.</p> <p>Externalize the configuration to a file. The original hardcodes the configuration in the script source. The Python port should load it from an external file (TOML recommended) that ships alongside the tool as a default but can be overridden by the user. This makes the extension exclusion lists, sidecar suffix patterns, and type identification rules user-customizable without modifying source code.</p> <p>Provide sensible defaults. The port should include a built-in default configuration that matches the original's behavior, so the tool works out of the box without requiring a config file. The external config file should only be needed for customization.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#12-logging-verbosity","title":"12. Logging &amp; Verbosity","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_11","title":"What It Does","text":"<p>Provides structured log output with severity levels (info, debug, warning, error, critical, success), caller identification via a colon-delimited call stack string, session IDs, colorized console output, and persistent log file writing. The <code>Vbs</code> function is the single most widely-called function in the entire pslib library \u2014 virtually every other function routes its output through it.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_11","title":"Where It Lives (Original)","text":"Function Role <code>Vbs</code> (external pslib) The terminal logging endpoint. Accepts <code>Caller</code>, <code>Status</code>, <code>Message</code>, <code>Verbosity</code>, <code>LogDir</code>, <code>LibName</code>, <code>VbsSessionID</code>. Writes to log files and optionally to colorized console output. <code>UpdateFunctionStack</code> Maintains the colon-delimited call-stack string (e.g., <code>\"MakeIndex:MakeObject:GetFileExif\"</code>) for the <code>Caller</code> parameter <code>VbsFormatter</code> (inside MetaFileRead) Wrapper that prepends a progress string to messages before passing them to <code>Vbs</code> <code>$LibSessionID</code> / <code>$D_PSLIB_LOGS</code> (global variables) Session identifier (GUID) and log directory path"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_11","title":"Python Modules","text":"Module Usage <code>logging</code> Python's standard logging framework. Supports named loggers (replacing the manual call-stack string), severity levels, file handlers, console handlers with formatting, and session-scoped context via <code>LogRecord</code> attributes or <code>logging.LoggerAdapter</code>. <code>rich</code> (third-party, optional) Colorized console output, progress bars, and structured logging. If the port wants to replicate the colorized console output of <code>Vbs</code>, <code>rich.logging.RichHandler</code> is an excellent drop-in handler."},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_11","title":"Improvement Notes","text":"<p>Eliminate <code>UpdateFunctionStack</code> entirely. The original manually builds a colon-delimited string (<code>\"MakeIndex:MakeObject:GetFileExif\"</code>) and passes it through every function call. Python's <code>logging</code> module automatically captures the call location via <code>%(funcName)s</code>, <code>%(module)s</code>, and <code>%(pathname)s</code> format tokens. For hierarchical logger names, the port should use Python's dotted-name logger convention (e.g., <code>logging.getLogger('indexer.make_object.get_file_exif')</code>). This gives the same traceability with zero manual bookkeeping.</p> <p>Replace the <code>Verbosity</code> boolean with standard log levels. The original has a binary verbosity toggle (<code>$true</code> / <code>$false</code>) that gates console output. Python's <code>logging</code> already supports <code>DEBUG</code>, <code>INFO</code>, <code>WARNING</code>, <code>ERROR</code>, <code>CRITICAL</code> levels, controlled by configuring the handler's level. The CLI can expose <code>--verbose</code> / <code>--debug</code> / <code>--quiet</code> flags that map to log levels.</p> <p>Session IDs are useful for correlating log entries across a single run. The Python port should generate one via <code>uuid.uuid4().hex</code> at startup and inject it into all log records using a <code>logging.Filter</code> or <code>LoggerAdapter</code>.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#13-progress-reporting","title":"13. Progress Reporting","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_12","title":"What It Does","text":"<p>Tracks and reports processing progress during directory traversal: counts total items, computes percentage complete, measures elapsed time, and formats progress strings for log messages.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_12","title":"Where It Lives (Original)","text":"Function Role <code>MakeDirectoryIndexLogic</code> / <code>MakeDirectoryIndexRecursiveLogic</code> Maintains counters (<code>$ChildrenCountProcessed</code>, <code>$ChildrenCountTotal</code>), computes <code>[math]::Round()</code> percentage, formats progress strings like <code>\"[42/100 (42%)]\"</code> <code>MakeIndex</code> (top-level) Captures <code>$TimeStart</code> at the beginning, computes elapsed time at end using <code>(Get-Date) - $TimeStart</code> formatted as <code>H:M:S.ms</code>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_12","title":"Python Modules","text":"Module Usage <code>tqdm</code> (third-party) Progress bars for iterables. Clean, minimal, widely used. Wrap the item iterator in <code>tqdm(items)</code> and progress reporting is automatic. <code>rich.progress</code> (third-party, optional) More visually sophisticated progress bars with elapsed time, ETA, and transfer rate. Pairs naturally with <code>rich</code> logging (see Category 12). <code>time.perf_counter()</code> High-resolution elapsed time measurement (replaces <code>Get-Date</code> arithmetic)"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_12","title":"Improvement Notes","text":"<p>The original manually formats progress strings and injects them into log messages, creating tight coupling between progress tracking and logging. The Python port should separate these concerns: use a progress bar library (<code>tqdm</code> or <code>rich</code>) for user-facing progress display, and use the logging system for structured log output. They can coexist cleanly \u2014 <code>tqdm</code> even has a <code>tqdm.write()</code> method for printing messages without disrupting the progress bar, and <code>rich</code> integrates both natively.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#14-cli-argument-parsing-entry-point","title":"14. CLI Argument Parsing &amp; Entry Point","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_13","title":"What It Does","text":"<p>Accepts user input specifying the target path, output mode, recursion behavior, metadata options, rename flag, ID type, and verbosity level. Validates input combinations (e.g., <code>File</code> and <code>Directory</code> are mutually exclusive; <code>Rename</code> implies <code>OutFileInPlace</code>). Routes execution to the appropriate traversal entry point based on the resolved target type (file, directory flat, directory recursive).</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_13","title":"Where It Lives (Original)","text":"Function Role <code>MakeIndex</code> (Param block) Declares 14 parameters with aliases, types, defaults, and switch behaviors <code>MakeIndex</code> (validation and routing logic) ~200 lines of input validation, mutual exclusion checks, output scenario determination, and <code>TargetTyp</code> (0/1/2) routing"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_13","title":"Python Modules","text":"Module Usage <code>click</code> (third-party) Decorator-based CLI framework. Clean syntax for defining commands, options, arguments, and mutual exclusions. Recommended for new Python CLI tools. <code>argparse</code> (stdlib) Standard library alternative. More verbose but zero dependencies."},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_13","title":"Improvement Notes","text":"<p>The original's parameter validation contains a significant amount of defensive logic to handle conflicting flags (e.g., <code>Recursive</code> with <code>File</code>, <code>StandardOutput</code> with <code>NoStandardOutput</code>). <code>click</code> handles mutual exclusions declaratively, reducing the validation boilerplate. The original's 7 output scenarios can be expressed as three independent <code>--stdout</code> / <code>--outfile</code> / <code>--inplace</code> boolean flags with natural composition rules.</p> <p>The <code>IdType</code> parameter (selecting MD5 vs. SHA256 as the <code>_id</code> field source) should be preserved for backward compatibility. However, since the port will compute all four hash algorithms (see Category 3), this becomes a presentation choice rather than a computation toggle.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#15-temporary-file-management","title":"15. Temporary File Management","text":""},{"location":"porting-reference/MakeIndex_OperationsCatalog/#what-it-does_14","title":"What It Does","text":"<p>Creates and deletes temporary files used as intermediaries during exiftool argument passing and Base64 encoding operations. Temp files use UUID-based naming in a dedicated temp directory.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#where-it-lives-original_14","title":"Where It Lives (Original)","text":"Function Role <code>TempOpen</code> (external pslib) Creates a temp file using UUID+timestamp naming in <code>$D_PSLIB_TEMP</code>; supports type suffixes <code>TempClose</code> (external pslib) Deletes a temp file by path with error suppression <code>MetaFileRead-Temp-Open</code> / <code>MetaFileRead-Temp-Close</code> Duplicated temp file logic inside <code>MetaFileRead</code>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#python-modules_14","title":"Python Modules","text":"Module Usage <code>tempfile</code> <code>tempfile.NamedTemporaryFile()</code> or <code>tempfile.mkstemp()</code> for creating temp files with automatic cleanup. Context manager support ensures cleanup even on exceptions."},{"location":"porting-reference/MakeIndex_OperationsCatalog/#improvement-notes_14","title":"Improvement Notes","text":"<p>This category may be largely unnecessary in the Python port. The primary consumers of temp files in the original are (a) exiftool argument passing (eliminated by passing args directly to <code>subprocess</code>) and (b) <code>certutil</code> Base64 encoding (eliminated by using <code>base64.b64encode()</code>). If no operations remain that require temp files, this entire category can be dropped. If temp files are needed for any future operation, <code>tempfile.NamedTemporaryFile(delete=True)</code> with a context manager provides automatic cleanup that is strictly superior to the manual <code>TempOpen</code>/<code>TempClose</code> pattern.</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#eliminated-dependencies-summary","title":"Eliminated Dependencies Summary","text":"<p>The following original dependencies are not carried forward into the Python port because their functionality is absorbed by Python's standard library or rendered unnecessary by architectural improvements:</p> Original Dependency Reason for Elimination Replaced By <code>jq</code> (binary) JSON parsing and filtering done natively <code>json</code> stdlib <code>certutil</code> (binary) Base64 encoding done natively <code>base64</code> stdlib <code>Base64DecodeString</code> (pslib function) Exiftool args passed directly; no encoding round-trip needed Direct argument lists <code>TempOpen</code> / <code>TempClose</code> (pslib functions) No temp files needed for arg passing or Base64 ops <code>tempfile</code> (if needed at all) <code>Date2UnixTime</code> (pslib function) Timestamp conversion done directly from stat results <code>datetime</code> stdlib <code>Vbs</code> (pslib function) Replaced by Python's logging framework <code>logging</code> stdlib <code>ValidateIsLink</code> (pslib function) Never actually called in the original; dead code (removed) <code>GetFileEncoding</code> (internal sub-function) <code>Encoding</code> key dropped from output schema (removed) <code>UpdateFunctionStack</code> (internal sub-function) Manual call-stack tracking replaced by logging's built-in caller info <code>logging</code> stdlib <code>VariableStringify</code> (internal sub-function) Python's native <code>str()</code> and <code>None</code> handling cover this Built-in <code>str()</code> / <code>repr()</code>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#cross-reference-output-schema-fields-operation-categories","title":"Cross-Reference: Output Schema Fields \u2192 Operation Categories","text":"<p>This table maps every field in the output schema to the operation category that produces it, confirming full coverage.</p> Schema Field Category Notes <code>_id</code> 3 (Hashing) Selected from <code>Ids</code> based on <code>IdType</code> parameter <code>Ids</code> 3 (Hashing) <code>{MD5, SHA1, SHA256, SHA512}</code> \u2014 expanded from original's MD5+SHA256 only <code>Name</code> 2 (Path Manipulation) <code>Path.name</code> <code>NameHashes</code> 3 (Hashing) Hash of the <code>Name</code> string <code>ContentHashes</code> 3 (Hashing) Hash of file contents; <code>null</code> for directories <code>Extension</code> 2 (Path Manipulation) <code>Path.suffix</code> with validation <code>BaseName</code> 2 (Path Manipulation) <code>Path.stem</code> <code>StorageName</code> 3 (Hashing) + 2 (Path) <code>f\"{_id}{extension}\"</code> for files; <code>_id</code> for directories ~~<code>Encoding</code>~~ ~~(Dropped)~~ Intentionally omitted from port <code>Size</code> 1 (Traversal) <code>Path.stat().st_size</code> for files; sum of children for directories <code>IsDirectory</code> 1 (Traversal) <code>Path.is_dir()</code> <code>IsLink</code> 4 (Symlink) <code>Path.is_symlink()</code> <code>ParentId</code> 3 (Hashing) Directory ID of parent <code>ParentIds</code> 3 (Hashing) Hash IDs of parent directory <code>ParentName</code> 2 (Path Manipulation) <code>Path.parent.name</code> <code>ParentNameHashes</code> 3 (Hashing) Hash of parent directory name <code>UnixTimeAccessed</code> 5 (Timestamps) <code>int(stat.st_atime * 1000)</code> <code>UnixTimeCreated</code> 5 (Timestamps) <code>int(stat.st_birthtime * 1000)</code> or <code>st_ctime</code> fallback <code>UnixTimeModified</code> 5 (Timestamps) <code>int(stat.st_mtime * 1000)</code> <code>TimeAccessed</code> 5 (Timestamps) ISO 8601 formatted string <code>TimeCreated</code> 5 (Timestamps) ISO 8601 formatted string <code>TimeModified</code> 5 (Timestamps) ISO 8601 formatted string <code>Items</code> 1 (Traversal) + 8 (Object Construction) Recursive child entries for directories; <code>null</code> for files <code>Metadata</code> 6 (EXIF) + 7 (Sidecar) Array of metadata entries from exiftool and sidecar files"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#minimum-viable-dependency-set","title":"Minimum Viable Dependency Set","text":"<p>For a Python port that achieves full feature parity (minus the intentionally dropped <code>Encoding</code> key) with the original MakeIndex:</p>"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#required-standard-library-only","title":"Required (Standard Library Only)","text":"Module Categories Served <code>pathlib</code> 1, 2, 4, 7, 9, 10 <code>hashlib</code> 3 <code>datetime</code> 5 <code>json</code> 6, 7, 8, 9 <code>subprocess</code> 6 <code>re</code> 7, 11 <code>logging</code> 12 <code>os</code> 1, 5 <code>sys</code> 9 <code>tempfile</code> 15 (if needed) <code>base64</code> 7 <code>dataclasses</code> 8, 11 <code>typing</code> 8 <code>tomllib</code> 11 (Python 3.11+) <code>uuid</code> 12 <code>time</code> 13"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#required-external","title":"Required (External)","text":"Module Categories Served Notes <code>exiftool</code> (binary) 6 Must be in system PATH; the only external binary dependency"},{"location":"porting-reference/MakeIndex_OperationsCatalog/#recommended-third-party-optional","title":"Recommended (Third-Party, Optional)","text":"Module Categories Served Justification <code>click</code> 14 Cleaner CLI definition than <code>argparse</code>; widely adopted <code>tqdm</code> 13 Progress bars with minimal code <code>orjson</code> 9 5-10x faster JSON serialization for large trees <code>PyExifTool</code> 6 Persistent exiftool process for batch performance <code>rich</code> 12, 13 Colorized logging + progress bars in one package; alternative to <code>tqdm</code> + custom log formatting <code>pydantic</code> 8, 11 Schema validation and JSON schema generation; heavier alternative to <code>dataclasses</code>"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/","title":"MetaFileRead \u2014 Dependency Catalog","text":"<p>Source: <code>main.ps1</code>, line 10233 Purpose: Reads and parses metadata sidecar files, determining their type, associated parent file, and internal data content Audience: AI-first, Human-second  </p>"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#1-external-pslib-functions-called","title":"1. External PsLib Functions Called","text":"Function Defined At Called From Purpose <code>Lnk2Path</code> main.ps1:7283 <code>MetaFileRead-Data-ReadLink</code> Resolves a <code>.lnk</code> shortcut file to its target path <code>UrlFile2Url</code> main.ps1:15843 <code>MetaFileRead-Data-ReadLink</code> Extracts the URL from a <code>.url</code> internet shortcut file <code>ValidateIsFile</code> main.ps1:16098 Top-level body Validates that the input string references an existing file. Returns a boolean <code>ValidateIsJson</code> main.ps1:16189 <code>MetaFileRead-Data</code> Validates whether a file contains valid JSON. Returns a boolean <code>Vbs</code> main.ps1:16412 Throughout (via <code>VbsFormatter</code> wrapper) Verbose/logging output handler. Called indirectly through the internal <code>VbsFormatter</code> wrapper, which auto-formats messages with progress strings when available"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#implicit-external-dependency-globalmetadatafileparser","title":"Implicit External Dependency: <code>$global:MetadataFileParser</code>","text":"<p>This function receives the <code>$global:MetadataFileParser</code> configuration object as both a parameter default and a passed-through argument to multiple sub-functions. The <code>MetadataFileParser</code> object (defined at main.ps1:16977) governs all type-detection regex patterns, file-extension classification rules, and indexer include/exclude patterns. Without this object being populated at runtime, the function cannot detect meta file types or validate input files.</p>"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#2-external-variables-loaded","title":"2. External Variables Loaded","text":"Variable Defined At Type Description <code>$global:MetadataFileParser</code> main.ps1:16977 <code>[ordered]@{}</code> (Hashtable) Large configuration object governing metadata file parsing behavior. Consumed sub-properties include:<code>.Indexer.IncludeString</code> \u2014 Regex string used to validate that the input file qualifies as a metadata file<code>.Identify.&lt;Key&gt;</code> \u2014 Sub-objects mapping metadata file types (Description, GenericMetadata, Hash, JsonMetadata, Link, Screenshot, Subtitles, Thumbnail, Torrent) to their regex detection patterns"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#3-external-binaries-executables-invoked","title":"3. External Binaries / Executables Invoked","text":"Binary Called From (within MetaFileRead) How Invoked Purpose <code>certutil</code> <code>MetaFileRead-Data-Base64Encode</code> <code>certutil -encode \"$FilePath\" \"$TempFile\" &gt; $null</code> Encodes binary file data to Base64 (used for Screenshot, Thumbnail, Torrent, and binary fallback data) <code>jq</code> <code>MetaFileRead-Data-ReadJson</code> <code>jq -c '.' \"$FilePath\" 2&gt; $null</code> Reads and compacts JSON data from metadata files. Output is piped through <code>ConvertFrom-Json</code>"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#note-on-binary-resolution","title":"Note on Binary Resolution","text":"<p>Neither <code>certutil</code> nor <code>jq</code> are referenced via absolute paths. <code>certutil</code> is a Windows system utility and is expected to be available in the system PATH. <code>jq</code> must also be available in the system PATH. The <code>jq</code> dependency is shared with the <code>MakeIndex</code> function which also uses <code>jq</code> for JSON processing.</p>"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#4-parameters","title":"4. Parameters","text":"Parameter Type Alias(es) Default Description <code>File</code> <code>[System.String]</code> <code>inputfile</code> (none) The absolute path to the metadata file to read <code>Format</code> <code>[System.String]</code> (none) <code>'json'</code> Output format. ValidatePattern: <code>^(json|object|text)$</code> <code>ProgressString</code> <code>[System.String]</code> (none) (none) Optional progress prefix string prepended to verbose messages by the <code>VbsFormatter</code> wrapper <code>Verbosity</code> <code>[System.Boolean]</code> <code>v</code> <code>$false</code> Controls whether verbose/log messages are printed to the console <code>$global:MetadataFileParser</code> <code>[System.Object]</code> (none) <code>$global:MetadataFileParser</code> Internal parameter: the metadata parser configuration object passed through from the global scope"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#5-internal-sub-functions-defined-within-metafileread","title":"5. Internal Sub-Functions (Defined Within MetaFileRead)","text":""},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#top-level-internal-functions","title":"Top-Level Internal Functions","text":"Function Purpose Calls (internal) Calls (external) <code>MetaFileRead-Data</code> Dispatcher: reads the internal data of a meta file based on its detected type. Routes to type-specific reader sub-functions <code>MetaFileRead-Data-Base64Encode</code>, <code>MetaFileRead-Data-IsText</code>, <code>MetaFileRead-Data-ReadBinary</code>, <code>MetaFileRead-Data-ReadJson</code>, <code>MetaFileRead-Data-ReadLink</code>, <code>MetaFileRead-Data-ReadText</code>, <code>MetaFileRead-Data-ReadText-Hash</code>, <code>MetaFileRead-Data-ReadText-Subtitles</code> <code>ValidateIsJson</code>, <code>VbsFormatter</code> <code>MetaFileRead-Detect</code> Iterates through <code>$MetadataFileParser.Identify</code> keys and matches the input file name against regex patterns to determine the meta file type \u2014 \u2014 <code>MetaFileRead-Parent</code> Determines the parent file/directory associated with a given meta file by analyzing sibling files in the same directory <code>MetaFileRead-Parent-Base</code>, <code>MetaFileRead-Parent-Keys-Orphan</code>, <code>MetaFileRead-Parent-Keys-Directory</code>, <code>MetaFileRead-Parent-Keys-File</code>, <code>MetaFileRead-Parent-List-Audio</code>, <code>MetaFileRead-Parent-List-Image</code>, <code>MetaFileRead-Parent-List-Other</code>, <code>MetaFileRead-Parent-List-Video</code> <code>VbsFormatter</code> <code>MetaFileRead-Sha256-File</code> Computes SHA256 hash of a file's contents (used for the <code>_id</code> field) \u2014 <code>VbsFormatter</code> <code>MetaFileRead-Sha256-String</code> Computes SHA256 hash of a string (used for <code>NameHash</code> fields) \u2014 <code>VbsFormatter</code> <code>MetaFileRead-Temp-Close</code> Deletes a temporary file by path \u2014 <code>VbsFormatter</code> <code>MetaFileRead-Temp-Open</code> Creates a temporary file in <code>$D_PSLIB_TEMP</code> and returns its path. Uses UUID+timestamp naming \u2014 \u2014 <code>VbsFormatter</code> Internal wrapper around the external <code>Vbs</code> function. Auto-prepends the <code>$ProgressString</code> to log messages when present \u2014 <code>Vbs</code>"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#nested-internal-functions-defined-inside-other-internal-functions","title":"Nested Internal Functions (defined inside other internal functions)","text":"Function Parent Function Purpose <code>MetaFileRead-Data-Base64Encode</code> <code>MetaFileRead-Data</code> Encodes file data to Base64 using <code>certutil</code>. Creates and cleans up a temp file <code>MetaFileRead-Data-IsText</code> <code>MetaFileRead-Data</code> Tests whether a file contains valid text by attempting <code>Get-Content -Raw</code> in a try/catch <code>MetaFileRead-Data-ReadBinary</code> <code>MetaFileRead-Data</code> Reads binary file data by delegating to <code>MetaFileRead-Data-Base64Encode</code> <code>MetaFileRead-Data-ReadJson</code> <code>MetaFileRead-Data</code> Reads JSON file data using <code>jq -c '.'</code> piped through <code>ConvertFrom-Json</code> <code>MetaFileRead-Data-ReadLink</code> <code>MetaFileRead-Data</code> Reads <code>.url</code> files via <code>UrlFile2Url</code> or <code>.lnk</code> files via <code>Lnk2Path</code> <code>MetaFileRead-Data-ReadText</code> <code>MetaFileRead-Data</code> Reads file as UTF8 text via <code>[System.IO.File]::ReadAllText()</code> <code>MetaFileRead-Data-ReadText-Hash</code> <code>MetaFileRead-Data</code> Reads hash files as text lines via <code>Get-Content</code>, filtering out empty lines <code>MetaFileRead-Data-ReadText-Subtitles</code> <code>MetaFileRead-Data</code> Reads subtitle files as text lines via <code>Get-Content</code>, filtering out empty lines <code>MetaFileRead-Parent-Base</code> <code>MetaFileRead-Parent</code> Strips the metadata suffix from the meta file name to derive the base parent file name. Uses single-pass or multi-pass regex replacement depending on the meta type <code>MetaFileRead-Parent-Keys-Orphan</code> <code>MetaFileRead-Parent</code> Returns a PSCustomObject with orphan parent properties (Name=null, Type=\"orphan\", Exists=$false) <code>MetaFileRead-Parent-Keys-Directory</code> <code>MetaFileRead-Parent</code> Returns a PSCustomObject with directory parent properties <code>MetaFileRead-Parent-Keys-File</code> <code>MetaFileRead-Parent</code> Returns a PSCustomObject with file parent properties <code>MetaFileRead-Parent-List-Audio</code> <code>MetaFileRead-Parent</code> Filters directory matches to audio file extensions <code>MetaFileRead-Parent-List-Image</code> <code>MetaFileRead-Parent</code> Filters directory matches to image file extensions <code>MetaFileRead-Parent-List-Other</code> <code>MetaFileRead-Parent</code> Filters directory matches to other file extensions <code>MetaFileRead-Parent-List-Video</code> <code>MetaFileRead-Parent</code> Filters directory matches to video file extensions"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#6-internal-logic-summary","title":"6. Internal Logic Summary","text":"<p>Processing Pipeline:</p> <ol> <li> <p>Input Validation: The input file path is checked for non-empty string and existence via <code>ValidateIsFile</code>. The file is then matched against <code>$global:MetadataFileParser.Indexer.IncludeString</code> to confirm it qualifies as a metadata file.</p> </li> <li> <p>Type Detection: The <code>MetaFileRead-Detect</code> function iterates through all keys in <code>$MetadataFileParser.Identify</code> and matches the file name against each type's regex pattern array. A single match is expected; zero or multiple matches produce an error and an empty output.</p> </li> <li> <p>Parent Resolution: The <code>MetaFileRead-Parent</code> function determines which file or directory the metadata file is associated with. It strips the metadata suffix from the file name to produce a \"base\" string, then scans sibling entries in the same directory for matches. Matches are classified by media type (audio, image, video, other) and the parent is assigned based on the meta file type's prioritization rules (e.g., Description files prioritize video parents; Subtitles prioritize video then audio). Unmatched meta files are classified as orphans.</p> </li> <li> <p>Data Reading: The <code>MetaFileRead-Data</code> function dispatches to a type-specific reader based on the detected meta type. Text-based types are tested with both JSON and text validation; binary types (Screenshot, Thumbnail, Torrent) are Base64-encoded via <code>certutil</code>. Link types are resolved to their target paths.</p> </li> <li> <p>Output Assembly: The final output object is constructed with <code>_id</code> (SHA256 of file contents), <code>Name</code>, <code>NameHash</code>, <code>Path</code>, <code>Type</code>, <code>Parent</code> (sub-object), and <code>Data</code> fields. Output is formatted as JSON, object, or text based on the <code>-Format</code> parameter.</p> </li> </ol> <p>Recognized Meta File Types:</p> Type Data Handling <code>Description</code> JSON \u2192 text \u2192 binary fallback chain <code>GenericMetadata</code> JSON \u2192 text \u2192 binary fallback chain <code>Hash</code> Read as text lines (single-line expected) <code>JsonMetadata</code> Read directly as JSON via <code>jq</code> <code>Link</code> Resolve <code>.url</code> via <code>UrlFile2Url</code> or <code>.lnk</code> via <code>Lnk2Path</code> <code>Screenshot</code> Base64-encode binary data <code>Subtitles</code> JSON \u2192 text \u2192 binary fallback chain <code>Thumbnail</code> Base64-encode binary data <code>Torrent</code> Base64-encode binary data"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#7-output-object-properties","title":"7. Output Object Properties","text":"<p>The full <code>[PSCustomObject]</code> (returned when <code>-Format \"object\"</code> is specified) contains:</p> Property Type Description <code>_id</code> <code>[String]</code> SHA256 hash of the meta file's contents <code>Name</code> <code>[String]</code> The file name of the meta file <code>NameHash</code> <code>[String]</code> SHA256 hash of the file name string <code>Path</code> <code>[String]</code> Absolute path to the meta file <code>Type</code> <code>[String]</code> The detected meta file type (e.g., <code>Description</code>, <code>JsonMetadata</code>) <code>Parent</code> <code>[PSCustomObject]</code> Sub-object describing the associated parent. Properties: <code>Base</code>, <code>Name</code>, <code>NameHash</code>, <code>Path</code>, <code>Type</code> (\"file\"/\"orphan\"/\"directory\"), <code>Extension</code>, <code>Exists</code>, <code>PossibleMatches</code> <code>Data</code> <code>[Object]</code> The parsed internal data of the meta file. Type varies: string, PSCustomObject (from JSON), array of lines, Base64 string, or <code>$null</code>"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#8-net-types-and-methods-used","title":"8. .NET Types and Methods Used","text":"Type / Method Usage <code>[System.IO.File]::OpenRead()</code> File content hashing for <code>_id</code> generation <code>[System.IO.File]::ReadAllText()</code> Reading text-based meta file contents (UTF8) <code>[System.IO.Path]::GetDirectoryName()</code> Extracting parent directory path from meta file path <code>[System.IO.Path]::GetFileName()</code> Extracting file name from path <code>[System.Security.Cryptography.SHA256]::Create()</code> SHA256 hash computation (for <code>_id</code> and <code>NameHash</code>) <code>[System.Text.Encoding]::UTF8</code> Encoding constant for string-to-bytes conversion and file reading <code>[BitConverter]::ToString()</code> Byte-array \u2192 hex-string conversion <code>[System.GUID]::NewGuid()</code> UUID generation for temp file names <code>[DateTimeOffset]::Now.ToUnixTimeMilliseconds()</code> Timestamp component in temp file names <code>[Regex]::Escape()</code> Escaping base name strings for regex matching <code>[PSCustomObject]@{}</code> Output object and parent object construction"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#9-powershell-built-in-cmdlets-used","title":"9. PowerShell Built-in Cmdlets Used","text":"Cmdlet Usage Context <code>Add-Content</code> (Not directly used, but <code>certutil</code> writes to the temp file) <code>ConvertFrom-Json</code> Parsing <code>jq</code> output into PowerShell objects <code>ConvertTo-Json</code> Serializing final output when <code>-Format \"json\"</code> (<code>-Depth 100</code>) <code>Get-ChildItem</code> Listing directory contents to find sibling files for parent resolution (<code>-LiteralPath</code>, <code>-Force</code>) <code>Get-Content</code> Reading text-based meta file data (<code>-LiteralPath</code>, <code>-Encoding \"UTF8\"</code>, <code>-Raw</code>) <code>Get-Item</code> Retrieving file/directory properties (Name, Extension, FullName, PSIsContainer) (<code>-LiteralPath</code>, <code>-Force</code>) <code>New-Item</code> Creating temporary files (<code>-ItemType File</code>, <code>-Force</code>) <code>Remove-Item</code> Deleting temporary files (<code>-LiteralPath</code>, <code>-Force</code>) <code>Resolve-Path</code> Resolving file paths to absolute form (<code>-LiteralPath</code>) <code>Select-Object</code> Skipping certutil header/footer lines (<code>-Skip 1</code>, <code>-SkipLast 1</code>) <code>Set-Content</code> (Not used directly in MetaFileRead but available in the broader pipeline) <code>Test-Path</code> Validating file/directory existence (<code>-LiteralPath</code>, <code>-PathType Leaf/Container</code>) <code>Where-Object</code> Filtering empty lines from file contents; filtering directory matches by name"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#10-return-value","title":"10. Return Value","text":"<p>With <code>-Format \"json\"</code> (default): Returns a JSON-formatted string of the full output object.</p> <p>With <code>-Format \"object\"</code>: Returns the <code>[PSCustomObject]</code> described in Section 7.</p> <p>With <code>-Format \"text\"</code>: Returns only the <code>Type</code> property as a string.</p> <p>Returns <code>$null</code> if the input file is empty, does not exist, or does not validate as a meta file.</p> <p>Returns an empty object (<code>'{}'</code> for JSON, <code>[PSCustomObject]@{}</code> for object, <code>'null'</code> for text) if type detection fails (zero or multiple type matches).</p>"},{"location":"porting-reference/MetaFileRead_DependencyCatalog/#11-call-graph","title":"11. Call Graph","text":"<pre><code>MetaFileRead\n\u251c\u2500\u2500 [validates File parameter is non-empty]\n\u2502   \u2514\u2500\u2500 VbsFormatter \u2192 Vbs \u25c4\u2500\u2500 external pslib\n\u251c\u2500\u2500 ValidateIsFile \u25c4\u2500\u2500 external pslib\n\u251c\u2500\u2500 [matches against MetadataFileParser.Indexer.IncludeString]\n\u251c\u2500\u2500 MetaFileRead-Detect (type detection via MetadataFileParser.Identify)\n\u251c\u2500\u2500 MetaFileRead-Parent (parent resolution)\n\u2502   \u251c\u2500\u2500 MetaFileRead-Parent-Base (strip suffix)\n\u2502   \u251c\u2500\u2500 Get-ChildItem (list siblings)\n\u2502   \u251c\u2500\u2500 MetaFileRead-Parent-List-Audio/Image/Other/Video (classify matches)\n\u2502   \u2514\u2500\u2500 MetaFileRead-Parent-Keys-File / -Directory / -Orphan (build parent object)\n\u2502       \u2514\u2500\u2500 MetaFileRead-Sha256-String (hash parent name)\n\u251c\u2500\u2500 MetaFileRead-Data (data reading)\n\u2502   \u251c\u2500\u2500 ValidateIsJson \u25c4\u2500\u2500 external pslib\n\u2502   \u251c\u2500\u2500 MetaFileRead-Data-IsText\n\u2502   \u251c\u2500\u2500 MetaFileRead-Data-ReadJson \u2192 jq \u25c4\u2500\u2500 BINARY\n\u2502   \u251c\u2500\u2500 MetaFileRead-Data-ReadText\n\u2502   \u251c\u2500\u2500 MetaFileRead-Data-ReadText-Hash\n\u2502   \u251c\u2500\u2500 MetaFileRead-Data-ReadText-Subtitles\n\u2502   \u251c\u2500\u2500 MetaFileRead-Data-ReadBinary\n\u2502   \u2502   \u2514\u2500\u2500 MetaFileRead-Data-Base64Encode \u2192 certutil \u25c4\u2500\u2500 BINARY\n\u2502   \u2502       \u251c\u2500\u2500 MetaFileRead-Temp-Open\n\u2502   \u2502       \u2514\u2500\u2500 MetaFileRead-Temp-Close\n\u2502   \u2514\u2500\u2500 MetaFileRead-Data-ReadLink\n\u2502       \u251c\u2500\u2500 UrlFile2Url \u25c4\u2500\u2500 external pslib\n\u2502       \u2514\u2500\u2500 Lnk2Path \u25c4\u2500\u2500 external pslib\n\u251c\u2500\u2500 MetaFileRead-Sha256-String (hash file name \u2192 NameHash)\n\u251c\u2500\u2500 MetaFileRead-Sha256-File (hash file contents \u2192 _id)\n\u2514\u2500\u2500 [format output based on -Format parameter]\n</code></pre>"},{"location":"porting-reference/TempClose_DependencyCatalog/","title":"TempClose \u2014 Dependency Catalog","text":"<p>Source: <code>main.ps1</code>, line 15044 Purpose: Deletes a specified temporary file, or optionally purges all temp files from the pslib temp directory Audience: AI-first, Human-second  </p>"},{"location":"porting-reference/TempClose_DependencyCatalog/#1-external-pslib-functions-called","title":"1. External PsLib Functions Called","text":"Function Defined At Called From Purpose <code>Vbs</code> main.ps1:16412 Top-level body Verbose/logging output handler. Called with <code>-Caller</code>, <code>-Status</code> (i/e/w), <code>-Message</code>, <code>-Verbosity</code> for info, error, and warning logging"},{"location":"porting-reference/TempClose_DependencyCatalog/#2-external-variables-loaded","title":"2. External Variables Loaded","text":"Variable Defined At Type Description <code>$D_PSLIB_TEMP</code> main.ps1:17400 <code>[System.String]</code> The absolute path to the pslib temporary file directory (<code>C:\\bin\\pslib\\temp</code>). Used when <code>-ForceAll</code> is <code>$true</code> to enumerate and delete all temp files in the directory"},{"location":"porting-reference/TempClose_DependencyCatalog/#3-external-binaries-executables-invoked","title":"3. External Binaries / Executables Invoked","text":"Binary Notes (none) This function is entirely PowerShell-based and does not invoke any external executables."},{"location":"porting-reference/TempClose_DependencyCatalog/#4-parameters","title":"4. Parameters","text":"Parameter Type Alias(es) Default Description <code>Target</code> <code>[System.String]</code> <code>f</code>, <code>fil</code>, <code>i</code>, <code>in</code>, <code>input</code>, <code>t</code>, <code>tmp</code>, <code>temp</code> <code>$null</code> The absolute path to the temporary file to delete <code>ForceAll</code> <code>[System.Boolean]</code> <code>force</code> <code>$false</code> If <code>$true</code>, ignores the <code>-Target</code> parameter and deletes all files in <code>$D_PSLIB_TEMP</code> recursively <code>Verbosity</code> <code>[System.Boolean]</code> <code>v</code> <code>$false</code> Controls whether verbose/log messages are printed to the console"},{"location":"porting-reference/TempClose_DependencyCatalog/#5-internal-sub-functions","title":"5. Internal Sub-Functions","text":"<p>This function defines no internal sub-functions.</p>"},{"location":"porting-reference/TempClose_DependencyCatalog/#6-internal-logic-summary","title":"6. Internal Logic Summary","text":"<p>The function operates in one of three modes based on the parameter values:</p> <p>Mode 1 \u2014 ForceAll (<code>-ForceAll $true</code>): Ignores the <code>-Target</code> parameter entirely. Enumerates all files in <code>$D_PSLIB_TEMP</code> recursively via <code>Get-ChildItem</code> with <code>-Filter \"*.*\"</code>. If files are found, each is deleted via <code>Remove-Item -Force</code>. If no files exist, an informational message is logged and the function returns.</p> <p>Mode 2 \u2014 Single Target Deletion (default): If <code>-Target</code> is provided and the file exists, it is deleted via <code>Remove-Item -LiteralPath -Force</code>.</p> <p>Mode 3 \u2014 Error States: If <code>-ForceAll</code> is <code>$false</code> and <code>-Target</code> is <code>$null</code>, an error message is logged. If <code>-Target</code> is provided but the file does not exist, a warning message is logged (but the function does not throw an error).</p>"},{"location":"porting-reference/TempClose_DependencyCatalog/#7-net-types-and-methods-used","title":"7. .NET Types and Methods Used","text":"Type / Method Usage (none) This function uses only PowerShell cmdlets; no .NET types are directly invoked."},{"location":"porting-reference/TempClose_DependencyCatalog/#8-powershell-built-in-cmdlets-used","title":"8. PowerShell Built-in Cmdlets Used","text":"Cmdlet Usage Context <code>Get-ChildItem</code> Enumerating temp files when <code>-ForceAll</code> is active (<code>-LiteralPath</code>, <code>-Filter \"*.*\"</code>, <code>-Recurse</code>, <code>-Force</code>) <code>Remove-Item</code> Deleting temp files (<code>-LiteralPath</code>, <code>-Force</code>) <code>Test-Path</code> Validating target file existence before deletion (<code>-LiteralPath</code>, <code>-PathType Leaf</code>)"},{"location":"porting-reference/TempClose_DependencyCatalog/#9-return-value","title":"9. Return Value","text":"<p>This function does not return a value. All code paths terminate with <code>return</code> (no value).</p>"},{"location":"porting-reference/TempClose_DependencyCatalog/#10-companion-function-tempopen","title":"10. Companion Function: TempOpen","text":"<p><code>TempClose</code> is designed to be used in conjunction with <code>TempOpen</code> (main.ps1:15119). The expected usage pattern is:</p> <pre><code>$MyTempFile = (TempOpen -Type json -Name \"myProject\")\n# ... use $MyTempFile ...\nTempClose -Target $MyTempFile\n</code></pre> <p>The <code>TempOpen</code> docstring explicitly warns that failing to call <code>TempClose</code> will leave orphaned temp files in the pslib temp directory. The <code>-ForceAll</code> mode provides a way to clean up all orphaned files at once.</p>"},{"location":"porting-reference/TempClose_DependencyCatalog/#11-call-graph","title":"11. Call Graph","text":"<pre><code>TempClose\n\u251c\u2500\u2500 (ForceAll=$true)\n\u2502   \u251c\u2500\u2500 Get-ChildItem on $D_PSLIB_TEMP\n\u2502   \u251c\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (info: count or \"nothing to do\")\n\u2502   \u2514\u2500\u2500 foreach file \u2192 Remove-Item\n\u2502       \u2514\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (info: \"Closing temp file\")\n\u251c\u2500\u2500 (ForceAll=$false, Target=$null)\n\u2502   \u2514\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (error: \"No input detected\")\n\u251c\u2500\u2500 (ForceAll=$false, Target does not exist)\n\u2502   \u2514\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (warning: \"File not found\")\n\u2514\u2500\u2500 (ForceAll=$false, Target exists)\n    \u251c\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (info: \"Closing referenced temp file\")\n    \u2514\u2500\u2500 Remove-Item\n</code></pre>"},{"location":"porting-reference/TempOpen_DependencyCatalog/","title":"TempOpen \u2014 Dependency Catalog","text":"<p>Source: <code>main.ps1</code>, line 15119 Purpose: Creates a new temporary file in the pslib temp directory with a UUID-based name and returns the absolute path to it Audience: AI-first, Human-second  </p>"},{"location":"porting-reference/TempOpen_DependencyCatalog/#1-external-pslib-functions-called","title":"1. External PsLib Functions Called","text":"Function Defined At Called From Purpose <code>Vbs</code> main.ps1:16412 Top-level body Verbose/logging output handler. Called with <code>-Caller</code>, <code>-Status</code> (i), <code>-Message</code>, <code>-Verbosity</code> to log the creation of the temp file"},{"location":"porting-reference/TempOpen_DependencyCatalog/#2-external-variables-loaded","title":"2. External Variables Loaded","text":"Variable Defined At Type Description <code>$D_PSLIB_TEMP</code> main.ps1:17400 <code>[System.String]</code> The absolute path to the pslib temporary file directory (<code>C:\\bin\\pslib\\temp</code>). Used as the base directory for all temp file creation <code>$Sep</code> main.ps1:17383 <code>[System.Char]</code> Directory separator character (<code>[System.IO.Path]::DirectorySeparatorChar</code>). Used to construct the full temp file path"},{"location":"porting-reference/TempOpen_DependencyCatalog/#3-external-binaries-executables-invoked","title":"3. External Binaries / Executables Invoked","text":"Binary Notes (none) This function is entirely PowerShell/.NET-based and does not invoke any external executables."},{"location":"porting-reference/TempOpen_DependencyCatalog/#4-parameters","title":"4. Parameters","text":"Parameter Type Alias(es) Default Description <code>Type</code> <code>[System.String]</code> <code>t</code>, <code>TempType</code> <code>'tmp'</code> The file extension for the new temp file. Leading dots are stripped automatically <code>Name</code> <code>[System.String]</code> <code>n</code>, <code>TempName</code> <code>'x'</code> A descriptive prefix substring embedded in the temp file name for identification <code>PathOnly</code> <code>[System.Boolean]</code> <code>p</code> <code>$false</code> If <code>$true</code>, returns the computed file path without actually creating the file <code>Verbosity</code> <code>[System.Boolean]</code> <code>v</code> <code>$false</code> Controls whether verbose/log messages are printed to the console"},{"location":"porting-reference/TempOpen_DependencyCatalog/#5-internal-sub-functions","title":"5. Internal Sub-Functions","text":"<p>This function defines no internal sub-functions.</p>"},{"location":"porting-reference/TempOpen_DependencyCatalog/#6-internal-logic-summary","title":"6. Internal Logic Summary","text":"<p>File Name Generation:</p> <p>The temp file name is constructed using the following template:</p> <pre><code>.{UUID}-{Name}-{UnixTimeMs}.{Type}\n</code></pre> <p>Where: - Leading dot (<code>.</code>) makes the file hidden on Unix-like systems - <code>{UUID}</code> is a GUID with hyphens removed (<code>[System.GUID]::NewGuid().ToString().Replace('-','')</code>) - <code>{Name}</code> is the user-specified descriptive prefix (default: <code>\"x\"</code>) - <code>{UnixTimeMs}</code> is the current Unix time in milliseconds - <code>{Type}</code> is the file extension (default: <code>\"tmp\"</code>)</p> <p>Historical Note: The function was updated on 2024-10-27 to use UUIDs instead of Unix timestamps as the primary uniqueness component, due to an actual name collision that occurred during concurrent script executions.</p> <p>Path Construction:</p> <p>The full path is: <code>$D_PSLIB_TEMP</code> + <code>$Sep</code> + file name</p> <p>File Creation:</p> <p>Unless <code>-PathOnly</code> is <code>$true</code>, the file is created via <code>New-Item -ItemType File -Force</code>. The output of <code>New-Item</code> is suppressed via <code>| Out-Null</code>.</p>"},{"location":"porting-reference/TempOpen_DependencyCatalog/#7-net-types-and-methods-used","title":"7. .NET Types and Methods Used","text":"Type / Method Usage <code>[System.GUID]::NewGuid()</code> Generating UUID for temp file name uniqueness <code>[DateTimeOffset]::Now.ToUnixTimeMilliseconds()</code> Generating timestamp component for temp file name"},{"location":"porting-reference/TempOpen_DependencyCatalog/#8-powershell-built-in-cmdlets-used","title":"8. PowerShell Built-in Cmdlets Used","text":"Cmdlet Usage Context <code>New-Item</code> Creating the temp file (<code>-ItemType File</code>, <code>-Force</code>, <code>-Path</code>) <code>Select-Object</code> Extracting <code>$PWD</code> path (<code>-Expand Path</code>) \u2014 though <code>$HereNow</code> is computed but unused in this function"},{"location":"porting-reference/TempOpen_DependencyCatalog/#9-return-value","title":"9. Return Value","text":"<p>Returns a <code>[System.String]</code> containing the absolute path to the newly created (or hypothetical, if <code>-PathOnly</code>) temporary file.</p>"},{"location":"porting-reference/TempOpen_DependencyCatalog/#10-companion-function-tempclose","title":"10. Companion Function: TempClose","text":"<p><code>TempOpen</code> is designed to be used in conjunction with <code>TempClose</code> (main.ps1:15044). The expected usage pattern is:</p> <pre><code>$MyTempFile = (TempOpen -Type json -Name \"myProject\")\n# ... use $MyTempFile ...\nTempClose -Target $MyTempFile\n</code></pre> <p>The docstring explicitly warns that failing to call <code>TempClose</code> will leave orphaned temp files in the pslib temp directory.</p>"},{"location":"porting-reference/TempOpen_DependencyCatalog/#11-call-graph","title":"11. Call Graph","text":"<pre><code>TempOpen\n\u251c\u2500\u2500 [validates and normalizes Type parameter]\n\u251c\u2500\u2500 [validates and normalizes Name parameter]\n\u251c\u2500\u2500 [generates UUID and timestamp]\n\u251c\u2500\u2500 [constructs file name and full path]\n\u251c\u2500\u2500 (PathOnly=$false) \u2192 New-Item (create file)\n\u2502   \u2514\u2500\u2500 Vbs \u25c4\u2500\u2500 external pslib (info: \"Creating new temp file\")\n\u2514\u2500\u2500 return file path string\n</code></pre>"},{"location":"porting-reference/Vbs_DependencyCatalog/","title":"Vbs \u2014 Dependency Catalog","text":"<p>Source: <code>main.ps1</code>, line 16412 Purpose: Structured logging and colorized verbosity output handler used throughout the pslib library as the centralized logging facility Audience: AI-first, Human-second  </p>"},{"location":"porting-reference/Vbs_DependencyCatalog/#1-external-pslib-functions-called","title":"1. External PsLib Functions Called","text":"Function Defined At Called From Purpose (none) \u2014 \u2014 <code>Vbs</code> is a leaf-level function in the pslib dependency graph. It does not call any other pslib functions. It is the terminal logging endpoint that virtually every other pslib function routes its verbose and log output through."},{"location":"porting-reference/Vbs_DependencyCatalog/#role-in-the-library","title":"Role in the Library","text":"<p><code>Vbs</code> is the most widely-called function in the pslib library. It serves as the universal logging handler and is invoked by every function cataloged in this project (Base64DecodeString, Date2UnixTime, DirectoryId, FileId, MetaFileRead, TempOpen, TempClose) as well as by MakeIndex and its sub-functions. It has zero upstream pslib dependencies, making it the foundational infrastructure function of the library.</p>"},{"location":"porting-reference/Vbs_DependencyCatalog/#2-external-variables-loaded","title":"2. External Variables Loaded","text":"Variable Defined At Type Description <code>$D_PSLIB_LOGS</code> main.ps1:17399 <code>[System.String]</code> The absolute path to the pslib log directory (<code>C:\\bin\\pslib\\logs</code>). Used as the default value for the <code>-LogDir</code> parameter. Log files are written to this directory <code>$LibSessionID</code> main.ps1:17387 <code>[System.String]</code> A GUID (hyphens removed) generated once at script load time. Used as the default value for the <code>-VbsSessionID</code> parameter. Embedded in every log entry to identify the session"},{"location":"porting-reference/Vbs_DependencyCatalog/#3-external-binaries-executables-invoked","title":"3. External Binaries / Executables Invoked","text":"Binary Notes (none) This function is entirely PowerShell/.NET-based and does not invoke any external executables."},{"location":"porting-reference/Vbs_DependencyCatalog/#4-parameters","title":"4. Parameters","text":"Parameter Type Alias(es) Default Description <code>Message</code> <code>[System.String]</code> (none) (none) The log message body. Defaults to <code>'...'</code> if empty <code>Caller</code> <code>[System.String]</code> (none) (none) The name of the calling function or colon-delimited call stack (e.g., <code>\"MakeIndex:MakeObject:GetFileExif\"</code>) <code>Status</code> <code>[System.String]</code> (none) (none) The severity level of the message. Accepted values (case-insensitive): <code>i</code>/<code>inf</code>/<code>info</code>, <code>e</code>/<code>err</code>/<code>error</code>, <code>c</code>/<code>crit</code>/<code>critical</code>, <code>w</code>/<code>warn</code>/<code>warning</code>, <code>d</code>/<code>deb</code>/<code>debug</code>, <code>s</code>/<code>success</code>/<code>ok</code>/<code>done</code>/<code>complete</code>/<code>g</code>/<code>good</code>, <code>x</code>/<code>u</code>/<code>unknown</code> <code>LogDir</code> <code>[System.String]</code> <code>LogDirectory</code> <code>$D_PSLIB_LOGS</code> Directory where log files are written <code>LibName</code> <code>[System.String]</code> <code>LibraryName</code> <code>\"pslib\"</code> Library name prefix used in log entry formatting <code>VbsSessionID</code> <code>[System.String]</code> (none) <code>$LibSessionID</code> Session identifier embedded in each log entry <code>Verbosity</code> <code>[System.Boolean]</code> <code>v</code> (none) If <code>$true</code>, the message is both written to the log file AND printed to the console. If <code>$false</code>, the message is only written to the log file"},{"location":"porting-reference/Vbs_DependencyCatalog/#5-internal-sub-functions-defined-within-vbs","title":"5. Internal Sub-Functions (Defined Within Vbs)","text":"Function Line Purpose Nesting <code>VbsFunctionStackTotalDepth</code> main.ps1:16491 Calculates the total depth of the function call stack string. Each non-numbered function counts as 1; numbered functions (e.g., <code>MakeObject(3)</code>) count as the numeric suffix value. Returns an <code>[int]</code> Top-level internal <code>VbsLogPath</code> main.ps1:16517 Derives the path to the current monthly log file based on the current date. Format: <code>YYYY_MM.log</code> in the log directory Top-level internal <code>VbsLogRealityCheck</code> main.ps1:16529 Ensures the log directory and log file exist, creating them if necessary via <code>New-Item</code> Top-level internal <code>VbsLogWrite</code> main.ps1:16545 Writes a string to the log file via <code>Add-Content</code> Top-level internal <code>VbsUpdateFunctionStack</code> main.ps1:16558 Compresses and updates a colon-delimited function call stack by collapsing consecutive duplicate function names into counted entries (e.g., <code>A:A:A</code> \u2192 <code>A(3)</code>). Used to produce readable stack traces in log entries Top-level internal <code>VbsUpdateFunctionStackExtractNumber</code> main.ps1:16567 Extracts the numeric suffix from a function name string (e.g., <code>\"MakeObject(3)\"</code> \u2192 <code>2</code>). Returns <code>[int]0</code> if no suffix or suffix is less than 2 Nested inside <code>VbsUpdateFunctionStack</code>"},{"location":"porting-reference/Vbs_DependencyCatalog/#6-internal-logic-summary","title":"6. Internal Logic Summary","text":"<p>Log Entry Construction:</p> <p>Each log entry is assembled from four fields:</p> <ol> <li> <p>Timestamp (<code>$t</code>): Dual-format Unix milliseconds and human-readable ISO datetime with timezone offset. Format: <code>{UnixMs}|{yyyy-MM-dd HH:mm:ss.fffzzz}|</code></p> </li> <li> <p>Session ID (<code>$x</code>): The <code>VbsSessionID</code> GUID followed by a pipe delimiter.</p> </li> <li> <p>Status (<code>$s</code>): Normalized from shorthand input to a bracketed tag. The verbose version (<code>$sV</code>) uses a fixed-width padded format for console alignment. Each status level has an associated console color:</p> </li> </ol> Input Log Tag Console Color <code>i</code>, <code>inf</code>, <code>info</code> <code>[INFO]</code> Gray <code>e</code>, <code>err</code>, <code>error</code> <code>[ERROR]</code> DarkRed <code>c</code>, <code>crit</code>, <code>critical</code> <code>[ERROR][CRITICAL]</code> Magenta <code>w</code>, <code>warn</code>, <code>warning</code> <code>[WARN]</code> DarkYellow <code>d</code>, <code>deb</code>, <code>debug</code> <code>[DEBUG]</code> DarkCyan <code>s</code>, <code>success</code>, <code>ok</code>, <code>done</code>, <code>g</code>, <code>good</code> <code>[INFO][SUCCESS]</code> DarkGreen <code>x</code>, <code>u</code>, <code>unknown</code> (or missing) <code>[INFO][UNKNOWN]</code> DarkGray <ol> <li> <p>Caller (<code>$c</code>): Processed through <code>VbsUpdateFunctionStack</code> to compress the call stack. The final log-format wraps the stack in <code>pslib(...):</code>; the verbose-format uses <code>pslib({depth}):</code> where <code>{depth}</code> is the total stack depth.</p> </li> <li> <p>Message (<code>$m</code>): The raw message string. Defaults to <code>'...'</code> if empty.</p> </li> </ol> <p>Output Channels:</p> <p>Two output strings are produced: <code>$o</code> (machine-readable, written to log file) and <code>$oV</code> (human-readable, colorized, printed to console). When <code>$Verbosity</code> is <code>$false</code>, only the log file is written. When <code>$true</code>, both outputs are produced.</p> <p>Log File Management:</p> <p>Log files are named by month (<code>YYYY_MM.log</code>) and stored in <code>$D_PSLIB_LOGS</code>. The <code>VbsLogRealityCheck</code> sub-function ensures both the directory and file exist before writing, creating them via <code>New-Item</code> if missing.</p> <p>Call Stack Compression:</p> <p>The <code>VbsUpdateFunctionStack</code> function is a key feature that transforms raw colon-delimited call stacks into compact representations. For example: <code>MakeIndex:MakeObject:MakeObject:MakeObject</code> \u2192 <code>MakeIndex:MakeObject(3)</code>. This prevents log lines from becoming excessively long during deeply recursive operations like <code>MakeDirectoryIndexRecursiveLogic</code>.</p>"},{"location":"porting-reference/Vbs_DependencyCatalog/#7-net-types-and-methods-used","title":"7. .NET Types and Methods Used","text":"Type / Method Usage <code>[DateTimeOffset]::Now.ToUnixTimeMilliseconds()</code> Generating Unix epoch milliseconds for the timestamp field <code>[System.TimeSpan]::FromMilliseconds()</code> Converting Unix ms back to a TimeSpan for human-readable date formatting <code>Get-Date 01.01.1970</code> Establishing the Unix epoch base date for timestamp calculation"},{"location":"porting-reference/Vbs_DependencyCatalog/#8-powershell-built-in-cmdlets-used","title":"8. PowerShell Built-in Cmdlets Used","text":"Cmdlet Usage Context <code>Add-Content</code> Writing log entries to the monthly log file (<code>-Path</code>, <code>-Value</code>) <code>Get-Date</code> Establishing the epoch base date; formatting the human-readable timestamp (<code>-UFormat \"%Y_%m\"</code> for log file naming) <code>New-Item</code> Creating log directory and log file if they don't exist (<code>-ItemType Directory/File</code>, <code>-Path</code>, <code>-Force</code>) <code>Test-Path</code> Checking existence of log directory and log file (<code>-LiteralPath</code>, <code>-PathType Container/Leaf</code>) <code>Write-Host</code> Printing colorized verbose output to the console (<code>-ForegroundColor</code>)"},{"location":"porting-reference/Vbs_DependencyCatalog/#9-return-value","title":"9. Return Value","text":"<p>This function does not return a value. All code paths terminate with <code>return</code> (no value). The function's purpose is side-effect-driven: writing to log files and optionally printing to the console.</p>"},{"location":"porting-reference/Vbs_DependencyCatalog/#10-log-file-format","title":"10. Log File Format","text":"<p>File naming: <code>YYYY_MM.log</code> (one file per month)</p> <p>Entry format (machine-readable): <pre><code>{UnixMs}|{yyyy-MM-dd HH:mm:ss.fffzzz}|{SessionGUID}|{StatusTags}{LibName}({CompressedStack}): {Message}\n</code></pre></p> <p>Entry format (console/verbose): <pre><code>{yyyy-MM-dd HH:mm:ss.fffzzz} {SessionGUID} {PaddedStatus} {LibName}({StackDepth}): {Message}\n</code></pre></p>"},{"location":"porting-reference/Vbs_DependencyCatalog/#11-call-graph","title":"11. Call Graph","text":"<pre><code>Vbs\n\u251c\u2500\u2500 [construct timestamp field]\n\u2502   \u251c\u2500\u2500 [DateTimeOffset]::Now.ToUnixTimeMilliseconds()\n\u2502   \u2514\u2500\u2500 [System.TimeSpan]::FromMilliseconds()\n\u251c\u2500\u2500 [construct session ID field]\n\u251c\u2500\u2500 [normalize Status to tag and color]\n\u251c\u2500\u2500 [process Caller field]\n\u2502   \u251c\u2500\u2500 [split on ':' to detect sub-function stacks]\n\u2502   \u2514\u2500\u2500 VbsUpdateFunctionStack (compress stack)\n\u2502       \u2514\u2500\u2500 VbsUpdateFunctionStackExtractNumber (extract numeric suffixes)\n\u251c\u2500\u2500 VbsFunctionStackTotalDepth (compute depth for verbose format)\n\u251c\u2500\u2500 [construct message field]\n\u251c\u2500\u2500 VbsLogPath (derive log file path from current date)\n\u251c\u2500\u2500 VbsLogRealityCheck (ensure log dir and file exist)\n\u2502   \u2514\u2500\u2500 New-Item (create if missing)\n\u251c\u2500\u2500 (Verbosity=$false) \u2192 VbsLogWrite only\n\u2502   \u2514\u2500\u2500 Add-Content (write to log file)\n\u2514\u2500\u2500 (Verbosity=$true) \u2192 VbsLogWrite + Write-Host\n    \u251c\u2500\u2500 Add-Content (write to log file)\n    \u2514\u2500\u2500 Write-Host (colorized console output)\n</code></pre>"},{"location":"schema/","title":"Schema Reference","text":"<p>The v2 output schema defines the structure of every index entry produced by shruggie-indexer. It consolidates related fields into logical sub-objects, eliminates redundancies from the legacy format, and includes a <code>schema_version</code> discriminator for forward compatibility.</p>"},{"location":"schema/#canonical-schema","title":"Canonical Schema","text":"<p>The authoritative machine-readable schema is hosted at:</p> <ul> <li>Canonical URL: schemas.shruggie.tech/data/shruggie-indexer-v2.schema.json</li> <li>Local copy: shruggie-indexer-v2.schema.json</li> </ul>"},{"location":"schema/#design-principles","title":"Design Principles","text":"Principle Summary P1 \u2014 Logical grouping Related fields are consolidated into typed sub-objects (<code>NameObject</code>, <code>SizeObject</code>, <code>TimestampPair</code>, <code>ParentObject</code>) instead of scattered across the top level. P2 \u2014 Single type discriminator A <code>type</code> enum (<code>\"file\"</code> or <code>\"directory\"</code>) replaces the legacy dual-boolean pattern. Combined with <code>schema_version</code>, consumers can route parsing unambiguously. P3 \u2014 Metadata provenance <code>MetadataEntry</code> includes <code>origin</code>, <code>file_system</code>, <code>size</code>, <code>timestamps</code>, and <code>attributes</code> \u2014 enough to reconstruct the original sidecar file for MetaMergeDelete reversal. P4 \u2014 No redundancy Dropped <code>BaseName</code> (derivable), <code>SHA1</code> (no unique purpose), and <code>Encoding</code> (.NET-specific). P5 \u2014 Explicit algorithm <code>id_algorithm</code> records which hash algorithm produced the <code>id</code>, eliminating reverse-matching."},{"location":"schema/#top-level-indexentry-fields","title":"Top-Level IndexEntry Fields","text":"<p>An <code>IndexEntry</code> is the root JSON object describing a single indexed file or directory.</p> Property Type Required Description <code>schema_version</code> <code>integer</code> (const <code>2</code>) Yes Always <code>2</code>. Placed first in serialized output. <code>id</code> <code>string</code> Yes Primary identifier. Prefix <code>y</code> = file, <code>x</code> = directory. Pattern: <code>^[xy][0-9A-F]+$</code>. <code>id_algorithm</code> <code>string</code> (enum) Yes <code>\"md5\"</code> or <code>\"sha256\"</code>. The algorithm used to derive <code>id</code>. <code>type</code> <code>string</code> (enum) Yes <code>\"file\"</code> or <code>\"directory\"</code>. <code>name</code> <code>NameObject</code> Yes Item name with associated hash digests. <code>extension</code> <code>string</code> or <code>null</code> Yes File extension without leading dot, lowercase. <code>null</code> for directories or extensionless files. <code>mime_type</code> <code>string</code> or <code>null</code> No MIME type via <code>mimetypes.guess_type()</code>, overridden by ExifTool when available. <code>size</code> <code>SizeObject</code> Yes Human-readable and byte-count size. <code>hashes</code> <code>HashSet</code> or <code>null</code> Yes Content hashes (file) or <code>null</code> (directory). Symlinks hash the name string instead. <code>file_system</code> <code>object</code> Yes Relative path and parent directory identity. <code>timestamps</code> <code>TimestampsObject</code> Yes Created, modified, and accessed timestamps. <code>attributes</code> <code>object</code> Yes Symlink status and deterministic storage name. <code>items</code> <code>array[IndexEntry]</code> or <code>null</code> No Child entries (directory) or <code>null</code> (file). <code>metadata</code> <code>array[MetadataEntry]</code> or <code>null</code> No Metadata records (file) or <code>null</code> (directory). <p><code>additionalProperties</code> is <code>false</code>. The <code>required</code> set:</p> <pre><code>[\"schema_version\", \"id\", \"id_algorithm\", \"type\", \"name\",\n \"extension\", \"size\", \"hashes\", \"file_system\", \"timestamps\", \"attributes\"]\n</code></pre>"},{"location":"schema/#field-behavior-by-type","title":"Field behavior by type","text":"<code>type</code> value <code>hashes</code> <code>extension</code> <code>items</code> <code>metadata</code> <code>\"file\"</code> Content <code>HashSet</code> (or name hash if symlink) Extension string <code>null</code> <code>MetadataEntry[]</code> or <code>null</code> <code>\"directory\"</code> <code>null</code> <code>null</code> <code>IndexEntry[]</code> or <code>null</code> <code>null</code>"},{"location":"schema/#reusable-type-definitions","title":"Reusable Type Definitions","text":""},{"location":"schema/#hashset","title":"HashSet","text":"<p>Cryptographic hash digests. All values are uppercase hexadecimal strings (<code>0-9</code>, <code>A-F</code>).</p> Property Type Required Pattern Description <code>md5</code> <code>string</code> Yes <code>^[0-9A-F]{32}$</code> MD5 digest (32 chars). <code>sha256</code> <code>string</code> Yes <code>^[0-9A-F]{64}$</code> SHA-256 digest (64 chars). <code>sha512</code> <code>string</code> No <code>^[0-9A-F]{128}$</code> SHA-512 digest (128 chars). Omitted from output when not computed. <p>SHA-1 Removal</p> <p>SHA-1 is dropped from v2 entirely. It was not used for identity derivation, adds computational overhead, and has demonstrated collision attacks since 2017.</p>"},{"location":"schema/#nameobject","title":"NameObject","text":"<p>Pairs a text string with its associated hash digests.</p> Property Type Required Description <code>text</code> <code>string</code> or <code>null</code> Yes The name value including extension for files. <code>null</code> for generated metadata entries. <code>hashes</code> <code>HashSet</code> or <code>null</code> Yes Hashes of the UTF-8 byte representation of <code>text</code>. <code>null</code> when <code>text</code> is <code>null</code>. <p><code>text</code> and <code>hashes</code> are co-nullable: both <code>null</code> or both populated. The implementation enforces this at construction time.</p>"},{"location":"schema/#sizeobject","title":"SizeObject","text":"<p>File size in human-readable and machine-readable forms.</p> Property Type Required Description <code>text</code> <code>string</code> Yes Formatted string with unit (e.g., <code>\"15.28 MB\"</code>, <code>\"135 B\"</code>). Uses decimal SI: B, KB, MB, GB, TB. <code>bytes</code> <code>integer</code> Yes Exact byte count (\u2265 0). <p>Formatting thresholds use powers of 1,000 (decimal SI), not 1,024 (binary). Two decimal places for values \u2265 1 KB.</p>"},{"location":"schema/#timestamppair","title":"TimestampPair","text":"<p>A single timestamp in dual format.</p> Property Type Required Description <code>iso</code> <code>string</code> Yes ISO 8601 with fractional seconds and timezone offset. <code>unix</code> <code>integer</code> Yes Milliseconds since epoch (1970-01-01T00:00:00Z)."},{"location":"schema/#timestampsobject","title":"TimestampsObject","text":"<p>Three standard filesystem timestamps.</p> Property Type Required Description <code>created</code> <code>TimestampPair</code> Yes Filesystem creation time. See platform notes for cross-platform behavior. <code>modified</code> <code>TimestampPair</code> Yes Last content modification time. <code>accessed</code> <code>TimestampPair</code> Yes Last access time. May be approximate on Linux with <code>relatime</code>."},{"location":"schema/#parentobject","title":"ParentObject","text":"<p>Parent directory identity and name.</p> Property Type Required Description <code>id</code> <code>string</code> Yes Parent directory identifier. <code>x</code>-prefixed. Pattern: <code>^x[0-9A-F]+$</code>. <code>name</code> <code>NameObject</code> Yes Parent directory name with hashes."},{"location":"schema/#filesystem-location-fields","title":"Filesystem Location Fields","text":"<p>The <code>file_system</code> object provides path and hierarchy information.</p> Property Type Required Description <code>relative</code> <code>string</code> Yes Forward-slash path from index root to this item. <code>\".\"</code> for the root item. <code>parent</code> <code>ParentObject</code> or <code>null</code> Yes Parent directory identity. <code>null</code> for root of a single-file index. <p><code>file_system.relative</code> always uses <code>/</code> separators regardless of platform. <code>file_system.absolute</code> (if present) uses the platform-native separator.</p>"},{"location":"schema/#attribute-fields","title":"Attribute Fields","text":"<p>The <code>attributes</code> object carries item-level flags and computed values.</p> Property Type Required Description <code>is_link</code> <code>boolean</code> Yes <code>true</code> when the item is a symbolic link. <code>storage_name</code> <code>string</code> Yes Deterministic rename target: <code>id</code> + <code>.</code> + extension for files with extensions; <code>id</code> alone for directories or extensionless files."},{"location":"schema/#items-field","title":"Items Field","text":"Scenario <code>items</code> value File <code>null</code> Directory (flat mode) Array of immediate child <code>IndexEntry</code> objects Directory (recursive mode) Nested array of <code>IndexEntry</code> objects <p>Children are ordered files-first, then directories, each group sorted by name (case-insensitive lexicographic). No <code>null</code> entries are permitted within the array.</p>"},{"location":"schema/#metadataentry","title":"MetadataEntry","text":"<p>A single metadata record associated with an <code>IndexEntry</code>.</p> Property Type Required Description <code>id</code> <code>string</code> Yes <code>z</code>-prefixed (generated) or <code>y</code>-prefixed (sidecar). <code>origin</code> <code>string</code> (enum) Yes <code>\"generated\"</code> or <code>\"sidecar\"</code>. <code>name</code> <code>NameObject</code> Yes Source name. Both fields <code>null</code> for generated entries. <code>hashes</code> <code>HashSet</code> Yes Content hashes of the metadata payload. <code>attributes</code> <code>object</code> Yes Type classification, format, and transforms. <code>data</code> varies Yes The metadata content (type depends on <code>attributes.format</code>). <code>file_system</code> <code>object</code> Sidecar only Relative path to the original sidecar file. <code>size</code> <code>SizeObject</code> Sidecar only Size of the original sidecar file. <code>timestamps</code> <code>TimestampsObject</code> Sidecar only Timestamps of the original sidecar file."},{"location":"schema/#origin-behavior","title":"Origin behavior","text":"<code>origin</code> ID prefix <code>file_system</code> <code>size</code> <code>timestamps</code> Description <code>\"generated\"</code> <code>z</code> Absent Absent Absent Created by a tool during indexing (e.g., ExifTool). <code>\"sidecar\"</code> <code>y</code> Present Present Present Absorbed from an external metadata file."},{"location":"schema/#metadataentryattributes","title":"MetadataEntry.attributes","text":"Property Type Required Description <code>type</code> <code>string</code> Yes Semantic classification (see table below). <code>format</code> <code>string</code> (enum) Yes <code>\"json\"</code>, <code>\"text\"</code>, <code>\"base64\"</code>, or <code>\"lines\"</code>. <code>transforms</code> <code>array[string]</code> Yes Ordered transformation identifiers. Empty = stored as-is. <code>source_media_type</code> <code>string</code> No MIME type of original source when format differs."},{"location":"schema/#metadata-type-values","title":"Metadata type values","text":"<p>Generated (tool-prefixed):</p> Type Description <code>exiftool.json_metadata</code> EXIF/XMP/IPTC metadata from ExifTool. <p>Sidecar (unprefixed):</p> Type Description <code>description</code> Text description files (e.g., youtube-dl <code>.description</code>). <code>desktop_ini</code> Windows <code>desktop.ini</code> files. <code>generic_metadata</code> Config/metadata files (<code>.cfg</code>, <code>.conf</code>, <code>.yaml</code>, <code>.meta</code>). <code>hash</code> Hash/checksum files (<code>.md5</code>, <code>.sha256</code>, <code>.crc32</code>). <code>json_metadata</code> JSON metadata (<code>.info.json</code>, <code>.meta.json</code>). <code>link</code> URL shortcuts (<code>.url</code>), filesystem shortcuts (<code>.lnk</code>). <code>screenshot</code> Screen capture images. <code>subtitles</code> Subtitle tracks (<code>.srt</code>, <code>.sub</code>, <code>.vtt</code>, <code>.lrc</code>). <code>thumbnail</code> Thumbnail/cover images (<code>.cover</code>, <code>.thumb</code>). <code>torrent</code> Torrent/magnet link files. <code>error</code> Entry could not be read or classified."},{"location":"schema/#format-values","title":"Format values","text":"Format <code>data</code> type Description <code>\"json\"</code> <code>object</code> or <code>array</code> Parsed JSON structure. <code>\"text\"</code> <code>string</code> UTF-8 text. <code>\"base64\"</code> <code>string</code> Base64-encoded binary. <code>\"lines\"</code> <code>array[string]</code> Line-oriented content."},{"location":"schema/#transform-identifiers","title":"Transform identifiers","text":"Transform Description <code>base64_encode</code> Binary source was Base64-encoded. <code>json_compact</code> Source JSON was compacted. <code>line_split</code> Text split into line array. <code>key_filter</code> Keys removed from JSON object (not reversible)."},{"location":"schema/#annotated-example","title":"Annotated Example","text":"<p>The following is a real v2-compliant output entry for an executable file:</p> <pre><code>{\n  \"schema_version\": 2,\n  \"id\": \"yA8A8C089A6A8583B24C85F5A4A41F5AC\",\n  \"id_algorithm\": \"md5\",\n  \"type\": \"file\",\n  \"name\": {\n    \"text\": \"flashplayer.exe\",\n    \"hashes\": {\n      \"md5\": \"3470F718BA9457335A59CE06239A9250\",\n      \"sha256\": \"4DC834B31A1A5967F7A97AAD3D62EE91CCCC99B2034748135AFC193889B9A0EB\"\n    }\n  },\n  \"extension\": \"exe\",\n  \"mime_type\": \"application/octet-stream\",\n  \"size\": {\n    \"text\": \"15.28 MB\",\n    \"bytes\": 16027648\n  },\n  \"hashes\": {\n    \"md5\": \"A8A8C089A6A8583B24C85F5A4A41F5AC\",\n    \"sha256\": \"B6BA115C2B43D87AADDF0060C44726E7AF1A12C9501FC63DE652A9517D7367DB\"\n  },\n  \"file_system\": {\n    \"relative\": \".test/flashplayer.exe\",\n    \"parent\": {\n      \"id\": \"x3B4F479E9F880E438882FC34B67D352C\",\n      \"name\": {\n        \"text\": \".test\",\n        \"hashes\": {\n          \"md5\": \"5E7576E3CD79114D46850714E998A3B0\",\n          \"sha256\": \"5559EC61AE317CDF207A17666B01777B00DDF4AB1044BE5CC213DD3618E5F98C\"\n        }\n      }\n    }\n  },\n  \"timestamps\": {\n    \"created\": { \"iso\": \"2026-02-15T09:28:17.4084620-05:00\", \"unix\": 1771165697408 },\n    \"modified\": { \"iso\": \"2023-08-03T19:47:44.0000000-04:00\", \"unix\": 1691106464000 },\n    \"accessed\": { \"iso\": \"2026-02-15T09:28:18.1093900-05:00\", \"unix\": 1771165698109 }\n  },\n  \"attributes\": {\n    \"is_link\": false,\n    \"storage_name\": \"yA8A8C089A6A8583B24C85F5A4A41F5AC.exe\"\n  },\n  \"items\": null,\n  \"metadata\": null\n}\n</code></pre> <p>Key observations:</p> <ul> <li><code>id</code> is <code>\"y\"</code> + the MD5 content hash (matching <code>id_algorithm: \"md5\"</code>)</li> <li><code>storage_name</code> is <code>id</code> + <code>\".\"</code> + <code>extension</code></li> <li><code>name.hashes</code> are hashes of the UTF-8 bytes of <code>\"flashplayer.exe\"</code> (different from content <code>hashes</code>)</li> <li><code>file_system.relative</code> uses forward slashes regardless of platform</li> <li><code>hashes.sha512</code> is absent (not <code>null</code>) because SHA-512 was not computed</li> <li><code>items</code> and <code>metadata</code> are explicitly <code>null</code> (file with no metadata extraction requested)</li> </ul>"},{"location":"schema/#validation-examples","title":"Validation Examples","text":"<p>The examples/ directory contains real-world v2-compliant output files:</p> <ul> <li>flashplayer.exe_meta2.json</li> </ul>"},{"location":"user-guide/","title":"User Guide","text":"<p>The User Guide provides comprehensive reference documentation for shruggie-indexer. Choose a section below based on what you need.</p>"},{"location":"user-guide/#sections","title":"Sections","text":""},{"location":"user-guide/#desktop-application","title":"Desktop Application","text":"<p>Visual guide to the desktop (GUI) application. Covers launching the app, navigating the interface, choosing operation types, understanding the output panel, keyboard shortcuts, and troubleshooting \u2014 written for users who prefer a graphical interface over the command line.</p>"},{"location":"user-guide/#cli-reference","title":"CLI Reference","text":"<p>Complete documentation for every command-line option, flag, and argument. Includes the output scenarios table, exit codes, mutual exclusion rules, and signal handling behavior.</p>"},{"location":"user-guide/#configuration","title":"Configuration","text":"<p>The TOML-based configuration system: file format, default values, the layered resolution hierarchy (CLI flags &gt; config file &gt; defaults), metadata file parser patterns, ExifTool exclusion lists, and override/merge behavior.</p>"},{"location":"user-guide/#python-api","title":"Python API","text":"<p>Public API reference for using shruggie-indexer as a Python library. Covers <code>index_path()</code>, <code>load_config()</code>, <code>serialize_entry()</code>, and all data classes (<code>IndexEntry</code>, <code>HashSet</code>, <code>NameObject</code>, and more).</p>"},{"location":"user-guide/#platform-notes","title":"Platform Notes","text":"<p>Cross-platform behavior details for Windows, Linux, and macOS \u2014 including creation time portability, symlink handling, filesystem attribute differences, and path normalization.</p>"},{"location":"user-guide/cli-reference/","title":"CLI Reference","text":"<p>shruggie-indexer is invoked as a single command with options and an optional target path.</p>"},{"location":"user-guide/cli-reference/#command-structure","title":"Command Structure","text":"<pre><code>shruggie-indexer [OPTIONS] [TARGET]\n</code></pre> <p><code>TARGET</code> is an optional positional argument specifying the file or directory to index. When omitted, the current working directory is used.</p>"},{"location":"user-guide/cli-reference/#target-options","title":"Target Options","text":""},{"location":"user-guide/cli-reference/#target-positional-argument","title":"<code>TARGET</code> (positional argument)","text":"<p>The filesystem path to index. shruggie-indexer auto-detects whether the path is a file or directory and dispatches to the appropriate indexing logic.</p> <ul> <li>If omitted, defaults to the current working directory.</li> <li>Must point to an existing path (validated at invocation time).</li> </ul>"},{"location":"user-guide/cli-reference/#-file-directory","title":"<code>--file</code> / <code>--directory</code>","text":"<p>Force the target to be treated as a file or directory, overriding auto-detection.</p> <pre><code># Force file interpretation (useful for symlinks)\nshruggie-indexer --file path/to/ambiguous-item\n\n# Force directory interpretation\nshruggie-indexer --directory path/to/target\n</code></pre> <p>If the forced type does not match the actual filesystem type, a warning is logged but processing continues.</p>"},{"location":"user-guide/cli-reference/#-recursive-no-recursive","title":"<code>--recursive</code> / <code>--no-recursive</code>","text":"<p>Control recursive directory traversal. Default: <code>--recursive</code>.</p> <pre><code># Index a directory and all its subdirectories (default)\nshruggie-indexer path/to/dir --recursive\n\n# Index only the directory's immediate children\nshruggie-indexer path/to/dir --no-recursive\n</code></pre> <p>For single-file targets, this option has no effect.</p>"},{"location":"user-guide/cli-reference/#output-options","title":"Output Options","text":"<p>Three independent output flags control where JSON output is written. Multiple output destinations can be active simultaneously.</p>"},{"location":"user-guide/cli-reference/#-stdout-no-stdout","title":"<code>--stdout</code> / <code>--no-stdout</code>","text":"<p>Write the complete JSON index to standard output.</p> <ul> <li>Default behavior: Enabled when no other output destination (<code>--outfile</code>, <code>--inplace</code>) is specified. Disabled when another output destination is active.</li> <li>Explicit <code>--stdout</code>: Forces stdout output alongside other destinations.</li> <li>Explicit <code>--no-stdout</code>: Suppresses stdout output entirely.</li> </ul>"},{"location":"user-guide/cli-reference/#-outfile-o","title":"<code>--outfile</code>, <code>-o</code>","text":"<p>Write the combined JSON output to the specified file path.</p> <pre><code>shruggie-indexer path/to/target --outfile index.json\nshruggie-indexer path/to/target -o index.json\n</code></pre> <ul> <li>The parent directory must exist.</li> <li>Existing files are overwritten without prompting.</li> <li>Disables stdout output by default (use <code>--stdout</code> to re-enable).</li> </ul>"},{"location":"user-guide/cli-reference/#-inplace","title":"<code>--inplace</code>","text":"<p>Write individual sidecar JSON files alongside each indexed item.</p> <pre><code>shruggie-indexer path/to/directory/ --inplace\n</code></pre> <p>For files, the sidecar is named <code>&lt;filename&gt;_meta2.json</code>. For directories, the sidecar is named <code>&lt;dirname&gt;_directorymeta2.json</code> and placed inside the directory.</p> Item Sidecar path <code>photos/sunset.jpg</code> <code>photos/sunset.jpg_meta2.json</code> <code>photos/vacation/</code> <code>photos/vacation/vacation_directorymeta2.json</code> <p>Disables stdout output by default (use <code>--stdout</code> to re-enable).</p>"},{"location":"user-guide/cli-reference/#metadata-options","title":"Metadata Options","text":"<p>These options control embedded metadata extraction and sidecar metadata processing.</p> <p>Implication chain</p> <p>The metadata flags form an implication chain:</p> <ul> <li><code>--meta-merge-delete</code> implies <code>--meta-merge</code></li> <li><code>--meta-merge</code> implies <code>--meta</code></li> </ul> <p>You only need to specify the highest-level flag you want. The implied flags are activated automatically.</p>"},{"location":"user-guide/cli-reference/#-meta-m","title":"<code>--meta</code>, <code>-m</code>","text":"<p>Extract embedded EXIF/XMP/IPTC metadata from files via ExifTool.</p> <pre><code>shruggie-indexer path/to/file.jpg --meta\n</code></pre> <p>When active, each file entry's <code>metadata</code> array includes an <code>exiftool.json_metadata</code> entry containing the extracted metadata as a JSON object. If ExifTool is not installed, a warning is logged and the entry is omitted \u2014 this is not a fatal error.</p>"},{"location":"user-guide/cli-reference/#-meta-merge","title":"<code>--meta-merge</code>","text":"<p>Discover sidecar metadata files alongside each indexed item and merge their content into the parent entry's <code>metadata</code> array. Implies <code>--meta</code>.</p> <pre><code>shruggie-indexer path/to/directory/ --meta-merge\n</code></pre> <p>Sidecar files (<code>.info.json</code>, <code>.description</code>, thumbnails, subtitles, etc.) are identified by configurable filename patterns. The original sidecar files remain on disk.</p>"},{"location":"user-guide/cli-reference/#-meta-merge-delete","title":"<code>--meta-merge-delete</code>","text":"<p>Merge sidecar metadata into parent entries and delete the original sidecar files from disk after indexing completes. Implies <code>--meta-merge</code> (and therefore <code>--meta</code>).</p> <pre><code>shruggie-indexer path/to/directory/ --meta-merge-delete --outfile index.json\n</code></pre> <p>Requires persistent output</p> <p><code>--meta-merge-delete</code> requires at least one of <code>--outfile</code> or <code>--inplace</code> to be active. Without a persistent output destination, the merged metadata would be lost when the sidecar files are deleted. Violating this constraint produces a fatal error (exit code 2).</p> <p>Each merged sidecar entry carries full filesystem provenance \u2014 path, size, timestamps, and content hashes \u2014 sufficient to reverse the deletion if needed.</p> <p>The pipeline executes in a fixed order: index \u2192 write sidecars \u2192 rename \u2192 delete. Sidecar deletion occurs only after all other phases complete successfully. Each successful deletion is logged at <code>INFO</code> level; failures are logged at <code>ERROR</code> level and do not abort the remaining deletions.</p>"},{"location":"user-guide/cli-reference/#rename-options","title":"Rename Options","text":""},{"location":"user-guide/cli-reference/#-rename","title":"<code>--rename</code>","text":"<p>Rename files to their deterministic, hash-based <code>storage_name</code> values.</p> <pre><code>shruggie-indexer path/to/directory/ --rename\n</code></pre> <p>For a file with <code>id</code> of <code>yA8A8C089A6A8583B24C85F5A4A41F5AC</code> and extension <code>exe</code>, the storage name is <code>yA8A8C089A6A8583B24C85F5A4A41F5AC.exe</code>. Directories are renamed to their <code>id</code> (e.g., <code>x3B4F479E9F880E438882FC34B67D352C</code>).</p> <p>Rename implies in-place</p> <p><code>--rename</code> automatically enables <code>--inplace</code> so that sidecar files are written alongside each renamed item, preserving the original filename in the index entry.</p>"},{"location":"user-guide/cli-reference/#-dry-run","title":"<code>--dry-run</code>","text":"<p>Preview rename operations without modifying any files.</p> <pre><code>shruggie-indexer path/to/directory/ --rename --dry-run\n</code></pre> <p>Logs each proposed rename at <code>INFO</code> level. Only meaningful when used with <code>--rename</code>.</p>"},{"location":"user-guide/cli-reference/#identity-options","title":"Identity Options","text":""},{"location":"user-guide/cli-reference/#-id-type","title":"<code>--id-type</code>","text":"<p>Select which hash algorithm is used for the <code>id</code> field and <code>storage_name</code>. Choices: <code>md5</code> (default) or <code>sha256</code>.</p> <pre><code>shruggie-indexer path/to/file --id-type sha256\n</code></pre> <code>--id-type</code> <code>id</code> example <code>id</code> length <code>md5</code> <code>yA8A8C089A6A8583B24C85F5A4A41F5AC</code> 33 chars (1 prefix + 32 hex) <code>sha256</code> <code>yB6BA115C2B43D87AADDF0060C44726E7AF1A12C9501FC63DE652A9517D7367DB</code> 65 chars (1 prefix + 64 hex) <p>Both algorithms are always computed regardless of this setting. This option only controls which digest is promoted to the <code>id</code> field.</p>"},{"location":"user-guide/cli-reference/#-compute-sha512","title":"<code>--compute-sha512</code>","text":"<p>Include SHA-512 in the computed <code>HashSet</code> objects. SHA-512 is excluded by default to reduce output size.</p> <pre><code>shruggie-indexer path/to/file --compute-sha512\n</code></pre> <p>When enabled, every <code>hashes</code> and <code>name.hashes</code> object in the output includes a <code>sha512</code> field.</p>"},{"location":"user-guide/cli-reference/#configuration","title":"Configuration","text":""},{"location":"user-guide/cli-reference/#-config","title":"<code>--config</code>","text":"<p>Path to a TOML configuration file. Overrides the default config file resolution.</p> <pre><code>shruggie-indexer path/to/target --config my-config.toml\n</code></pre> <p>See the Configuration page for the file format and available settings.</p>"},{"location":"user-guide/cli-reference/#logging-options","title":"Logging Options","text":""},{"location":"user-guide/cli-reference/#-v-verbose","title":"<code>-v</code>, <code>--verbose</code>","text":"<p>Increase logging verbosity. Repeatable.</p> Flag Log level Output (none) <code>WARNING</code> Warnings and errors only <code>-v</code> <code>INFO</code> Informational messages (progress, implications) <code>-vv</code> <code>DEBUG</code> Detailed diagnostic output <code>-vvv</code> <code>DEBUG</code> (all) Full trace-level logging including internal modules"},{"location":"user-guide/cli-reference/#-q-quiet","title":"<code>-q</code>, <code>--quiet</code>","text":"<p>Suppress all non-error output. Sets log level to <code>CRITICAL</code>. Overrides <code>--verbose</code> if both are specified.</p> <pre><code>shruggie-indexer path/to/target -q\n</code></pre> <p>In quiet mode, the exit code is the primary success/failure signal.</p>"},{"location":"user-guide/cli-reference/#-log-file","title":"<code>--log-file</code>","text":"<p>Write log output to a persistent file for later analysis.</p> <pre><code># Write to the default app data directory\nshruggie-indexer path/to/target --log-file\n\n# Write to a specific file\nshruggie-indexer path/to/target --log-file /path/to/output.log\n</code></pre> Usage Behavior <code>--log-file</code> (no argument) Write to the default platform-specific log directory <code>--log-file &lt;path&gt;</code> Write to the specified file path <p>Default log directory by platform:</p> Platform Directory Windows <code>%LOCALAPPDATA%\\ShruggieTech\\shruggie-indexer\\logs\\</code> macOS <code>~/Library/Application Support/ShruggieTech/shruggie-indexer/logs/</code> Linux <code>~/.local/share/shruggie-indexer/logs/</code> <p>Log files are named by date and session: <code>YYYY-MM-DD_HHMMSS.log</code>. The log level written to the file matches the currently configured verbosity.</p> <p>Log file output can also be enabled via the TOML configuration file:</p> <pre><code>[logging]\nfile_enabled = true\n# file_path = \"\"  # empty = use default app data location\n</code></pre>"},{"location":"user-guide/cli-reference/#general-options","title":"General Options","text":""},{"location":"user-guide/cli-reference/#-version","title":"<code>--version</code>","text":"<p>Print the installed version and exit.</p> <pre><code>shruggie-indexer --version\n</code></pre>"},{"location":"user-guide/cli-reference/#-help","title":"<code>--help</code>","text":"<p>Print the help text and exit.</p> <pre><code>shruggie-indexer --help\n</code></pre>"},{"location":"user-guide/cli-reference/#mutual-exclusion-rules","title":"Mutual Exclusion Rules","text":"<p>The following constraints are enforced at invocation time:</p> Rule Behavior <code>--file</code> and <code>--directory</code> Mutually exclusive. Only one may be specified. <code>--stdout</code> and <code>--no-stdout</code> Mutually exclusive. Click handles this automatically. <code>--recursive</code> and <code>--no-recursive</code> Mutually exclusive. Click handles this automatically. <code>--meta-merge-delete</code> without <code>--outfile</code> or <code>--inplace</code> Fatal error (exit code 2). <code>--dry-run</code> without <code>--rename</code> Silently ignored. <code>TARGET</code> does not exist Fatal error (exit code 3). <code>--outfile</code> parent directory does not exist Fatal error (exit code 2)."},{"location":"user-guide/cli-reference/#output-scenarios","title":"Output Scenarios","text":"<p>The three output flags (<code>--stdout</code>, <code>--outfile</code>, <code>--inplace</code>) combine into the following scenarios:</p> Scenario Flags Stdout Outfile In-place 1 \u2014 Default (none) \u2714 \u2014 \u2014 2 \u2014 File only <code>--outfile index.json</code> \u2014 \u2714 \u2014 3 \u2014 File + stdout <code>--outfile index.json --stdout</code> \u2714 \u2714 \u2014 4 \u2014 In-place only <code>--inplace</code> \u2014 \u2014 \u2714 5 \u2014 File + in-place <code>--outfile index.json --inplace</code> \u2014 \u2714 \u2714 6 \u2014 In-place + stdout <code>--inplace --stdout</code> \u2714 \u2014 \u2714 7 \u2014 All three <code>--outfile index.json --inplace --stdout</code> \u2714 \u2714 \u2714 Silent <code>--no-stdout</code> \u2014 \u2014 \u2014"},{"location":"user-guide/cli-reference/#exit-codes","title":"Exit Codes","text":"Code Name Meaning <code>0</code> <code>SUCCESS</code> Completed successfully. All items processed. <code>1</code> <code>PARTIAL_FAILURE</code> Completed with one or more item-level errors (skipped items, failed extractions). <code>2</code> <code>CONFIGURATION_ERROR</code> Invalid configuration or flag combination. No processing began. <code>3</code> <code>TARGET_ERROR</code> Target path does not exist or is not accessible. <code>4</code> <code>RUNTIME_ERROR</code> Unexpected error during processing. <code>5</code> <code>INTERRUPTED</code> Cancelled by user via Ctrl+C."},{"location":"user-guide/cli-reference/#signal-handling","title":"Signal Handling","text":"<p>shruggie-indexer implements a two-phase interruption model for graceful cancellation:</p> <p>First Ctrl+C (cooperative): Sets a cancellation flag. The engine finishes processing the current item and then stops cleanly. A message is printed to stderr:</p> <pre><code>Interrupt received \u2014 finishing current item. Press Ctrl+C again to force quit.\n</code></pre> <p>Second Ctrl+C (forced): Restores the default signal handler and raises <code>KeyboardInterrupt</code> for immediate termination.</p>"},{"location":"user-guide/cli-reference/#cancellation-and-output-state","title":"Cancellation and output state","text":"Output mode State after interruption <code>--stdout</code> No output produced (the entry tree was incomplete). <code>--outfile</code> No output produced. <code>--inplace</code> Partial output \u2014 sidecar files for completed items are valid on disk. <p>If <code>--meta-merge-delete</code> is active, the deletion queue is discarded on cancellation \u2014 no sidecar files are deleted.</p> <p>If <code>--rename</code> is active, files renamed before the interrupt retain their new names with valid sidecar manifests. Unreached files keep their original names. Re-running the same command is safe and idempotent.</p>"},{"location":"user-guide/configuration/","title":"Configuration","text":"<p>shruggie-indexer uses a layered configuration system. All behavior is configurable without editing source code, and the tool operates correctly with no configuration file \u2014 sensible defaults are built in.</p>"},{"location":"user-guide/configuration/#configuration-hierarchy","title":"Configuration Hierarchy","text":"<p>Configuration values are resolved in the following order. Higher-priority layers override lower-priority ones:</p> Priority Source Description 1 (lowest) Compiled defaults Built into the tool. Always present. 2 User config file Platform-standard location (see below). 3 Project-local config file <code>.shruggie-indexer.toml</code> in the target directory or its ancestors. 4 (highest) CLI flags / API arguments Command-line options or <code>load_config(overrides=...)</code>."},{"location":"user-guide/configuration/#config-file-locations","title":"Config file locations","text":"Platform User config path Linux / macOS <code>~/.config/shruggie-indexer/config.toml</code> Windows <code>%APPDATA%\\shruggie-indexer\\config.toml</code> <p>Project-local config files (<code>.shruggie-indexer.toml</code>) are searched starting from the target directory and walking up to the filesystem root.</p> <p>To specify a config file explicitly from the command line:</p> <pre><code>shruggie-indexer path/to/target --config my-config.toml\n</code></pre>"},{"location":"user-guide/configuration/#configuration-file-format","title":"Configuration File Format","text":"<p>Configuration files use TOML format, parsed by Python's built-in <code>tomllib</code> module (Python 3.11+).</p>"},{"location":"user-guide/configuration/#complete-example","title":"Complete example","text":"<p>The following shows all available configuration options with their default values:</p> <pre><code># \u2500\u2500 Traversal and identity \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n[traversal]\nrecursive = true\nid_algorithm = \"md5\"         # \"md5\" or \"sha256\"\ncompute_sha512 = false\n\n# \u2500\u2500 Output routing \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n[output]\nstdout = true                # Conditional default (see docs)\n# file = \"index.json\"       # No default; set to enable file output\ninplace = false\n\n# \u2500\u2500 Metadata processing \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n[metadata]\nextract_exif = false\nmeta_merge = false\nmeta_merge_delete = false\n\n# \u2500\u2500 Rename \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n[rename]\nenabled = false\ndry_run = false\n\n# \u2500\u2500 Logging \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n[logging]\nfile_enabled = false         # Enable persistent log file output\n# file_path = \"\"             # Empty = default app data directory\n\n# \u2500\u2500 Extension validation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n[extensions]\nvalidation_pattern = '^(([a-z0-9]){1,2}|([a-z0-9])([a-z0-9\\-]){1,12}([a-z0-9]))$'\n\n# \u2500\u2500 Filesystem exclusion filters \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n[filesystem_excludes]\nnames = [\n    \"$recycle.bin\",\n    \"system volume information\",\n    \"desktop.ini\",\n    \"thumbs.db\",\n    \".ds_store\",\n    \".spotlight-v100\",\n    \".trashes\",\n    \".fseventsd\",\n    \".temporaryitems\",\n    \".documentrevisions-v100\",\n    \".git\",\n]\nglobs = [\".trash-*\"]\n\n# \u2500\u2500 ExifTool configuration \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n[exiftool]\nexclude_extensions = [\"csv\", \"htm\", \"html\", \"json\", \"tsv\", \"xml\"]\n# exclude_keys = [...]          # Replace the entire key exclusion set (advanced)\n# exclude_keys_append = [...]   # Append additional keys to the default exclusion set\nbase_args = [\n    \"-extractEmbedded3\",\n    \"-scanForXMP\",\n    \"-unknown2\",\n    \"-json\",\n    \"-G3:1\",\n    \"-struct\",\n    \"-ignoreMinorErrors\",\n    \"-charset\", \"filename=utf8\",\n    \"-api\", \"requestall=3\",\n    \"-api\", \"largefilesupport=1\",\n    \"--\",\n]\n\n# \u2500\u2500 Extension groups \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n# Seven groups: archive, audio, font, image, link, subtitles, video\n# Each maps to a list of lowercase extensions (without leading dots).\n# See the technical specification \u00a77.3 for the complete default lists.\n</code></pre>"},{"location":"user-guide/configuration/#default-configuration-values","title":"Default Configuration Values","text":""},{"location":"user-guide/configuration/#scalar-defaults","title":"Scalar defaults","text":"Setting Default Description <code>traversal.recursive</code> <code>true</code> Recurse into subdirectories. <code>traversal.id_algorithm</code> <code>\"md5\"</code> Hash algorithm for the <code>id</code> field. <code>traversal.compute_sha512</code> <code>false</code> Compute SHA-512 (not computed by default for performance). <code>output.stdout</code> <code>true</code> (conditional) Write to stdout when no other output is specified. <code>output.inplace</code> <code>false</code> Write in-place sidecar files. <code>metadata.extract_exif</code> <code>false</code> Extract embedded metadata via ExifTool. <code>metadata.meta_merge</code> <code>false</code> Merge sidecar metadata into parent entries. <code>metadata.meta_merge_delete</code> <code>false</code> Merge and delete sidecar files. <code>rename.enabled</code> <code>false</code> Rename files to storage names. <code>rename.dry_run</code> <code>false</code> Preview rename operations."},{"location":"user-guide/configuration/#extension-validation-pattern","title":"Extension validation pattern","text":"<p>The default pattern accepts extensions of 1\u20132 alphanumeric characters, or 3\u201314 characters where the first and last are alphanumeric and interior characters may include hyphens:</p> <pre><code>^(([a-z0-9]){1,2}|([a-z0-9])([a-z0-9\\-]){1,12}([a-z0-9]))$\n</code></pre> <p>Extensions that fail validation are recorded in the output's <code>extension</code> field but are treated as unrecognized for ExifTool processing purposes.</p>"},{"location":"user-guide/configuration/#logging-configuration","title":"Logging configuration","text":"<p>The <code>[logging]</code> section controls persistent log file output. By default, shruggie-indexer does not write log files \u2014 diagnostic output goes to stderr (CLI) or the in-app log panel (GUI).</p> Key Default Description <code>logging.file_enabled</code> <code>false</code> Enable persistent log file output. <code>logging.file_path</code> <code>\"\"</code> (empty) Path to the log file. Empty uses the default platform-specific directory. <p>Default log directory by platform:</p> Platform Directory Windows <code>%LOCALAPPDATA%\\ShruggieTech\\shruggie-indexer\\logs\\</code> macOS <code>~/Library/Application Support/ShruggieTech/shruggie-indexer/logs/</code> Linux <code>~/.local/share/shruggie-indexer/logs/</code> <p>Log files are named by date and session: <code>YYYY-MM-DD_HHMMSS.log</code>. The log file format includes timestamps, session ID, log level, logger name, and message:</p> <pre><code>2026-02-23 14:30:02  abc123  INFO      shruggie_indexer.core.hasher  Hashing file: photo.jpg\n</code></pre> <p>The CLI equivalent is the <code>--log-file</code> flag. In the GUI, enable \"Write log files\" in Settings.</p>"},{"location":"user-guide/configuration/#metadata-exclusion-patterns","title":"Metadata exclusion patterns","text":"<p>The <code>metadata_exclude.patterns</code> setting controls which files are unconditionally excluded from indexing as standalone items. This prevents indexer output artifacts from being re-indexed on subsequent runs.</p> <p>The default pattern list:</p> Pattern Matches <code>_(meta2?\\|directorymeta2?)\\.json$</code> Indexer output sidecars: <code>_meta.json</code>, <code>_meta2.json</code>, <code>images_directorymeta2.json</code>, etc. <p>These patterns are end-anchored, so they match both bare filenames (e.g., <code>_meta2.json</code>) and prefixed filenames (e.g., <code>video.mp4_meta2.json</code>, <code>images_directorymeta2.json</code>).</p> <p>Two-layer exclusion mechanism</p> <p>shruggie-indexer applies two layers of file exclusion during traversal:</p> <p>Layer 1 \u2014 Metadata exclude patterns (always active): Files matching <code>metadata_exclude.patterns</code> are removed from the item list during initial directory scanning. This prevents indexer output artifacts from being indexed as regular items.</p> <p>Layer 2 \u2014 Sidecar identification patterns (active when MetaMerge is enabled): When MetaMerge or MetaMergeDelete is active, files matching recognized sidecar patterns (<code>.info.json</code>, <code>.description</code>, thumbnails, subtitles, etc.) are additionally excluded from the item list. These files are still available to the sidecar discovery system for merging into parent entries, but they are not indexed as standalone items.</p> <p>Both layers work together to ensure sidecar files appear exclusively through the metadata merge system and never as inflated item counts in the output.</p>"},{"location":"user-guide/configuration/#filesystem-exclusion-defaults","title":"Filesystem exclusion defaults","text":"<p>The default exclusion set covers system artifacts across all supported platforms:</p> Platform Excluded items Windows <code>$RECYCLE.BIN</code>, <code>System Volume Information</code>, <code>desktop.ini</code>, <code>Thumbs.db</code> macOS <code>.DS_Store</code>, <code>.Spotlight-V100</code>, <code>.Trashes</code>, <code>.fseventsd</code>, <code>.TemporaryItems</code>, <code>.DocumentRevisions-V100</code> Linux <code>.Trash-*</code> (glob pattern) All <code>.git</code> <p>All platform-specific exclusions are applied regardless of the current platform, ensuring clean output from cross-platform network shares and external drives.</p>"},{"location":"user-guide/configuration/#exiftool-exclusion-defaults","title":"ExifTool exclusion defaults","text":"<p>These file extensions are skipped for ExifTool invocation because ExifTool tends to dump the entire file content rather than extracting meaningful metadata:</p> <p><code>csv</code>, <code>htm</code>, <code>html</code>, <code>json</code>, <code>tsv</code>, <code>xml</code></p>"},{"location":"user-guide/configuration/#metadatafileparser-configuration","title":"MetadataFileParser Configuration","text":"<p>The metadata file parser configuration controls how sidecar files are discovered and classified. It defines the regex patterns that match sidecar filenames and the behavioral attributes for each type.</p>"},{"location":"user-guide/configuration/#recognized-sidecar-types","title":"Recognized sidecar types","text":"Type Description Data handling <code>description</code> Text description files (youtube-dl <code>.description</code>) JSON \u2192 text \u2192 binary fallback <code>desktop_ini</code> Windows <code>desktop.ini</code> files Text <code>generic_metadata</code> Generic config/metadata (<code>.cfg</code>, <code>.conf</code>, <code>.yaml</code>, <code>.meta</code>) JSON \u2192 text \u2192 binary fallback <code>hash</code> Hash/checksum files (<code>.md5</code>, <code>.sha256</code>, <code>.crc32</code>) Lines (non-empty lines only) <code>json_metadata</code> JSON metadata (<code>.info.json</code>, <code>.meta.json</code>) JSON <code>link</code> URL shortcuts (<code>.url</code>), filesystem shortcuts (<code>.lnk</code>) URL/path extraction <code>screenshot</code> Screen capture images Base64-encoded binary <code>subtitles</code> Subtitle tracks (<code>.srt</code>, <code>.sub</code>, <code>.vtt</code>, <code>.lrc</code>) JSON \u2192 text \u2192 binary fallback <code>thumbnail</code> Thumbnail/cover images (<code>.cover</code>, <code>.thumb</code>) Base64-encoded binary <code>torrent</code> Torrent/magnet link files Base64-encoded binary"},{"location":"user-guide/configuration/#type-identification-patterns","title":"Type identification patterns","text":"<p>Each sidecar type is identified by one or more regex patterns matched against the sibling filename. The patterns are applied in the order listed above \u2014 the first match wins.</p> <p>Patterns are specified as regex strings in the configuration. All patterns are compiled with <code>re.IGNORECASE</code>. See the Technical Specification \u00a77.3 for the complete default pattern inventory, including the BCP 47 language code alternation for subtitle detection.</p>"},{"location":"user-guide/configuration/#type-behavioral-attributes","title":"Type behavioral attributes","text":"<p>Each sidecar type has behavioral attributes that control how its content is read:</p> Attribute Description <code>expect_json</code> Attempt JSON parsing first. <code>expect_text</code> Attempt UTF-8 text reading. <code>expect_binary</code> Attempt binary reading (Base64 encode). <code>parent_can_be_file</code> This sidecar type can be associated with a file. <code>parent_can_be_directory</code> This sidecar type can be associated with a directory. <p>For types where multiple formats are expected, the reader attempts formats in order: JSON \u2192 text \u2192 binary, falling through on parse failures.</p>"},{"location":"user-guide/configuration/#exiftool-exclusion-lists","title":"ExifTool Exclusion Lists","text":""},{"location":"user-guide/configuration/#extension-exclusions","title":"Extension exclusions","text":"<p><code>exiftool.exclude_extensions</code> controls which file types are skipped for ExifTool invocation. Default: <code>[\"csv\", \"htm\", \"html\", \"json\", \"tsv\", \"xml\"]</code>.</p>"},{"location":"user-guide/configuration/#key-exclusions","title":"Key exclusions","text":"<p>After ExifTool returns metadata, certain operational and OS-specific keys are filtered out before storage. Because exiftool with <code>-G</code> flags emits group-prefixed keys (e.g. <code>System:FileName</code>), the filter matches by base key name (the portion after the last <code>:</code> separator).</p> <p>The key exclusion set is configurable via two TOML keys:</p> Config key Behavior <code>exiftool.exclude_keys = [...]</code> Replace \u2014 the specified list becomes the complete exclusion set. <code>exiftool.exclude_keys_append = [...]</code> Append \u2014 entries are added to the compiled default set below. <p>Example \u2014 append additional keys:</p> <pre><code>[exiftool]\nexclude_keys_append = [\"Copyright\", \"Artist\"]\n</code></pre> <p>Example \u2014 replace the entire set (advanced):</p> <pre><code>[exiftool]\nexclude_keys = [\"SourceFile\", \"Directory\", \"FileName\"]\n</code></pre> <p>The compiled default exclusion set:</p> Base key Category <code>ExifToolVersion</code> ExifTool operational <code>FileSequence</code> ExifTool operational <code>NewGUID</code> ExifTool operational <code>Now</code> ExifTool operational <code>ProcessingTime</code> ExifTool operational <code>Directory</code> Filesystem path <code>FileName</code> Filesystem path <code>FilePath</code> Filesystem path <code>BaseName</code> Filesystem path <code>SourceFile</code> Filesystem path <code>FilePermissions</code> OS-specific <code>FileSize</code> Redundant (in <code>size</code> object) <code>FileModifyDate</code> Redundant (in <code>timestamps</code>) <code>FileAccessDate</code> Redundant (in <code>timestamps</code>) <code>FileCreateDate</code> Redundant (in <code>timestamps</code>) <code>FileAttributes</code> OS-specific <code>FileDeviceNumber</code> OS-specific <code>FileInodeNumber</code> OS-specific <code>FileHardLinks</code> OS-specific <code>FileUserID</code> OS-specific <code>FileGroupID</code> OS-specific <code>FileDeviceID</code> OS-specific <code>FileBlockSize</code> OS-specific <code>FileBlockCount</code> OS-specific <p>All embedded metadata keys (e.g. <code>File:FileType</code>, <code>File:MIMEType</code>, <code>QuickTime:*</code>, <code>Composite:*</code>) are preserved.</p>"},{"location":"user-guide/configuration/#override-and-merging-behavior","title":"Override and Merging Behavior","text":""},{"location":"user-guide/configuration/#scalar-fields-last-writer-wins","title":"Scalar fields: last-writer-wins","text":"<p>The highest-priority layer that specifies a value wins. Omitted fields in a configuration file preserve the value from the layer below (ultimately the compiled default).</p>"},{"location":"user-guide/configuration/#collection-fields-replace-by-default-append-on-request","title":"Collection fields: replace by default, append on request","text":"<p>Collection fields (lists and sets) use two strategies depending on the key name:</p> Config key Behavior <code>exclude_extensions = [...]</code> Replace \u2014 the specified list becomes the complete set. <code>exclude_extensions_append = [...]</code> Append \u2014 entries are added to the existing set. <p>This convention applies to all collection fields: <code>filesystem_excludes.names</code>, <code>filesystem_excludes.globs</code>, <code>exiftool.exclude_extensions</code>, <code>exiftool.exclude_keys</code>, <code>exiftool.base_args</code>, <code>metadata_exclude.patterns</code>, and <code>extension_groups.*</code>.</p>"},{"location":"user-guide/configuration/#unknown-fields","title":"Unknown fields","text":"<p>Unrecognized keys in configuration files are logged as a warning and ignored. They are not fatal errors, which allows forward compatibility when older tool versions encounter config files written for newer versions.</p>"},{"location":"user-guide/configuration/#parameter-implications","title":"Parameter Implications","text":"<p>Certain configuration values automatically enable dependent settings:</p> If this is <code>true</code>... ...then this is forced to <code>true</code> <code>rename.enabled</code> <code>output.inplace</code> <code>metadata.meta_merge_delete</code> <code>metadata.meta_merge</code> <code>metadata.meta_merge</code> <code>metadata.extract_exif</code> <p>These implications are applied during configuration construction, after all layers are merged. The CLI logs the activated implications at <code>INFO</code> level when verbose output is enabled.</p>"},{"location":"user-guide/configuration/#validation-rules","title":"Validation Rules","text":"<p>The configuration loader validates the fully-resolved configuration before returning:</p> <ol> <li>MetaMergeDelete safety: If <code>meta_merge_delete</code> is <code>true</code>, at least one of <code>output.file</code> or <code>output.inplace</code> must also be <code>true</code>.</li> <li>ID type validity: <code>id_algorithm</code> must be either <code>\"md5\"</code> or <code>\"sha256\"</code>.</li> <li>Regex compilation: All regex strings in the metadata identification and exclusion pattern lists must compile without error.</li> <li>Path conflicts: If <code>output.file</code> is specified, it must not point inside the target directory when <code>output.inplace</code> is also active.</li> </ol> <p>Validation failures produce a fatal <code>IndexerConfigError</code> (CLI exit code 2).</p>"},{"location":"user-guide/gui/","title":"Desktop Application Guide","text":"<p>The shruggie-indexer desktop application provides a visual interface for indexing files and folders, extracting metadata, and managing sidecar files \u2014 all without touching a command line. This guide walks you through every part of the application.</p>"},{"location":"user-guide/gui/#launching-the-application","title":"Launching the Application","text":"<p>How you start the application depends on how you installed it.</p>"},{"location":"user-guide/gui/#standalone-executable-recommended-for-most-users","title":"Standalone Executable (Recommended for Most Users)","text":"<p>Download the pre-built executable for your platform from the GitHub Releases page. No Python installation is required.</p> <ul> <li>Windows: Run <code>shruggie-indexer-gui.exe</code></li> <li>Linux: Run <code>./shruggie-indexer-gui</code></li> <li>macOS: Run <code>./shruggie-indexer-gui</code></li> </ul>"},{"location":"user-guide/gui/#installed-via-pip","title":"Installed via pip","text":"<p>If you installed shruggie-indexer with the GUI extra (<code>pip install shruggie-indexer[gui]</code>), launch it from a terminal:</p> <pre><code>shruggie-indexer-gui\n</code></pre> <p>Windows SmartScreen Warning</p> <p>When running the standalone executable on Windows for the first time, you may see a \"Windows protected your PC\" popup from Microsoft Defender SmartScreen. This is normal for applications that have not yet accumulated a reputation with Microsoft's cloud-based trust system. It does not mean the application is harmful.</p> <p>To proceed:</p> <ol> <li>Click \"More info\" in the SmartScreen dialog.</li> <li>Click \"Run anyway\".</li> </ol> <p>This only needs to be done once. After the first launch, Windows remembers your choice and will not show the warning again.</p> <p>Why does this happen? SmartScreen flags executables that are new or not digitally signed by a recognized certificate authority. Because shruggie-indexer is an open-source project, it does not carry a commercial code-signing certificate. You can verify the download's integrity by checking its SHA-256 hash against the value published on the GitHub release page.</p>"},{"location":"user-guide/gui/#window-layout","title":"Window Layout","text":"<p>The application window is divided into three areas:</p> <ol> <li>Sidebar (left) \u2014 Navigation between the three main tabs: Operations, Settings, and About. The application version is displayed at the bottom of the sidebar.</li> <li>Main content area (center/right) \u2014 Changes depending on which sidebar tab is selected.</li> <li>Output panel (bottom) \u2014 Displays results and log messages after an operation finishes. This panel is only visible on the Operations tab.</li> </ol>"},{"location":"user-guide/gui/#operations-tab","title":"Operations Tab","text":"<p>The Operations tab is where you configure and run indexing jobs. It is organized into labeled sections.</p>"},{"location":"user-guide/gui/#choosing-an-operation-type","title":"Choosing an Operation Type","text":"<p>At the top of the Operations tab, a dropdown lets you choose one of three operation types:</p> Operation What it does Destructive? Index Scans files or folders and produces a structured JSON report containing hashes, timestamps, sizes, and (optionally) embedded metadata. Nothing on disk is changed. No Meta Merge Same as Index, but also discovers sidecar files (small companion files that sit alongside your media) and merges their contents into the report. Original files are untouched. No Meta Merge Delete Same as Meta Merge, but deletes the sidecar files from disk after merging them into the report. The merged data is preserved in the output file. Yes <p>Pipeline execution order</p> <p>When Meta Merge Delete runs, the pipeline proceeds in a fixed order:</p> <ol> <li>Index \u2014 Discover and process all items; sidecar files are identified, parsed, and queued for deletion.</li> <li>Write sidecars \u2014 In-place <code>_meta2.json</code> and <code>_directorymeta2.json</code> output files are written alongside each item (if multi-file output is selected).</li> <li>Rename \u2014 Files are renamed to their <code>storage_name</code> values (if rename is enabled). In-place sidecar files are renamed alongside their content files.</li> <li>Delete \u2014 Consumed sidecar files are removed from disk. Each deletion is logged.</li> </ol> <p>If the operation is cancelled, steps that have not yet started are skipped. In particular, the delete step is never reached if the operation is interrupted \u2014 no sidecar files are deleted until all preceding steps complete successfully.</p> <p>A small colored dot next to the dropdown indicates whether the current configuration is destructive (red) or non-destructive (green). This indicator updates in real time as you change settings \u2014 including when the rename feature is toggled (see Options Section below).</p>"},{"location":"user-guide/gui/#target-section","title":"Target Section","text":"<p>This is where you tell the application what to process.</p> <ul> <li>Path field \u2014 Type or paste a file or folder path, or use the Browse buttons to pick one.</li> <li>Browse buttons \u2014 When the target type is set to \"Auto\", two buttons appear: File\u2026 and Folder\u2026, letting you pick either. When the type is set to \"File\" or \"Directory\", a single Browse button appears.</li> <li>Type \u2014 Choose how the target path should be interpreted:<ul> <li>Auto \u2014 The application figures out whether the path is a file or folder.</li> <li>File \u2014 Treat the path as a single file.</li> <li>Directory \u2014 Treat the path as a folder (processes all items inside).</li> </ul> </li> <li>Recursive \u2014 When checked (the default), subfolders are also processed. Uncheck this to process only the top-level contents of a folder. This option is automatically disabled when the target type is \"File\" (recursion has no meaning for single files).</li> </ul> <p>Target/Type Validation</p> <p>The application automatically detects whether the selected path is a file or directory. If the detected kind conflicts with the selected type (e.g., you select \"File\" type but point to a directory), a red error message appears below the type selector and the START button is disabled until the conflict is resolved.</p>"},{"location":"user-guide/gui/#options-section","title":"Options Section","text":"<p>All option controls are always visible regardless of the selected operation type. Controls that do not apply to the current operation are disabled with a brief explanation.</p> <ul> <li>ID Algorithm \u2014 Choose between <code>md5</code> (faster, shorter IDs) and <code>sha256</code> (stronger, longer IDs). This controls how file identifiers are generated.</li> <li>Compute SHA-512 \u2014 When checked, an additional high-strength hash is computed for each file. If the \"Compute SHA-512 by default\" setting is enabled on the Settings tab, this checkbox is forced on with an explanation (\"Enabled in Settings\") and cannot be unchecked from the Operations tab.</li> <li>Extract EXIF metadata \u2014 When checked, embedded metadata (camera settings, GPS coordinates, creation dates, etc.) is extracted from media files using ExifTool. Requires ExifTool to be installed. Automatically forced on for Meta Merge and Meta Merge Delete operations.</li> <li>Rename files \u2014 When checked, files are renamed to unique, content-based names (\"storage names\") after indexing. This feature can be combined with any operation type. Enabling rename makes the operation destructive (the indicator dot turns red) unless dry-run is also enabled.</li> <li>Dry run \u2014 Only shown when \"Rename files\" is checked. When enabled, previews what files would be renamed without actually changing anything. This is on by default as a safety measure.</li> </ul>"},{"location":"user-guide/gui/#output-section","title":"Output Section","text":"<p>The Output section uses a dropdown menu to select where results are written:</p> <ul> <li>Output mode (dropdown):<ul> <li>Single file \u2014 All results are written to one aggregate JSON file. The file path is shown in a read-only display below the dropdown.</li> <li>Multi-file \u2014 Results are written as individual sidecar JSON files alongside each processed file (e.g., <code>photo.jpg_meta2.json</code>). Only available when the target is a directory.</li> <li>View only \u2014 Results are displayed in the output panel at the bottom of the window. Nothing is written to disk. Not available for Meta Merge Delete operations.</li> </ul> </li> <li>Output path \u2014 A read-only field showing the auto-computed output path based on your target. For \"View only\" mode, this displays \"(displayed in viewer)\". For \"Multi-file\" mode, a note explains that sidecar files are written alongside originals.</li> </ul> <p>Output mode constraints</p> <p>The available modes adjust automatically based on your target and operation type:</p> <ul> <li>Multi-file requires a directory target (not available for single files).</li> <li>View only is not available for Meta Merge Delete (which must write output to preserve data before deleting sidecars).</li> <li>Rename forces Multi-file mode (renamed files need per-item sidecar output).</li> </ul>"},{"location":"user-guide/gui/#running-an-operation","title":"Running an Operation","text":"<p>Once everything is configured, click the green \u25b6  START button at the bottom of the Operations area. The button is centered and uses a distinct green color to differentiate it from other controls.</p> <p>Validation Required</p> <p>The START button is disabled if the target path is empty or if a target/type conflict exists. Resolve any red error messages before running.</p> <p>While the operation runs:</p> <ul> <li>A progress panel replaces the output area, showing:<ul> <li>Current status (\"Discovering items\u2026\", \"Processing: 5/12 (42%)\")</li> <li>Elapsed time</li> <li>A progress bar</li> <li>The file currently being processed</li> <li>A scrolling log of activity</li> </ul> </li> <li>The action button changes to a red \u25a0 Cancel button. Click it (or press ++escape++) to stop the operation after the current file finishes.</li> <li>All input controls on the Operations tab are disabled during execution.</li> </ul> <p>When the operation completes, the progress panel disappears and the output panel shows the results.</p>"},{"location":"user-guide/gui/#output-panel","title":"Output Panel","text":"<p>The output panel appears at the bottom of the Operations tab after a job finishes. It has two views, switchable via toggle buttons in the toolbar:</p> <ul> <li>Output \u2014 The JSON result data, with color-coded syntax highlighting for readability.</li> <li>Log \u2014 Messages generated during the operation (progress updates, warnings, errors).</li> </ul>"},{"location":"user-guide/gui/#toolbar-buttons","title":"Toolbar Buttons","text":"Button What it does Save Opens a file picker to save the current JSON output to disk. Copy Copies the currently visible content (output or log) to the clipboard. The button briefly turns green and shows \"Copied \u2713\" to confirm. Clear Clears both the output and log content."},{"location":"user-guide/gui/#resizing","title":"Resizing","text":"<p>You can drag the top edge of the output panel up or down to resize it. The application remembers your preferred size between sessions.</p>"},{"location":"user-guide/gui/#settings-tab","title":"Settings Tab","text":"<p>The Settings tab lets you customize default behavior. Changes take effect immediately and are remembered between sessions.</p>"},{"location":"user-guide/gui/#indexing-defaults","title":"Indexing Defaults","text":"<ul> <li>Default ID Algorithm \u2014 Sets the default hash algorithm (<code>md5</code> or <code>sha256</code>) for new operations.</li> <li>Compute SHA-512 by default \u2014 When checked, SHA-512 computation is enabled by default for new operations.</li> </ul>"},{"location":"user-guide/gui/#output-preferences","title":"Output Preferences","text":"<ul> <li>JSON Indentation \u2014 Controls formatting of the JSON output:<ul> <li>2 spaces \u2014 Compact but readable (default).</li> <li>4 spaces \u2014 More spacious, easier to scan visually.</li> <li>Compact \u2014 No extra whitespace. Smaller file sizes but harder to read.</li> </ul> </li> </ul>"},{"location":"user-guide/gui/#logging","title":"Logging","text":"<ul> <li>Verbosity \u2014 Controls how much detail appears in the log view:<ul> <li>Normal \u2014 Shows only warnings and errors.</li> <li>Verbose \u2014 Adds informational messages about each processing step.</li> <li>Debug \u2014 Maximum detail, including per-file processing events, hash computation, ExifTool calls, and sidecar discovery. Useful for troubleshooting.</li> </ul> </li> </ul>"},{"location":"user-guide/gui/#interface","title":"Interface","text":"<ul> <li>Show tooltips on hover \u2014 When checked, hovering over any control shows a brief description of what it does. Uncheck to hide all tooltips.</li> </ul>"},{"location":"user-guide/gui/#configuration","title":"Configuration","text":"<ul> <li>Config File \u2014 Optionally specify a TOML configuration file to load custom settings. Use the Browse button to pick one.</li> <li>Reset to Defaults \u2014 Resets all settings to their factory values (asks for confirmation first).</li> <li>Open Config Folder \u2014 Opens the folder where the application stores its session data.</li> </ul>"},{"location":"user-guide/gui/#about-tab","title":"About Tab","text":"<p>The About tab displays:</p> <ul> <li>Project name, description, and version number.</li> <li>Python version and ExifTool availability status.</li> <li>A Documentation button that opens this documentation site in your web browser.</li> <li>A shruggie.tech button that opens the developer's website.</li> <li>Attribution: \"Built by ShruggieTech LLC\".</li> </ul>"},{"location":"user-guide/gui/#keyboard-shortcuts","title":"Keyboard Shortcuts","text":"<p>The application supports the following keyboard shortcuts:</p> Shortcut Action ++ctrl+r++ Run the current operation ++ctrl+s++ Save output to a file ++ctrl+shift+c++ Copy current output or log to the clipboard ++ctrl+period++ Cancel the running operation ++escape++ Cancel the running operation ++ctrl+q++ Quit the application ++ctrl+comma++ Switch to Settings tab ++ctrl+1++ Switch to Operations tab ++ctrl+2++ Switch to Settings tab ++ctrl+3++ Switch to About tab"},{"location":"user-guide/gui/#session-persistence","title":"Session Persistence","text":"<p>The application automatically saves your window size, position, selected tab, operation settings, and output panel height when you close it. The next time you open the application, everything is restored to where you left off.</p> <p>Session data is stored in your operating system's standard configuration directory:</p> Platform Location Windows <code>%APPDATA%\\shruggie-indexer\\gui-session.json</code> macOS <code>~/Library/Application Support/shruggie-indexer/gui-session.json</code> Linux <code>~/.config/shruggie-indexer/gui-session.json</code> <p>If the session file is missing or becomes corrupted, the application starts with default settings.</p>"},{"location":"user-guide/gui/#tips-and-troubleshooting","title":"Tips and Troubleshooting","text":""},{"location":"user-guide/gui/#exiftool-is-not-detected","title":"ExifTool Is Not Detected","text":"<p>If the About tab shows \"ExifTool: Not found\", metadata extraction will be unavailable. Install ExifTool and make sure it is on your system PATH. See the ExifTool Setup guide for instructions.</p>"},{"location":"user-guide/gui/#large-directories-are-slow","title":"Large Directories Are Slow","text":"<p>When indexing directories with thousands of files, the initial discovery phase may take a moment. The progress bar will be indeterminate (animated) during discovery, then switch to a percentage-based bar once processing begins. You can cancel at any time.</p>"},{"location":"user-guide/gui/#output-is-too-large-to-display","title":"Output Is Too Large to Display","text":"<p>If the JSON output exceeds 10 MB, the output panel will show a \"too large to display\" message and prompt you to save the results to a file instead. Use the Save button or switch the output mode to \"Single file\" before running.</p>"},{"location":"user-guide/gui/#application-appears-frozen","title":"Application Appears Frozen","text":"<p>Long-running operations process files one at a time in the background. The interface should remain responsive. If you see no progress updates, check the log view for error messages. You can always cancel with ++escape++ or the Cancel button.</p>"},{"location":"user-guide/gui/#to-do","title":"To Do","text":"<p>Screenshots Needed</p> <p>This page requires annotated screenshots of the GUI application to illustrate the interface elements described above. Screenshots should cover:</p> <ul> <li>The Operations page in idle state</li> <li>The Operations page during an active indexing run (progress bar, log stream)</li> <li>The Settings page</li> <li>The About page</li> <li>The output panel showing JSON output and log view</li> <li>A destructive operation confirmation dialog</li> </ul> <p>Screenshot assets will be stored in <code>docs/assets/images/gui/</code>.</p>"},{"location":"user-guide/platform-notes/","title":"Platform Notes","text":"<p>shruggie-indexer runs on Windows, Linux, and macOS from a single codebase. This page documents platform-specific behaviors, filesystem differences, and the strategies used to produce consistent output across operating systems.</p>"},{"location":"user-guide/platform-notes/#cross-platform-design-principles","title":"Cross-Platform Design Principles","text":"<p>Five principles govern how the tool handles platform portability:</p> Principle Summary P1 \u2014 No platform branches in core The <code>core/</code> and <code>config/</code> packages contain no <code>if sys.platform</code> checks. All platform variation is absorbed by Python standard library abstractions (<code>pathlib</code>, <code>os.stat</code>, <code>hashlib</code>). Entry points (<code>cli/</code>, <code>gui/</code>) may contain platform adjustments for presentation. P2 \u2014 Output determinism For identical file content, <code>id</code>, <code>hashes</code>, <code>name</code>, <code>size</code>, <code>extension</code>, and <code>storage_name</code> are identical across platforms. Inherently platform-dependent fields (<code>timestamps</code>, <code>file_system.absolute</code>, <code>attributes.is_link</code>) may vary. P3 \u2014 Forward-slash normalization <code>file_system.relative</code> always uses <code>/</code> separators. <code>file_system.absolute</code> retains the platform-native separator (<code>\\</code> on Windows, <code>/</code> elsewhere). P4 \u2014 Graceful degradation When a platform lacks a feature (e.g., creation time on older Linux kernels), the nearest available approximation is used. No <code>null</code> values due to platform limitations. P5 \u2014 Test once, verify everywhere Platform-specific tests use pytest markers (<code>@pytest.mark.platform_windows</code>, etc.) and run on each OS in CI."},{"location":"user-guide/platform-notes/#path-separator-convention","title":"Path Separator Convention","text":"Output field Separator Rationale <code>file_system.relative</code> Always <code>/</code> Portable relative paths for cross-platform index consumption. <code>file_system.absolute</code> Platform-native Usable as a local filesystem reference on the originating platform. <code>parent.name</code> N/A (leaf name) Single directory name component \u2014 no separators. <code>name.text</code> N/A (leaf name) Single filename component \u2014 no separators."},{"location":"user-guide/platform-notes/#windows","title":"Windows","text":""},{"location":"user-guide/platform-notes/#path-handling","title":"Path handling","text":"<p>Windows uses backslash (<code>\\</code>) as the native separator. The tool uses <code>pathlib.Path</code> for all path operations, eliminating manual separator management entirely. No code references <code>os.sep</code> for path construction.</p>"},{"location":"user-guide/platform-notes/#long-path-support","title":"Long path support","text":"Regime Maximum length Applies when Legacy (Win32) 260 characters Default before Windows 10 1607 Extended 32,767 characters Windows 10 1607+ with <code>LongPathsEnabled</code>, or <code>\\\\?\\</code> prefix <p>Python 3.6+ on Windows automatically uses extended-length paths. The tool relies on this built-in support. If path-length errors occur on older configurations, enable <code>LongPathsEnabled</code> in the Windows registry.</p>"},{"location":"user-guide/platform-notes/#unc-paths","title":"UNC paths","text":"<p>Universal Naming Convention paths (<code>\\\\server\\share\\path</code>) are valid input targets. They flow through path resolution without special handling. On Linux and macOS, CIFS/SMB mounts appear as local paths (e.g., <code>/mnt/share/folder</code>).</p>"},{"location":"user-guide/platform-notes/#case-sensitivity","title":"Case sensitivity","text":"<p>NTFS is case-preserving but case-insensitive by default. The tool uses case-insensitive comparison for filesystem exclusion matching on all platforms \u2014 this is correct for Windows and conservative for case-sensitive Linux filesystems.</p>"},{"location":"user-guide/platform-notes/#console-encoding","title":"Console encoding","text":"<p>The CLI entry point sets console output to UTF-8 on Windows to ensure correct display of non-ASCII filenames. This is one of the permitted entry-point platform adjustments (Principle P1 exception).</p>"},{"location":"user-guide/platform-notes/#performance-note","title":"Performance note","text":"<p>On systems with real-time antivirus scanning (Windows Defender), file open operations during hashing may trigger per-file scanning, increasing indexing time for large trees. Consider excluding the target directory from real-time scanning during indexing if performance is a concern.</p>"},{"location":"user-guide/platform-notes/#linux","title":"Linux","text":""},{"location":"user-guide/platform-notes/#filesystem-diversity","title":"Filesystem diversity","text":"<p>Linux supports many filesystem types with varying capabilities:</p> Filesystem Creation time (<code>st_birthtime</code>) Case sensitivity ext4 Kernel 4.11+ via <code>statx</code>; Python 3.12+ Case-sensitive XFS Kernel 4.11+ via <code>statx</code> Case-sensitive Btrfs Kernel 4.11+ via <code>statx</code> Case-sensitive tmpfs Not available Case-sensitive NFS Depends on server Depends on server FAT32/exFAT Not available Case-insensitive <p>The tool does not detect the underlying filesystem type. It uses the uniform <code>os.stat()</code> interface and relies on the kernel to provide available attributes.</p>"},{"location":"user-guide/platform-notes/#access-time-caveat","title":"Access time caveat","text":"<p>The default <code>relatime</code> mount option (standard since ~2009) only updates <code>atime</code> when the previous access time is older than the modification time. The <code>accessed</code> timestamp in the output reflects whatever <code>os.stat()</code> provides, without attempting to validate accuracy.</p>"},{"location":"user-guide/platform-notes/#file-permissions","title":"File permissions","text":"<p>The tool requires read permission on every file it hashes and every directory it traverses. A <code>PermissionError</code> during hashing or enumeration results in the item being included with degraded fields (<code>null</code> hashes, empty <code>items</code> list), and a warning is logged.</p>"},{"location":"user-guide/platform-notes/#macos","title":"macOS","text":""},{"location":"user-guide/platform-notes/#filesystems","title":"Filesystems","text":"Filesystem Creation time Case sensitivity Unicode normalization APFS <code>st_birthtime</code> (always available) Case-insensitive (default) Preserves original form HFS+ <code>st_birthtime</code> (always available) Case-insensitive (default) Normalizes to NFD on storage"},{"location":"user-guide/platform-notes/#unicode-normalization","title":"Unicode normalization","text":"<p>HFS+ normalizes filenames to Unicode NFD (decomposed form) on storage. A file created as <code>caf\u00e9.txt</code> (NFC) is stored as <code>caf\u00e9.txt</code> (NFD, <code>e</code> + combining accent).</p> <p>To ensure cross-platform hash determinism, the tool applies <code>unicodedata.normalize('NFC', value)</code> unconditionally on all platforms before encoding filenames to UTF-8 for hashing. This guarantees that a file named <code>caf\u00e9.txt</code> produces identical identity hashes regardless of the filesystem's normalization behavior.</p> <p>NFC Normalization</p> <p>NFC normalization is applied on all platforms \u2014 not just macOS \u2014 because the goal is cross-platform determinism: the same logical filename produces the same hash everywhere.</p>"},{"location":"user-guide/platform-notes/#system-exclusions","title":"System exclusions","text":"<p>The following macOS system artifacts are excluded by default:</p> <p><code>.DS_Store</code>, <code>.Spotlight-V100</code>, <code>.Trashes</code>, <code>.fseventsd</code>, <code>.TemporaryItems</code>, <code>.DocumentRevisions-V100</code></p> <p>Extended attributes (<code>com.apple.quarantine</code>, Finder tags) are not read by the tool and do not affect indexed fields.</p>"},{"location":"user-guide/platform-notes/#creation-time-portability","title":"Creation Time Portability","text":"<p>Creation time is the most significant cross-platform behavioral difference that surfaces in the output.</p>"},{"location":"user-guide/platform-notes/#availability-matrix","title":"Availability matrix","text":"Platform Python attribute Reliability Windows (NTFS) <code>st_birthtime</code> (3.12+) or <code>st_ctime</code> Always available. On Windows, <code>st_ctime</code> maps to NTFS creation time. macOS (APFS/HFS+) <code>st_birthtime</code> Always available. Linux (kernel 4.11+, ext4/XFS/Btrfs) <code>st_birthtime</code> (Python 3.12+) Available when the kernel supports <code>statx</code> and the filesystem records birth time. Linux (older kernels, tmpfs, NFS) Not available <code>st_birthtime</code> raises <code>AttributeError</code>. Fallback to <code>st_ctime</code>."},{"location":"user-guide/platform-notes/#resolution-strategy","title":"Resolution strategy","text":"<p>The implementation tries <code>st_birthtime</code> first and falls back to <code>st_ctime</code> without platform branching:</p> <pre><code>def _get_creation_time(stat_result: os.stat_result) -&gt; float:\n    try:\n        return stat_result.st_birthtime\n    except AttributeError:\n        return stat_result.st_ctime\n</code></pre> <p>A debug-level log message is emitted on the first fallback occurrence per invocation.</p>"},{"location":"user-guide/platform-notes/#fallback-semantics","title":"Fallback semantics","text":"<p>When <code>st_ctime</code> is used as the fallback, the meaning differs by platform:</p> Platform <code>st_ctime</code> meaning Windows NTFS creation time (identical \u2014 not a true fallback) Linux Inode change time \u2014 updates on <code>chmod</code>, <code>chown</code>, hard link changes macOS Inode change time (rare \u2014 <code>st_birthtime</code> is always available) <p>For most media files and documents (created once, metadata rarely changed), <code>st_ctime</code> on Linux is a good approximation. The most visible deviation is for files that have undergone <code>chmod</code> or <code>chown</code> operations.</p> <p>The <code>timestamps.created</code> field is never <code>null</code> due to platform limitations \u2014 it always contains either the true creation time or the best available approximation.</p>"},{"location":"user-guide/platform-notes/#symlink-handling","title":"Symlink Handling","text":""},{"location":"user-guide/platform-notes/#detection","title":"Detection","text":"<p>Symlinks are detected via <code>Path.is_symlink()</code>, which delegates to the platform-appropriate mechanism:</p> Platform Mechanism Windows <code>FILE_ATTRIBUTE_REPARSE_POINT</code> via <code>GetFileAttributesW</code> Linux / macOS <code>lstat()</code> checks <code>S_IFLNK</code> in <code>st_mode</code> <p>On Windows, both symbolic links and junction points are detected as symlinks (Python 3.12+).</p>"},{"location":"user-guide/platform-notes/#behavioral-changes-for-symlinks","title":"Behavioral changes for symlinks","text":"<p>When a symlink is detected:</p> <ul> <li><code>attributes.is_link</code> is set to <code>true</code></li> <li>Content hashing is replaced by name hashing</li> <li>EXIF extraction is skipped</li> <li><code>os.lstat()</code> is used for timestamps (symlink's own timestamps, not the target's)</li> <li>Directory symlinks are not descended into during traversal (prevents symlink loops)</li> </ul>"},{"location":"user-guide/platform-notes/#size-field-for-symlinks","title":"Size field for symlinks","text":"Platform <code>lstat().st_size</code> for a symlink Windows 0 (reparse points report zero size) Linux / macOS Length of the target path string in bytes <p>Warning</p> <p>Do not rely on the <code>size</code> field for symlinks \u2014 it does not represent the target file's size.</p>"},{"location":"user-guide/platform-notes/#dangling-symlinks","title":"Dangling symlinks","text":"<p>If a symlink target does not exist, <code>Path.resolve(strict=False)</code> returns the normalized path without verifying existence. The entry is populated with degraded fields.</p>"},{"location":"user-guide/platform-notes/#filesystem-behavior-summary","title":"Filesystem Behavior Summary","text":"Behavior Windows (NTFS) Linux (ext4) macOS (APFS) Path separator <code>\\</code> <code>/</code> <code>/</code> Case sensitivity Case-insensitive Case-sensitive Case-insensitive (default) Creation time Always available Kernel 4.11+ / Python 3.12+ Always available Max filename 255 UTF-16 code units 255 bytes 255 UTF-8 bytes Max path 32,767 (extended) ~4,096 (PATH_MAX) No fixed limit Unicode normalization NFC (Windows standard) Preserves original NFD (HFS+) / original (APFS) Symlink creation privilege Admin or Developer Mode None None Atomic rename Same volume (NTFS) Same filesystem Same filesystem Hidden files NTFS attribute Dot-prefix convention Dot-prefix convention"},{"location":"user-guide/python-api/","title":"Python API","text":"<p>shruggie-indexer exposes a public Python API for consumers who <code>import shruggie_indexer</code> as a library rather than invoking it from the command line. The CLI and GUI are both consumers of this API \u2014 they add no indexing logic of their own.</p>"},{"location":"user-guide/python-api/#public-api-surface","title":"Public API Surface","text":"<p>All public names are exported from the top-level <code>shruggie_indexer</code> namespace. Internal modules (<code>core/</code>, <code>config/</code>, <code>models/</code>) are implementation details \u2014 import from the top-level package, not from subpackages.</p> <pre><code>from shruggie_indexer import (\n    # Version\n    __version__,\n    # Configuration\n    load_config,\n    IndexerConfig,\n    MetadataTypeAttributes,\n    # Core functions\n    index_path,\n    build_file_entry,\n    build_directory_entry,\n    serialize_entry,\n    # Progress and cancellation\n    ProgressEvent,\n    IndexerCancellationError,\n    # Data models\n    IndexEntry,\n    MetadataEntry,\n    HashSet,\n    NameObject,\n    SizeObject,\n    TimestampPair,\n    TimestampsObject,\n    ParentObject,\n)\n</code></pre> <p>Names not listed in <code>__all__</code> are internal and may change without notice between versions.</p> <p>API Stability</p> <p>For the v0.1.0 release the public API is provisional. Breaking changes may occur in minor version bumps (0.2.0, 0.3.0) without a deprecation cycle. Once the project reaches 1.0.0, the public API becomes subject to semantic versioning.</p>"},{"location":"user-guide/python-api/#core-functions","title":"Core Functions","text":""},{"location":"user-guide/python-api/#index_path","title":"<code>index_path()</code>","text":"<p>The top-level entry point. Given a filesystem path and a configuration, produces a complete <code>IndexEntry</code>.</p> <pre><code>def index_path(\n    target: Path | str,\n    config: IndexerConfig | None = None,\n    *,\n    progress_callback: Callable[[ProgressEvent], None] | None = None,\n    cancel_event: threading.Event | None = None,\n) -&gt; IndexEntry: ...\n</code></pre> Parameter Type Description <code>target</code> <code>Path \\| str</code> Path to index. Strings are converted to <code>Path</code> objects. Relative paths resolve against the current working directory. <code>config</code> <code>IndexerConfig \\| None</code> Resolved configuration. When <code>None</code>, compiled defaults are used (equivalent to <code>load_config()</code> with no arguments). <code>progress_callback</code> <code>Callable[[ProgressEvent], None] \\| None</code> Called after each item is processed during directory traversal. Must be non-blocking. Ignored for single-file targets. <code>cancel_event</code> <code>threading.Event \\| None</code> Checked between items during directory traversal. When set, raises <code>IndexerCancellationError</code>. Ignored for single-file targets. <p>Returns: A fully populated <code>IndexEntry</code> conforming to the v2 schema.</p> <p>Raises:</p> Exception Condition <code>IndexerTargetError</code> Target path does not exist, is not accessible, or is neither a file nor a directory. <code>IndexerConfigError</code> Configuration is invalid (only when <code>config=None</code> triggers internal construction). <code>IndexerRuntimeError</code> Unrecoverable error during processing. <code>IndexerCancellationError</code> The <code>cancel_event</code> was set during processing."},{"location":"user-guide/python-api/#build_file_entry","title":"<code>build_file_entry()</code>","text":"<p>Builds an <code>IndexEntry</code> for a single file. This is the lower-level function that <code>index_path()</code> dispatches to when the target is a file.</p> <pre><code>def build_file_entry(\n    path: Path,\n    config: IndexerConfig,\n    *,\n    siblings: list[Path] | None = None,\n    delete_queue: list[Path] | None = None,\n) -&gt; IndexEntry: ...\n</code></pre> Parameter Type Description <code>path</code> <code>Path</code> Absolute path to the file. <code>config</code> <code>IndexerConfig</code> Resolved configuration. <code>siblings</code> <code>list[Path] \\| None</code> Pre-enumerated sibling files for sidecar discovery. When <code>None</code>, the parent directory is enumerated on demand. <code>delete_queue</code> <code>list[Path] \\| None</code> When MetaMergeDelete is active, sidecar paths are appended here for deferred deletion by the caller."},{"location":"user-guide/python-api/#build_directory_entry","title":"<code>build_directory_entry()</code>","text":"<p>Builds an <code>IndexEntry</code> for a directory, optionally recursing into subdirectories.</p> <pre><code>def build_directory_entry(\n    path: Path,\n    config: IndexerConfig,\n    *,\n    recursive: bool = False,\n    delete_queue: list[Path] | None = None,\n    progress_callback: Callable[[ProgressEvent], None] | None = None,\n    cancel_event: threading.Event | None = None,\n) -&gt; IndexEntry: ...\n</code></pre> Parameter Type Description <code>path</code> <code>Path</code> Absolute path to the directory. <code>config</code> <code>IndexerConfig</code> Resolved configuration. <code>recursive</code> <code>bool</code> Descend into subdirectories when <code>True</code>. <code>delete_queue</code> <code>list[Path] \\| None</code> MetaMergeDelete accumulator. <code>progress_callback</code> <code>Callable \\| None</code> Progress callback forwarded through recursive calls. <code>cancel_event</code> <code>threading.Event \\| None</code> Cancellation event forwarded through recursive calls."},{"location":"user-guide/python-api/#serialize_entry","title":"<code>serialize_entry()</code>","text":"<p>Converts an <code>IndexEntry</code> to a JSON string conforming to the v2 schema.</p> <pre><code>def serialize_entry(\n    entry: IndexEntry,\n    *,\n    indent: int | None = 2,\n    sort_keys: bool = False,\n) -&gt; str: ...\n</code></pre> Parameter Type Default Description <code>entry</code> <code>IndexEntry</code> \u2014 The entry to serialize. <code>indent</code> <code>int \\| None</code> <code>2</code> Indentation level. <code>None</code> produces compact single-line JSON. <code>sort_keys</code> <code>bool</code> <code>False</code> Sort keys alphabetically. Default preserves schema-defined field order. <p>Serialization invariants enforced by this function:</p> <ul> <li><code>schema_version</code> appears first in the output (when <code>sort_keys=False</code>)</li> <li>Required fields are always present</li> <li><code>HashSet.sha512</code> is omitted when not computed (not emitted as <code>null</code>)</li> <li>All hash hex strings are uppercase</li> </ul>"},{"location":"user-guide/python-api/#configuration-api","title":"Configuration API","text":""},{"location":"user-guide/python-api/#load_config","title":"<code>load_config()</code>","text":"<p>The sole factory function for <code>IndexerConfig</code> objects. Implements the full four-layer resolution pipeline.</p> <pre><code>def load_config(\n    *,\n    config_file: Path | str | None = None,\n    target_directory: Path | str | None = None,\n    overrides: dict[str, Any] | None = None,\n) -&gt; IndexerConfig: ...\n</code></pre> Parameter Type Description <code>config_file</code> <code>Path \\| str \\| None</code> Explicit TOML config file. Replaces platform-standard user config resolution. <code>target_directory</code> <code>Path \\| str \\| None</code> Directory being indexed. Used to search for project-local <code>.shruggie-indexer.toml</code>. <code>overrides</code> <code>dict[str, Any] \\| None</code> Highest-priority overrides. Keys are <code>IndexerConfig</code> field names; nested settings use dotted paths (e.g., <code>\"exiftool.exclude_extensions\"</code>). <p>After merging all layers, <code>load_config()</code> applies parameter implications, validates the result, compiles regex patterns, and returns an immutable <code>IndexerConfig</code>.</p> <pre><code># Example: SHA-256 with metadata extraction\nconfig = load_config(overrides={\n    \"id_algorithm\": \"sha256\",\n    \"extract_exif\": True,\n    \"recursive\": True,\n})\n</code></pre>"},{"location":"user-guide/python-api/#indexerconfig","title":"<code>IndexerConfig</code>","text":"<p>A frozen dataclass carrying all configuration for a single indexing invocation. Constructed via <code>load_config()</code> or directly for testing.</p> <pre><code>@dataclass(frozen=True)\nclass IndexerConfig:\n    \"\"\"Immutable configuration for a single indexing invocation.\"\"\"\n</code></pre> <p>The <code>frozen=True</code> guarantee means a single <code>IndexerConfig</code> can safely be shared across threads without synchronization. To create a modified copy:</p> <pre><code>from dataclasses import replace\nnew_config = replace(config, id_algorithm=\"sha256\")\n</code></pre> <p>Direct Construction</p> <p>Direct <code>IndexerConfig()</code> construction bypasses parameter implications and validation. Callers who construct directly must ensure implications are satisfied:</p> <ul> <li><code>rename=True</code> \u2192 <code>output_inplace=True</code></li> <li><code>meta_merge_delete=True</code> \u2192 <code>meta_merge=True</code></li> <li><code>meta_merge=True</code> \u2192 <code>extract_exif=True</code></li> </ul>"},{"location":"user-guide/python-api/#data-models","title":"Data Models","text":"<p>All data classes are defined in <code>models/schema.py</code> and map directly to the v2 JSON Schema types.</p>"},{"location":"user-guide/python-api/#indexentry","title":"<code>IndexEntry</code>","text":"<p>The root data class representing a single indexed file or directory.</p> <pre><code>@dataclass\nclass IndexEntry:\n    schema_version: int       # Always 2\n    id: str                   # Prefixed hash: y... (file), x... (directory)\n    id_algorithm: str         # \"md5\" or \"sha256\"\n    type: str                 # \"file\" or \"directory\"\n    name: NameObject\n    extension: str | None\n    size: SizeObject\n    hashes: HashSet | None    # Content hashes (file) or null (directory/symlink)\n    file_system: FileSystemObject\n    timestamps: TimestampsObject\n    attributes: AttributesObject\n    items: list[IndexEntry] | None = None\n    metadata: list[MetadataEntry] | None = None\n    mime_type: str | None = None\n</code></pre>"},{"location":"user-guide/python-api/#reusable-types","title":"Reusable types","text":"Class Fields Description <code>HashSet</code> <code>md5</code>, <code>sha256</code>, <code>sha512</code> (optional) Cryptographic hash digests. All hex strings are uppercase. <code>NameObject</code> <code>text</code>, <code>hashes</code> Name with associated hash digests. <code>text</code> and <code>hashes</code> are co-nullable. <code>SizeObject</code> <code>text</code>, <code>bytes</code> Human-readable and machine-readable size. <code>TimestampPair</code> <code>iso</code>, <code>unix</code> ISO 8601 string and Unix milliseconds. <code>TimestampsObject</code> <code>created</code>, <code>modified</code>, <code>accessed</code> Three standard filesystem timestamps, each a <code>TimestampPair</code>. <code>ParentObject</code> <code>id</code>, <code>name</code> Parent directory identity and name. <code>FileSystemObject</code> <code>relative</code>, <code>parent</code> Filesystem location with forward-slash relative path. <code>AttributesObject</code> <code>is_link</code>, <code>storage_name</code> Item attributes including symlink status and deterministic rename target. <code>MetadataEntry</code> <code>id</code>, <code>origin</code>, <code>name</code>, <code>hashes</code>, <code>attributes</code>, <code>data</code>, ... A single metadata record (sidecar or generated)."},{"location":"user-guide/python-api/#progressevent","title":"<code>ProgressEvent</code>","text":"<p>Lightweight event object emitted during directory indexing via the <code>progress_callback</code>.</p> <pre><code>@dataclass\nclass ProgressEvent:\n    phase: str               # \"discovery\", \"processing\", \"output\", \"cleanup\"\n    items_total: int | None  # None during discovery phase\n    items_completed: int     # Items processed so far\n    current_path: Path | None\n    message: str | None\n    level: str               # \"info\", \"warning\", \"error\", \"debug\"\n</code></pre> Phase Emitted when <code>items_total</code> <code>items_completed</code> <code>\"discovery\"</code> After directory enumeration <code>None</code> \u2192 count once complete <code>0</code> <code>\"processing\"</code> After each child entry is built Known count Incrementing <code>\"output\"</code> During serialization/output writing Final count Final count <code>\"cleanup\"</code> During MetaMergeDelete removal Final count Final count <p>Callback threading</p> <p>The callback is invoked on the indexing thread. GUI consumers should enqueue events into a <code>queue.Queue</code> for main-thread processing. CLI consumers using <code>tqdm</code> or <code>rich</code> can update progress bars directly (both are thread-safe for single-bar updates). If the callback raises an exception, the engine logs a warning and continues.</p>"},{"location":"user-guide/python-api/#exception-hierarchy","title":"Exception Hierarchy","text":"<p>All exceptions inherit from <code>IndexerError</code> for catch-all handling:</p> <pre><code>class IndexerError(Exception):\n    \"\"\"Base class for all shruggie-indexer exceptions.\"\"\"\n\nclass IndexerConfigError(IndexerError):\n    \"\"\"Configuration is invalid or cannot be loaded.\"\"\"\n\nclass IndexerTargetError(IndexerError):\n    \"\"\"Target path is invalid, inaccessible, or unclassifiable.\"\"\"\n\nclass IndexerRuntimeError(IndexerError):\n    \"\"\"Unrecoverable error during indexing execution.\"\"\"\n\nclass RenameError(IndexerError):\n    \"\"\"File rename failed (collision, permission, etc.).\"\"\"\n\nclass IndexerCancellationError(IndexerError):\n    \"\"\"The indexing operation was cancelled by the caller.\"\"\"\n</code></pre> <p>Exception-to-exit-code mapping:</p> Exception CLI exit code <code>IndexerConfigError</code> 2 <code>IndexerTargetError</code> 3 <code>IndexerRuntimeError</code> 4 <code>IndexerCancellationError</code> 5 (<code>INTERRUPTED</code>)"},{"location":"user-guide/python-api/#usage-examples","title":"Usage Examples","text":""},{"location":"user-guide/python-api/#index-a-single-file-with-defaults","title":"Index a single file with defaults","text":"<pre><code>from pathlib import Path\nfrom shruggie_indexer import index_path, serialize_entry\n\nentry = index_path(Path(\"/path/to/photo.jpg\"))\nprint(entry.id)         # \"yA8A8C089A6A8583B24C85F5A4A41F5AC\"\nprint(entry.type)       # \"file\"\nprint(entry.size.text)  # \"3.45 MB\"\n\njson_str = serialize_entry(entry)\nprint(json_str)\n</code></pre>"},{"location":"user-guide/python-api/#custom-configuration-with-metadata","title":"Custom configuration with metadata","text":"<pre><code>from pathlib import Path\nfrom shruggie_indexer import index_path, load_config, serialize_entry\n\nconfig = load_config(overrides={\n    \"id_algorithm\": \"sha256\",\n    \"extract_exif\": True,\n    \"meta_merge\": True,\n})\n\nentry = index_path(Path(\"/path/to/media/folder\"), config)\nfor child in entry.items or []:\n    if child.metadata:\n        for meta in child.metadata:\n            print(f\"{meta.origin}: {meta.attributes.type}\")\n</code></pre>"},{"location":"user-guide/python-api/#batch-indexing-with-shared-configuration","title":"Batch indexing with shared configuration","text":"<pre><code>from pathlib import Path\nfrom shruggie_indexer import index_path, load_config, serialize_entry\n\nconfig = load_config(overrides={\"compute_sha512\": True})\ntargets = [Path(\"/data/set-a\"), Path(\"/data/set-b\"), Path(\"/data/set-c\")]\n\nfor target in targets:\n    entry = index_path(target, config)\n    json_str = serialize_entry(entry, indent=None)  # compact JSON\n    (target / \"index.json\").write_text(json_str, encoding=\"utf-8\")\n</code></pre>"},{"location":"user-guide/python-api/#progress-reporting-and-cancellation","title":"Progress reporting and cancellation","text":"<pre><code>import threading\nfrom pathlib import Path\nfrom shruggie_indexer import (\n    index_path, load_config, ProgressEvent, IndexerCancellationError,\n)\n\nconfig = load_config(overrides={\"extract_exif\": True})\ncancel = threading.Event()\n\ndef on_progress(event: ProgressEvent) -&gt; None:\n    if event.phase == \"processing\" and event.items_total:\n        pct = event.items_completed / event.items_total * 100\n        print(f\"\\r{event.items_completed}/{event.items_total} ({pct:.0f}%)\", end=\"\")\n\ntry:\n    entry = index_path(\n        Path(\"/path/to/large/archive\"),\n        config,\n        progress_callback=on_progress,\n        cancel_event=cancel,\n    )\n    print(f\"\\nDone: {entry.id}\")\nexcept IndexerCancellationError:\n    print(\"\\nCancelled.\")\n</code></pre>"},{"location":"user-guide/python-api/#error-handling","title":"Error handling","text":"<pre><code>from pathlib import Path\nfrom shruggie_indexer import index_path, load_config\nfrom shruggie_indexer.exceptions import (\n    IndexerConfigError, IndexerTargetError,\n)\n\ntry:\n    config = load_config(overrides={\"id_algorithm\": \"blake2\"})\nexcept IndexerConfigError as e:\n    print(f\"Config error: {e}\")\n    # \"id_algorithm must be 'md5' or 'sha256', got 'blake2'\"\n\ntry:\n    entry = index_path(Path(\"/nonexistent/path\"))\nexcept IndexerTargetError as e:\n    print(f\"Target error: {e}\")\n</code></pre>"},{"location":"user-guide/python-api/#inspecting-the-entry-tree","title":"Inspecting the entry tree","text":"<pre><code>from shruggie_indexer import IndexEntry, index_path\n\ndef find_large_files(entry: IndexEntry, threshold: int) -&gt; list[IndexEntry]:\n    \"\"\"Walk the entry tree and find files exceeding a byte threshold.\"\"\"\n    results = []\n    if entry.type == \"file\" and entry.size.bytes &gt; threshold:\n        results.append(entry)\n    for child in entry.items or []:\n        results.extend(find_large_files(child, threshold))\n    return results\n\nentry = index_path(\"/path/to/archive\")\nfor f in find_large_files(entry, 100_000_000):  # &gt; 100 MB\n    print(f\"{f.name.text}: {f.size.text}\")\n</code></pre>"}]}