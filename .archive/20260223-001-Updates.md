# shruggie-indexer -- Pending Updates (2026-02-23)

- **Project:** `shruggie-indexer`
- **Repository:** [shruggietech/shruggie-indexer](https://github.com/shruggietech/shruggie-indexer)
- **Author:** William Thompson (ShruggieTech LLC)
- **Date:** 2026-02-23
- **Audience:** AI-first, Human-second

---

## Purpose

This document defines pending work items for the `shruggie-indexer` project, organized by subsystem. Each item is written as a self-contained prompt suitable for consumption by an AI coding agent operating within a single context window. Items include spec references, affected file paths, root cause analysis where applicable, and explicit acceptance criteria.

All file paths are relative to the repository root unless otherwise noted.

### Implementation Ordering

Items in this document have interdependencies. The following execution order must be respected to avoid rework:

1. **Section 1** (ExifTool key filtering bug) -- standalone; no dependencies on other sections.
2. **Section 2** (GUI application) -- items are numbered in dependency order within the section. Structural changes (tab consolidation, layout grouping) must precede detail-level work (tooltips, button feedback).
3. **Section 3** (Documentation site) -- depends on Section 2 completing the About tab (item 2.9) to determine the documentation link target.
4. **Section 4** (Repository layout sync) -- depends on Section 5 (plan deprecation) since the plan file move changes the repo layout.
5. **Section 5** (Plan file deprecation) -- standalone; no dependencies on other sections.
6. **Section 6** (Spec update directive) -- must be executed last, after all other sections are complete.

---

## 1. ExifTool Key Filtering Bug (Priority: High)

### 1.1. Problem Statement

The `key_filter` transform declared in `attributes.transforms` for exiftool metadata entries is not functioning. Sensitive filesystem details -- including full absolute paths, directory names, and system-level file attributes -- are leaking into the output. This exposes personal machine information that must be stripped.

### 1.2. Root Cause Analysis

The exiftool invocation uses the `-G3:1` flag (see `EXIFTOOL_BASE_ARGS` in the spec and `EXIFTOOL_COMMON_ARGS` in the source). This flag causes exiftool to emit **group-prefixed** key names in its JSON output (e.g., `"ExifTool:ExifToolVersion"`, `"System:FileName"`, `"System:Directory"`).

However, `EXIFTOOL_EXCLUDED_KEYS` contains only the **unprefixed** key names:

```python
EXIFTOOL_EXCLUDED_KEYS = frozenset({
    "ExifToolVersion", "FileSequence", "NewGUID", "Directory",
    "FileName", "FilePath", "BaseName", "FilePermissions",
})
```

The `_filter_keys()` function performs an exact-match set membership check (`if k not in EXIFTOOL_EXCLUDED_KEYS`). Because the actual keys in the exiftool output are prefixed (e.g., `"ExifTool:ExifToolVersion"`), no key ever matches, and **nothing is filtered**.

Additionally, `SourceFile` is absent from the exclusion set entirely. ExifTool populates this field with the full absolute path as provided to it, which exposes the user's filesystem layout.

### 1.3. Spec References

| Reference | Section |
|-----------|---------|
| Key filtering behavior | `shruggie-indexer-spec.md` SS6.6 -- Output parsing and key filtering |
| `key_filter` transform definition | `shruggie-indexer-spec.md` SS5.10 -- `attributes.transforms` |
| ExifTool argument defaults | `shruggie-indexer-spec.md` SS9.3 -- Exiftool argument defaults |
| Deviation DEV-06 | `shruggie-indexer-spec.md` SS2.6 -- jq elimination and dict comprehension filtering |

### 1.4. Affected Files

| File | Role |
|------|------|
| `src/shruggie_indexer/core/exif.py` | Contains `EXIFTOOL_EXCLUDED_KEYS` and `_filter_keys()` |
| `src/shruggie_indexer/config/defaults.py` | Default exiftool configuration |
| `shruggie-indexer-spec.md` SS6.6 | Spec must be updated to reflect corrected key set |
| `docs/user-guide/configuration.md` | Documents the key exclusion list for end users |

### 1.5. Required Changes

**A. Fix `_filter_keys()` to match group-prefixed keys.**

The filter must strip keys regardless of whether they carry a group prefix. The recommended approach: extract the suffix after the last `:` separator and compare that against the exclusion set. This correctly handles both prefixed keys (`"System:FileName"`) and any unprefixed keys (in case exiftool is ever invoked without `-G`).

```python
def _filter_keys(data: dict[str, Any]) -> dict[str, Any]:
    """Remove excluded keys from exiftool output.

    Keys are matched by their base name (after the last ':' separator)
    to handle group-prefixed output from -G flags.
    """
    return {
        k: v for k, v in data.items()
        if _base_key(k) not in EXIFTOOL_EXCLUDED_KEYS
    }

def _base_key(key: str) -> str:
    """Extract the base key name, stripping any group prefix."""
    return key.rsplit(":", 1)[-1]
```

**B. Expand the exclusion set.**

The following keys must be added to `EXIFTOOL_EXCLUDED_KEYS`. These are ExifTool operational and system-level keys that expose filesystem-specific information not originating from the file's embedded metadata:

| Key (base name) | Reason for exclusion |
|------------------|----------------------|
| `SourceFile` | Full absolute path to the processed file. Exposes user filesystem layout. |
| `FileSize` | Redundant -- already captured in the IndexEntry `size` object. |
| `FileModifyDate` | Redundant -- already captured in the IndexEntry `timestamps` object. |
| `FileAccessDate` | Redundant -- already captured in the IndexEntry `timestamps` object. |
| `FileCreateDate` | Redundant -- already captured in the IndexEntry `timestamps` object. |
| `FileAttributes` | OS-specific filesystem attributes. Not embedded metadata. |
| `FileDeviceNumber` | OS-specific device identifier. |
| `FileInodeNumber` | OS-specific inode. Always `0` on Windows. |
| `FileHardLinks` | OS-specific hard link count. |
| `FileUserID` | OS-specific UID. Always `0` on Windows. |
| `FileGroupID` | OS-specific GID. Always `0` on Windows. |
| `FileDeviceID` | OS-specific device ID. |
| `FileBlockSize` | OS-specific block size. Empty on Windows. |
| `FileBlockCount` | OS-specific block count. Empty on Windows. |
| `Now` | ExifTool's processing timestamp. Operational metadata. |
| `ProcessingTime` | ExifTool's processing duration. Operational metadata. |

Note: Cross-reference the original MakeIndex PowerShell function's `jq` deletion list to verify completeness. The v1 examples in `docs/porting-reference/v1-examples/` show which `System:*` keys the original retained vs. filtered.

**C. Update the spec and documentation** to reflect the corrected exclusion set and the prefix-aware matching behavior.

### 1.6. Acceptance Criteria

- Running the indexer on any file produces exiftool metadata output containing zero keys from the expanded exclusion set (neither prefixed nor unprefixed forms).
- `SourceFile` is absent from all exiftool metadata output.
- No `System:File*` filesystem-level keys remain in the output (except those deliberately retained after review, if any).
- ExifTool-internal operational keys (`Now`, `ProcessingTime`, `ExifToolVersion`, `FileSequence`, `NewGUID`) are absent.
- All embedded metadata keys (e.g., `File:FileType`, `File:MIMEType`, `QuickTime:*`, `Track*:*`, `Composite:*`) are preserved unmodified.
- Existing unit tests for `_filter_keys()` are updated to test group-prefixed key input.
- `shruggie-indexer-spec.md` SS6.6 and `docs/user-guide/configuration.md` are updated.

---

## 2. GUI Application Improvements (Priority: Medium)

### 2.0. General Context

The GUI is implemented in `src/shruggie_indexer/gui/app.py` as a single-file CustomTkinter application. Spec guidance for the GUI is in `shruggie-indexer-spec.md` SS10.1--SS10.7. The GUI uses a sidebar-tab layout with four operation tabs (Index, Meta Merge, Meta Merge Delete, Rename) and a Settings tab.

**Critical architectural context:** The four GUI operation tabs are not four different operations. They are four preset configurations of the same `index_path()` pipeline. Rename is not a standalone operation -- it is a post-processing modifier applied after indexing completes, identical to how the original MakeIndex PowerShell function handled it. The GUI's presentation of Rename as a peer-level tab is architecturally misleading and is addressed in item 2.1 below.

The items in this section are ordered by dependency. Structural changes to the tab/page model (items 2.1--2.3) must be completed before layout and widget-level work (items 2.4--2.14) because the structural changes directly affect which controls exist and where they are placed.

### 2.1. Consolidate Operation Tabs into a Single Operations View

**Problem:** The four operation tabs (Index, Meta Merge, Meta Merge Delete, Rename) occupy separate sidebar tabs, which spreads related functionality across too many navigation targets. More importantly, "Rename" is not a standalone operation -- it is a modifier flag on the indexing pipeline (it sets `config.rename=True` and `config.output_inplace=True`). Presenting it as a peer-level tab misrepresents the underlying architecture.

**Required behavior:** Consolidate all four operation types into a single "Operations" tab (or similar label). Use a dropdown, segmented control, or radio group within that tab to switch between operation types. The Settings tab remains as a separate sidebar tab.

The sidebar should contain exactly these tabs after consolidation:

1. **Operations** -- contains the inline operation type selector and all operation-specific controls.
2. **Settings** -- unchanged from current implementation.
3. **About** -- new tab (see item 2.9).

**Impact on session persistence:** The session file must store which operation type was last selected within the consolidated Operations tab.

**Spec reference:** `shruggie-indexer-spec.md` SS10.2 -- Window Layout (sidebar tabs). Note: this deviates from the current spec. The spec must be updated to reflect this consolidation after implementation.

**Acceptance criteria:** A single sidebar tab provides access to all four operation types via an inline selector. Settings and About remain as separate sidebar tabs. The previously separate tab-specific controls are displayed contextually based on the selected operation type.

### 2.2. Destructive Operation Indicator

**Problem:** There is no visual signal in the interface alerting the user when the currently selected configuration will result in a destructive process (one that modifies or deletes files on disk).

**Destructive operations are defined as any configuration where one or more of the following flags are active:**

| Flag | Destructive action |
|------|-------------------|
| `meta_merge_delete=True` | Deletes sidecar metadata files after merging |
| `rename=True` (with `dry_run=False`) | Renames files on disk, destroying original filenames |

Note: `rename=True` with `dry_run=True` is **not** destructive (preview only).

**Required behavior:** Display a small, persistent status indicator within the Operations tab that reflects the current configuration's destructive potential. This indicator should update in real time as the user changes operation type or toggles controls like dry-run.

| State | Visual appearance |
|-------|-------------------|
| Non-destructive | Small green dot + label "Non-Destructive" |
| Destructive | Small red dot + label "Destructive" |

The indicator should be visually understated -- it is informational, not an alarm. It should not block execution or require dismissal. Placement: near the action button or at the top of the operations area where it is visible without scrolling.

**Acceptance criteria:** Selecting "Index" or "Meta Merge" shows the green non-destructive indicator. Selecting "Meta Merge Delete" shows the red destructive indicator. Selecting "Rename" shows the red indicator when dry-run is unchecked, and the green indicator when dry-run is checked. The indicator updates immediately on control changes.

### 2.3. UI Layout -- Visual Grouping and Alignment

**Problem:** The current arrangement of options, buttons, and controls across the operations area is visually disorganized. There are no logical groupings, inconsistent alignment, and the overall appearance is cluttered.

**Dependency:** This item must be implemented after item 2.1 (tab consolidation) because the consolidated layout determines which controls exist and how they are organized.

**Required behavior:** Reorganize the operations area with:

1. **Logical grouping:** Related controls are enclosed within labeled frames (`CTkFrame` with a section label). Suggested groups: "Target", "Options", "Output".
2. **Consistent alignment:** Labels and input widgets are aligned on a grid or using consistent padding. Radio buttons, checkboxes, and entry fields within a group use uniform left-margin alignment.
3. **Visual hierarchy:** Section headers or labeled frames distinguish control groups. Spacing between groups is larger than spacing within groups.
4. **Reduced clutter:** Controls that are not relevant to the current operation type are hidden or disabled rather than shown in a flat list.

**Spec reference:** `shruggie-indexer-spec.md` SS10.2 -- Window Layout, SS10.3 -- Target Selection and Input.

**Acceptance criteria:** The operations area's controls are visually organized into labeled groups with consistent alignment. The interface no longer appears as an unstructured collection of miscellaneous controls.

### 2.4. File Picker Dialogue Does Not Respect "Type" Setting

**Problem:** When the "Type" radio is set to `"auto"`, the Browse button opens a file-only picker (`filedialog.askopenfilename`). It should allow selection of both files and directories when in auto mode.

**Affected code:** `_TargetSelector._browse()` in `src/shruggie_indexer/gui/app.py`.

**Current behavior (from source):**

```python
def _browse(self) -> None:
    target_type = self.type_var.get()
    if target_type == "directory":
        path = filedialog.askdirectory(title="Select Directory")
    else:
        path = filedialog.askopenfilename(title="Select File")
```

The `else` branch catches both `"file"` and `"auto"`, but only opens a file picker. When `"auto"` is selected, the user should be able to select either a file or a directory.

**Required behavior by Type value:**

| Type value | Picker behavior |
|------------|----------------|
| `"file"` | File picker only (`askopenfilename`) |
| `"directory"` | Directory picker only (`askdirectory`) |
| `"auto"` | Must allow selection of either. Implementation options: (a) use `askdirectory` with a toggle or secondary button for file selection, (b) use a custom picker that supports both, or (c) offer two buttons ("Browse File" / "Browse Folder") when in auto mode. Choose the approach that integrates most cleanly with CustomTkinter and does not break the existing layout. |

**Spec reference:** `shruggie-indexer-spec.md` SS10.3 -- Target Selection and Input.

**Acceptance criteria:** With Type set to "Auto", the user can browse to and select either a file or a directory.

### 2.5. Output File Picker with Auto-Suggested Path

**Problem:** There is no persistent output file path field in the interface. The application only prompts for an output file via a transient picker when launching a new job, which is confusing. Additionally, when an output file is needed, the user must manually construct the filename even though our naming conventions are deterministic.

**Required behavior:**

**A. Persistent output file field.** Add an output file path field (entry + Browse button) that becomes visible and interactive when the output mode requires a file destination (e.g., "Save to file" is selected, or the operation type mandates an output file such as Meta Merge Delete). The selected path should be stored in session state. When present, the output file path is used directly when a job is launched -- no additional picker popup should appear. When the output mode does not require a file (e.g., stdout/display only), the output file picker should be hidden or disabled.

**B. Auto-suggest the output filename.** When the user selects a target path, the output file field should be automatically populated with the conventional output filename based on the application's naming conventions. The auto-suggested value should be editable -- it is a default, not a constraint.

**Naming convention rules** (from spec SS6.5 and SS6.9):

| Target type | Output file pattern | Example |
|-------------|-------------------|---------|
| File | `{parent_dir}/{filename}_meta2.json` | Target: `C:/my/cool/file.txt` --> Output: `C:/my/cool/file.txt_meta2.json` |
| Directory | `{directory_path}_directorymeta2.json` | Target: `C:/my/cool/dir` --> Output: `C:/my/cool/dir_directorymeta2.json` |

**Edge case -- root-level targets:** When the target is at or near the root of a storage device, the standard naming convention may produce awkward or invalid paths. Handle these cases as follows:

| Target path | Problem | Suggested output path |
|-------------|---------|----------------------|
| `C:/` | `C:/_directorymeta2.json` is technically valid but unusual. The trailing slash must be handled. | `C:/_directorymeta2.json` (strip trailing separator before appending suffix) |
| `C:/my` | No issue -- standard convention works. | `C:/my_directorymeta2.json` |
| `/` (Unix root) | `/_directorymeta2.json` writes to root directory, likely a permissions error. | Auto-suggest should fall back to the user's home directory or current working directory: `~/root_directorymeta2.json` or similar. Flag this edge case for the user. |

The auto-suggest should be triggered whenever the target path entry changes (on focus-out or after browse selection). If the user has manually edited the output path, subsequent auto-suggests should not overwrite the manual edit -- only re-trigger if the output field still matches the previously auto-generated value.

**Spec reference:** `shruggie-indexer-spec.md` SS10.3 -- Target Selection and Input, SS6.5 -- Path component extraction, SS6.9 -- JSON serialization and output routing.

**Acceptance criteria:** An output file field appears when needed. Selecting a target path auto-populates the output field with the conventional filename. The user can override the auto-suggestion. Root-level targets produce reasonable output paths.

### 2.6. Output/Log Window -- Auto-Clear on New Job

**Problem:** When a new job starts, stale output/log content from the previous job remains visible. This creates confusion, especially when the "Output" toggle is highlighted but the displayed content is actually from a prior run.

**Affected code:** `OutputPanel` class and job execution flow in `src/shruggie_indexer/gui/app.py`.

**Required behavior:** The output/log text area must be cleared automatically when a new job begins execution (i.e., at the point where `run_operation()` launches the background thread, before the progress panel is shown).

**Acceptance criteria:** Launching a new job immediately clears any previous output and log content. No stale data persists across job boundaries.

### 2.7. Output/Log Window -- Missing "Clear" Button

**Problem:** The output/log window has Save and Copy buttons but no Clear button. Users cannot manually clear the display.

**Affected code:** `OutputPanel._build_widgets()` in `src/shruggie_indexer/gui/app.py`.

**Required behavior:** Add a "Clear" button alongside the existing Save and Copy buttons. Clicking it clears the text area content for both Output and Log views.

**Acceptance criteria:** A Clear button is present, functional, and visually consistent with the existing Save and Copy buttons.

### 2.8. Output/Log Window -- Incorrect Post-Job Display Behavior

**Problem:** Upon job completion, the output panel displays raw output data even when the "Output" setting is set to "Save to file" (which implies the output should be written to disk, not displayed). This is further compounded by the fact that:

1. The displayed "output" may be stale data from the previous job (if auto-clear is not implemented -- see item 2.6).
2. If the user was viewing the "Log" tab when the job was triggered, the output display overwrites the log view without switching the toggle, resulting in "Log" being highlighted while output data is shown.

**Required behavior:**

- When `output_mode == "save_to_file"`: Do not populate the output display upon job completion. Show a brief status message instead (e.g., "Output saved to: `<filepath>`").
- When `output_mode == "stdout"` or `"display"`: Populate the output display as currently done.
- The active toggle (Output vs. Log) must remain visually consistent with what is actually displayed. Never overwrite the log view with output data or vice versa without updating the toggle state.

**Acceptance criteria:** Running a job with "Save to file" output mode does not display output data in the panel. The Output/Log toggle always reflects the currently displayed content.

### 2.9. "About" Tab

**Problem:** There is no About section in the application.

**Required behavior:** Add an "About" tab (accessible via the sidebar) that displays:

1. **Project overview:** A brief description of shruggie-indexer (1--3 sentences).
2. **Developer attribution:** "Built by ShruggieTech LLC" with a clickable link to [https://shruggie.tech](https://shruggie.tech).
3. **Version:** The current installed version of the indexer (from `shruggie_indexer.__version__`).
4. **Documentation link:** A clickable hyperlink to the official project documentation site.

**Acceptance criteria:** The About tab exists, displays the four required items, and all links are functional.

### 2.10. Version Number in Sidebar

**Problem:** The application version is not displayed anywhere in the main interface.

**Required behavior:** Display the version string (from `shruggie_indexer.__version__`) at the bottom of the left sidebar, below all tab buttons. Use a small, muted font that does not compete visually with the tab buttons.

**Acceptance criteria:** The current version number is visible in the sidebar at all times.

### 2.11. Logging Display Insufficient at Debug Level

**Problem:** Even with the "Debug" verbosity setting activated in the Settings tab, the log display only shows the count of discovered items in the target directory. A true debug output should include per-file processing events, exiftool invocation details, hash computation progress, sidecar discovery, configuration resolution, and error/warning details.

**Affected code:** The logging handler attached to the GUI's log display, and the log polling mechanism in `ShruggiIndexerApp`.

**Diagnosis required:** Determine whether:
1. The core library emits adequate log messages at `DEBUG` level but the GUI handler is filtering or not capturing them.
2. The core library's logging is itself too sparse at `DEBUG` level.
3. The GUI log poll interval (`_POLL_INTERVAL_MS = 50`) is adequate but the queue mechanism drops messages.

**Required behavior:** At Debug verbosity, the log display should show a real-time, per-item processing stream comparable to CLI `--verbose --verbose` output. At minimum: file discovery, hash computation, exiftool invocation, sidecar matching, and any warnings or errors.

**Spec reference:** `shruggie-indexer-spec.md` SS10.6 -- Output Display and Export (log view behavior).

**Acceptance criteria:** Running a multi-file directory index at Debug verbosity produces a detailed, per-item processing log in the GUI log display.

### 2.12. Copy Button -- No Visual Feedback

**Problem:** Pressing the "Copy" button above the output/log window provides no visual confirmation that the copy operation succeeded.

**Affected code:** `OutputPanel._copy()` in `src/shruggie_indexer/gui/app.py`.

**Required behavior:** On successful copy:

1. Briefly change the button's background color to a success indicator (green).
2. Change the button label text to "Copied!" (or similar).
3. After 1.5--2.0 seconds, revert the button to its original appearance (color and label).

Use `widget.after()` for the timed revert. Do not block the main thread.

**Acceptance criteria:** Pressing Copy produces a visible 1.5--2 second color-and-label change confirming the action, then reverts.

### 2.13. Resizable Output/Log Window

**Problem:** The output/log window has a fixed height and cannot be resized by the user.

**Required behavior:**

1. The output/log panel is resizable in height (not width) via a drag handle at its top edge, similar to how a `PanedWindow` separator works.
2. The user's adjusted height is persisted to the session file and restored on next launch.

**Implementation guidance:** CustomTkinter does not have a native paned window. Options include: using `tkinter.PanedWindow` directly with CustomTkinter frames, or implementing a custom drag handle widget that adjusts the panel's height constraint on mouse drag.

**Session persistence:** Add an `output_panel_height` field to the session file schema.

**Spec reference:** `shruggie-indexer-spec.md` SS10.6 -- Output Display and Export.

**Acceptance criteria:** The output panel can be resized vertically by dragging. The size persists across sessions.

### 2.14. Descriptive Tooltips and Category Descriptions

**Problem:** The GUI options lack contextual help. Users must consult external documentation to understand what each control does.

**Dependency:** This item must be implemented after item 2.3 (visual grouping) because tooltips and category descriptions depend on the final control layout and groupings being established.

**Required behavior:**

1. **Tooltips:** Add descriptive hover tooltips to all input controls (radio buttons, checkboxes, entry fields, buttons). Each tooltip should be a single sentence explaining the control's purpose.
2. **Category descriptions:** When controls are grouped into labeled frames (see item 2.3), each group should include a short one-line description below the group label.
3. **Settings toggle:** Add a "Show tooltips" toggle in the Settings tab. When disabled, all tooltips are suppressed. Default: enabled.

**Acceptance criteria:** All controls display descriptive tooltips on hover. Tooltips can be disabled via Settings.

---

## 3. Documentation Site (Priority: Medium)

### 3.1. GUI Documentation Visibility

**Problem:** The GUI application has no dedicated, easily discoverable documentation on the MkDocs site. End users of the GUI (who are typically less technical than CLI users) cannot readily find usage guidance for the desktop application.

**Affected files:**

| File | Role |
|------|------|
| `mkdocs.yml` | Navigation structure for the documentation site |
| `docs/user-guide/` | User-facing documentation directory |

**Required behavior:**

1. Create a dedicated GUI usage guide (e.g., `docs/user-guide/gui.md`) covering: launching the application, navigating the interface, configuring and running each operation type, understanding the output/log panel, and keyboard shortcuts.
2. Place the GUI guide prominently in the MkDocs navigation -- ideally as a top-level "User Guide" entry or immediately after "Quick Start" in the existing User Guide section. Do not bury it under technical reference material.
3. The GUI guide should be written for a non-technical audience. Assume the reader has no CLI experience and may not understand concepts like "stdout" or "JSON schema".

**Spec reference:** `shruggie-indexer-spec.md` SS3.7 -- Documentation Site (navigation structure), SS10.1--SS10.7 (GUI spec).

**Acceptance criteria:** A GUI-specific documentation page exists, is discoverable within two clicks from the documentation site landing page, and is written for a non-technical audience.

---

## 4. Repository Layout Documentation (Priority: Low)

### 4.1. Sync Formal Repository Descriptions with Actual Contents

**Problem:** The formal repository layout documentation in the spec (SS3.1) was written at project inception. New files and directories have been added since then that are not reflected in the spec's layout table. The documentation site's content may also reference an outdated layout.

**Dependency:** Execute this item after Section 5 (plan deprecation), since the plan file move changes the repository's top-level layout.

**Affected files:**

| File | Role |
|------|------|
| `shruggie-indexer-spec.md` SS3.1 | Top-Level Layout table and tree diagram |
| `docs/` (site content) | May contain outdated layout references |

### 4.2. Known Undocumented Items

The following items exist in the repository (or will exist after Section 5 is completed) but are not described in the spec's SS3.1 layout table:

| Path | Type | Proposed Description |
|------|------|----------------------|
| `./shruggie-indexer-spec.html` | File | HTML rendering of the technical specification, generated via VS Code plugin (Markdown Preview Enhanced or similar) from `shruggie-indexer-spec.md`. Exists to facilitate sharing and human consumption of the specification. Generated artifact -- not manually edited. |
| `./shruggie-indexer-spec.pdf` | File | PDF rendering of the technical specification, generated via the same VS Code plugin. Same purpose as the HTML variant. Generated artifact -- not manually edited. |
| `./.archive/` | Directory | Human-only workspace for project notes, prompt files, and historical planning artifacts (including the deprecated `shruggie-indexer-plan.md`). AI agents should not parse or modify contents of this directory unless explicitly instructed to do so. |

### 4.3. Required Actions

1. **Audit the actual repository** against the spec's SS3.1 tree diagram and table. Identify all items present in the repo that are missing from the spec.
2. **Add entries** for each undocumented item to the SS3.1 table with appropriate descriptions. For items not listed in SS4.2 above, deduce the description from the file's content and purpose, or flag for human clarification if the purpose is ambiguous.
3. **Update the tree diagram** in SS3.1 to include all new top-level items.
4. **Remove** `shruggie-indexer-plan.md` from the SS3.1 table and tree diagram (since it will have been moved to `.archive/` per Section 5).
5. **Check the documentation site** for any references to the repository layout and update accordingly.

**Important:** The `.archive/` directory and the generated `.html`/`.pdf` spec files should be added to `.gitignore` if they are not already present, since they are generated or human-only artifacts that do not belong in CI/CD pipelines.

**Acceptance criteria:** The spec's SS3.1 layout table and tree diagram accurately reflect the current state of the repository. No undocumented top-level files or directories exist. The deprecated plan file is no longer listed.

---

## 5. Deprecate Implementation Plan File (Priority: Low)

### 5.1. Problem Statement

The file `shruggie-indexer-plan.md` is the sprint-based implementation plan that guided the initial construction of the project through Sprints 1.1--3.3 and the v0.1.0 release. All sprints defined in the plan are complete. The plan is no longer relevant to ongoing development and should not remain at the repository root where it may confuse AI agents or contributors into treating it as an active planning document.

### 5.2. Required Actions

**A. Move the plan file to the archive directory.**

```
shruggie-indexer-plan.md --> .archive/shruggie-indexer-plan.md
```

**B. Remove all references to the plan file** from the following locations:

| Location | Nature of reference |
|----------|-------------------|
| `shruggie-indexer-spec.md` SS3.1 -- Top-Level Layout | Listed in the repository layout table and tree diagram |
| `shruggie-indexer-spec.md` SS1.5 -- Reference Documents | May be listed as a reference document |
| `mkdocs.yml` | Verify that no `nav` entry points to the plan file |
| `docs/` content pages | Search for any hyperlinks or references to `shruggie-indexer-plan.md` |
| `README.md` | Search for any mentions of the plan file |

For each reference found, either remove it or replace it with a brief note that the implementation plan has been archived (e.g., "The original implementation plan is available in `.archive/` for historical reference.").

**C. Verify that `.archive/` is listed in `.gitignore`** if the intent is to keep archive contents out of source control. If the intent is to track archive contents in Git (for historical preservation), ensure `.archive/` is NOT in `.gitignore` and confirm that this is the desired behavior.

### 5.3. Acceptance Criteria

- `shruggie-indexer-plan.md` no longer exists at the repository root.
- The file is present at `.archive/shruggie-indexer-plan.md`.
- No references to `shruggie-indexer-plan.md` remain in the spec, documentation site, `mkdocs.yml`, or `README.md` (except for the optional historical note in `.archive/` context).
- The repository builds and all documentation site links resolve without broken references.

---

## 6. Specification Update Directive (Priority: Required -- Execute Last)

### 6.1. Purpose

After all work items in Sections 1--5 have been completed, the project technical specification (`shruggie-indexer-spec.md`) must be updated to reflect the changes that were implemented. This is not optional -- the spec is the authoritative source of truth for AI-assisted development and must remain synchronized with the actual codebase.

### 6.2. Required Spec Updates

The following spec sections must be reviewed and updated based on the work completed in this document:

| Section affected | Update trigger | Nature of update |
|-----------------|---------------|------------------|
| SS6.6 -- Output parsing and key filtering | Section 1 (ExifTool fix) | Update the `EXIFTOOL_EXCLUDED_KEYS` set listing, document prefix-aware matching, expand the exclusion rationale table. |
| SS10.2 -- Window Layout | Section 2, item 2.1 (tab consolidation) | Rewrite the sidebar tab structure to reflect the consolidated Operations/Settings/About model. Remove references to four separate operation tabs. |
| SS10.3 -- Target Selection and Input | Section 2, items 2.1, 2.4, 2.5 | Update the per-tab input form descriptions to reflect the consolidated layout. Document the auto-suggest output file behavior. Document the file picker fix for auto mode. |
| SS10.6 -- Output Display and Export | Section 2, items 2.6--2.8, 2.12, 2.13 | Document auto-clear behavior, Clear button, post-job display logic, copy feedback, and resizable panel. |
| SS10 (new subsection) | Section 2, item 2.2 | Add documentation for the destructive operation indicator. |
| SS10 (new subsection) | Section 2, item 2.9 | Add documentation for the About tab. |
| SS3.1 -- Top-Level Layout | Section 4, Section 5 | Updated repository layout (plan file removed, new items added). |
| SS3.7 -- Documentation Site | Section 3 | Update the `nav` description to include the GUI documentation page. |

### 6.3. Update Principles

When updating the spec:

1. **Preserve the document's existing style and conventions.** Use the same cross-referencing notation (SS X.Y), deviation codes (DEV-XX), and formatting patterns already established in the spec.
2. **Do not remove historical context.** Deviation notes and comparison-to-original sections should be preserved. New changes should be documented alongside them, not in place of them.
3. **Mark new content clearly.** If a section is substantially rewritten, add a brief note at the top of the section indicating the update date and the triggering change (e.g., "Updated 2026-02-XX: Reflects tab consolidation per Pending Updates document, Section 2, item 2.1.").
4. **Regenerate the HTML and PDF renderings** of the spec after all textual updates are complete, using the same VS Code plugin workflow that produced the current `.html` and `.pdf` files.

### 6.4. Acceptance Criteria

- Every behavioral change implemented in Sections 1--5 is reflected in the spec.
- No spec section describes behavior that contradicts the implemented code.
- The spec's SS3.1 repository layout is fully synchronized with the actual repository.
- The generated `.html` and `.pdf` renderings of the spec are regenerated from the updated `.md` source.

---

## Appendix A: ExifTool Output Sample (Reference)

The following is an abbreviated real-world exiftool metadata array generated by shruggie-indexer for a video file (`*.mp4`). This sample demonstrates the key filtering bug described in Section 1.

Keys that **should have been filtered** but were not are annotated with `// SHOULD BE FILTERED` comments. Embedded metadata keys that should be **preserved** are unmarked.

```json
[
    {
        "id": "zF2AA5C70E3DDDC204B14924869141DDF",
        "origin": "generated",
        "name": {
            "text": null,
            "hashes": null
        },
        "hashes": {
            "md5": "F2AA5C70E3DDDC204B14924869141DDF",
            "sha256": "549FA363C0E892A531321D33BF9E3C6146B784F1BD32653DB50B4DD255F1E190",
            "sha512": "A98511052918A56302562BF1E41828227F08C30453E431A4042875F71C60E609..."
        },
        "attributes": {
            "type": "exiftool.json_metadata",
            "format": "json",
            "transforms": [
                "key_filter"
            ]
        },
        "data": {
            "SourceFile": "E:/data/.../KKat_1.mp4",        // SHOULD BE FILTERED (full path exposure)
            "ExifTool:ExifToolVersion": 12.55,               // SHOULD BE FILTERED (prefixed; missed by filter)
            "ExifTool:Now": "2026:02:23 01:41:17-05:00",    // SHOULD BE FILTERED (operational metadata)
            "ExifTool:NewGUID": "20260223...",               // SHOULD BE FILTERED (prefixed; missed by filter)
            "ExifTool:FileSequence": 0,                      // SHOULD BE FILTERED (prefixed; missed by filter)
            "ExifTool:ProcessingTime": 1.045003,             // SHOULD BE FILTERED (operational metadata)
            "System:FileName": "KKat_1.mp4",                 // SHOULD BE FILTERED (prefixed; missed by filter)
            "System:BaseName": "KKat_1",                     // SHOULD BE FILTERED (prefixed; missed by filter)
            "System:Directory": "E:/data/.../Videos",        // SHOULD BE FILTERED (prefixed; missed by filter)
            "System:FilePath": "E:/data/.../KKat_1.mp4",    // SHOULD BE FILTERED (prefixed; missed by filter)
            "System:FileSize": 1995561672,                   // SHOULD BE FILTERED (redundant with IndexEntry.size)
            "System:FileModifyDate": "2025:09:24...",        // SHOULD BE FILTERED (redundant with timestamps)
            "System:FileAccessDate": "2026:02:23...",        // SHOULD BE FILTERED (redundant with timestamps)
            "System:FileCreateDate": "2026:01:21...",        // SHOULD BE FILTERED (redundant with timestamps)
            "System:FilePermissions": 100666,                // SHOULD BE FILTERED (prefixed; missed by filter)
            "System:FileAttributes": "32768 0 32",           // SHOULD BE FILTERED (OS-specific)
            "System:FileDeviceNumber": 0,                    // SHOULD BE FILTERED (OS-specific)
            "System:FileInodeNumber": 0,                     // SHOULD BE FILTERED (OS-specific, always 0 on Windows)
            "System:FileHardLinks": 1,                       // SHOULD BE FILTERED (OS-specific)
            "System:FileUserID": 0,                          // SHOULD BE FILTERED (OS-specific, always 0 on Windows)
            "System:FileGroupID": 0,                         // SHOULD BE FILTERED (OS-specific, always 0 on Windows)
            "System:FileDeviceID": 0,                        // SHOULD BE FILTERED (OS-specific)
            "System:FileBlockSize": "",                      // SHOULD BE FILTERED (OS-specific, empty on Windows)
            "System:FileBlockCount": "",                     // SHOULD BE FILTERED (OS-specific, empty on Windows)
            "File:FileType": "M4V",
            "File:FileTypeExtension": "M4V",
            "File:MIMEType": "video/x-m4v",
            "QuickTime:MajorBrand": "M4V ",
            "QuickTime:Duration": 2586.33375,
            "Track1:CompressorID": "avc1",
            "Track1:SourceImageWidth": 1920,
            "Track1:SourceImageHeight": 1080,
            "Track1:VideoFrameRate": 23.976023976024,
            "Composite:ImageSize": "1920 1080",
            "Composite:Megapixels": 2.0736,
            "Composite:AvgBitrate": 6161563,
            "Composite:Rotation": 0
        }
    }
]
```

Remaining `QuickTime:*`, `Track*:*`, `File:*`, `Composite:*`, and other format-specific keys (omitted above for brevity) are embedded metadata and must be preserved.
