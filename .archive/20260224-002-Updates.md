# shruggie-indexer — Pending Updates (2026-02-24, Batch 1)

- **Project:** `shruggie-indexer`
- **Repository:** [shruggietech/shruggie-indexer](https://github.com/shruggietech/shruggie-indexer)
- **Author:** William Thompson (ShruggieTech LLC)
- **Date:** 2026-02-24
- **Target Release:** v0.1.1
- **Audience:** AI-first, Human-second
- **Predecessor:** This document follows `20260223-002-Updates.md`. It assumes all items in that document have been implemented and merged.

---

## Purpose

This document defines the final update cycle before the v0.1.1 release of `shruggie-indexer`. The work items described here address schema readiness for downstream ecosystem consumers (primarily `shruggie-catalog`), shared configuration infrastructure for the broader ShruggieTech utility ecosystem, documentation site fidelity, repository housekeeping, and the release itself.

This document is the authoritative work order for v0.1.1. No implementation work outside the scope of this document should be undertaken before the release is cut.

### Ecosystem Context

As defined in the [ShruggieTech Asset Ecosystem — Project Direction](https://github.com/shruggietech/shruggie-indexer/blob/main/.archive/20260223-002-ecosystem-direction.md), `shruggie-indexer` is the foundational utility in a four-component system:

```
shruggie-indexer   ← foundational; no dependencies on other ecosystem components
shruggie-vault     ← depends on indexer output (IndexEntry)
shruggie-catalog   ← depends on indexer output (IndexEntry)
shruggie-sync      ← orchestrates indexer, vault, and catalog
```

Development will pivot to `shruggie-catalog` immediately after this release. The catalog will consume `IndexEntry` records as its primary input, track identity over time, manage references (collections, projects, users), and provide search and query capabilities over indexed metadata. The work items in this document exist to ensure that the indexer's output contract is stable, well-documented, and structurally prepared for catalog integration — without the indexer absorbing responsibilities that belong to the catalog.

### Implementation Ordering

Items in this document are sequenced in strict dependency order. Each section is a self-contained sprint suitable for execution by an AI coding agent in a single context window. The following execution order MUST be respected:

1. **Section 1** (Schema review and catalog readiness) — Foundational analysis and additive schema changes. Must be completed first because all subsequent sections depend on the schema being stable.
2. **Section 2** (Shared configuration namespace) — Infrastructure change that establishes cross-tool conventions. Depends on Section 1 because schema decisions may influence configuration surface area.
3. **Section 3** (GUI advanced configuration) — Design and scaffold work for the advanced settings panel. Depends on Section 2 because the configuration namespace must be established before the GUI exposes it.
4. **Section 4** (Archive normalization and documentation references) — Repository housekeeping. No hard dependency on Sections 1–3 but is sequenced here to keep code changes grouped before documentation-only changes.
5. **Section 5** (Documentation site synchronization) — Depends on all prior sections being complete so the documentation reflects the final state of the codebase.
6. **Section 6** (Specification update directive) — Must be executed last among content changes. Reflects all behavioral and structural changes from Sections 1–5 into the authoritative spec.
7. **Section 7** (Release v0.1.1) — Final step. Changelog finalization, tag, and release.

---

## 1. Schema Review and Catalog Readiness Enhancements (Priority: High — Execute First)

### 1.1. Purpose

The v2 `IndexEntry` schema was designed as a faithful port of the original MakeIndex output with structural improvements (typed sub-objects, reusable definitions, a `schema_version` discriminator). Now that `shruggie-catalog` is the next component to be built, the schema must be evaluated for its fitness as the primary input contract for a persistent metadata registry.

This section documents the analysis, renders decisions on each open question, and defines the implementation work for approved enhancements. All changes are additive and v2-compatible per the evolution principles in [§18.2.1](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#1821-evolution-principles) of the technical specification.

### 1.2. Analysis: The Transient Nature of IndexEntry

An `IndexEntry` is a point-in-time snapshot. Its fields describe a file's identity, metadata, and filesystem state at the moment of indexing. Over time:

- Content hashes change when file content is modified.
- Timestamps change through normal filesystem operations (access time on read, modification time on write).
- Metadata objects (sidecar files, ExifTool output) shift as external tools and source files change.
- Relative paths change when files are moved or when the index root differs between runs.

This transient nature is **correct by design**. The indexer's job is to produce accurate snapshots, not to track history. The catalog's job is to receive these snapshots, correlate them across time, and maintain a durable record of identity evolution. The key question is: does the IndexEntry carry enough information for the catalog to do its job effectively?

**Assessment:** Nearly. The current schema provides strong content identity (`id`, `hashes`), rich metadata provenance (`MetadataEntry` with full filesystem details for sidecars), and sufficient structural context (`file_system.relative`, `parent`). Two specific gaps have been identified and are addressed below.

### 1.3. Decision: Add `session_id` to IndexEntry

**Recommendation: Implement.**

The technical specification already identifies this as a candidate additive field ([§18.1.14](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#18114-session-id-in-json-output)). The session ID (a UUID4 generated per invocation) currently exists in the logging subsystem ([§11.4](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#114-session-identifiers)) but is not emitted in JSON output. With `shruggie-catalog` on the immediate horizon, the precondition stated in §18.1.14 — "Confirmation that the session ID is useful to downstream consumers" — is now satisfied.

**Value to the catalog:**

- **Run correlation.** Group all IndexEntries produced by a single invocation. This is essential for answering "what changed between this run and the last run?"
- **Staleness detection.** Compare session timestamps to determine which snapshot is freshest for a given file.
- **Provenance.** Link an IndexEntry back to the log output from the run that created it.
- **Batch integrity.** Detect incomplete ingestion (catalog received entries from session X but not all of them).

**Schema change:**

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `session_id` | `string` (UUID4) | No | Identifies the indexing invocation that produced this entry. Format: `xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx`. |

This field is optional (`required: false`) and absent from the `required` array. Existing consumers that do not recognize the field will ignore it. The `schema_version` remains `2` because this is a purely additive change. The canonical JSON Schema at `schemas.shruggie.tech` must be updated to include the field and relax `additionalProperties` at the root level (or enumerate the new field explicitly).

**Implementation notes:**

- The session UUID is already generated in the logging subsystem. The orchestrator (`entry.py`) must accept it as a parameter and pass it through to the `IndexEntry` constructor.
- For CLI invocations, the session UUID is generated once at CLI startup and threaded through.
- For API invocations via `index_path()`, the session UUID can be optionally provided; if omitted, a new one is generated per call.
- The GUI generates the session UUID per operation execution.

### 1.4. Decision: Add `indexed_at` Timestamp to IndexEntry

**Recommendation: Implement.**

This field is not listed in §18 but follows directly from the session_id rationale. While `session_id` groups entries by run, `indexed_at` records exactly *when* the snapshot was taken. This is distinct from the file's own timestamps (created, modified, accessed) — it records the indexer's observation time.

**Value to the catalog:**

- **Ordering.** Determine which of two snapshots of the same file is newer without requiring the catalog to maintain a separate "ingested_at" timestamp (though it may still do so).
- **TTL and freshness policies.** The catalog can enforce rules like "re-index files whose snapshots are older than N days."
- **Debugging.** Correlate indexing artifacts with real-world events ("when was this file last indexed?").

**Schema change:**

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `indexed_at` | `TimestampPair` | No | The moment this IndexEntry was constructed by the indexer. Uses the same `TimestampPair` format (`iso` + `unix`) as the `timestamps` fields. |

Same additive semantics as `session_id` — optional, not in the `required` array, `schema_version` stays at `2`.

### 1.5. Decision: Path Hashing in `file_system`

**Recommendation: Do not implement at this time.**

The question was whether to add a hash of the relative path, the absolute path, or both to the `file_system` object to facilitate catalog correlation and preserve privacy.

**Analysis:**

- **Relative path hash:** Limited utility. The relative path is context-dependent — it changes based on the index root. A hash of a context-dependent value is not a stable identity across runs unless the index root is always the same, which cannot be guaranteed.
- **Absolute path hash:** More useful as a machine-specific location fingerprint, but absolute paths also change when files move, drives are remounted, or network paths shift. The hash would enable "same file at same location" detection, but this is a narrow use case that the catalog can achieve by hashing paths on its own during ingest.
- **Privacy concern:** The absolute path is not currently in the schema. Adding a hash of it would not expose the path, but it would introduce a non-deterministic element (absolute paths vary by machine) into what is otherwise a content-deterministic output. This is philosophically at odds with the ecosystem's "identity is deterministic and client-originated" principle — though a `location_hash` would be metadata, not identity.

**Bottom line:** The catalog is the authority on path tracking and location history. It will need to implement its own path normalization and correlation logic regardless of whether the indexer pre-hashes paths. Adding path hashes to IndexEntry provides marginal benefit at the cost of schema complexity and philosophical inconsistency. If the catalog discovers a concrete need during development, this can be revisited as a v2-compatible additive field.

### 1.6. Decision: Additional Metadata Provenance for Catalog Duplicate Detection

**Recommendation: No changes needed.**

The existing `MetadataEntry` schema already carries sufficient provenance for the catalog to identify duplicates and track metadata changes:

- **Sidecar entries:** Full filesystem provenance (`file_system.relative`, `size`, `timestamps`) plus content `hashes`. The catalog can detect "same sidecar file with same content" or "same sidecar file with different content" by comparing these fields.
- **Generated entries (ExifTool):** Content `hashes` of the serialized output. The catalog can detect "metadata changed" by comparing hash values across snapshots.

No additional fields are warranted.

### 1.7. Decision: Tagging and Relationship Tracking

**Recommendation: No changes to IndexEntry. This is catalog responsibility.**

The [ecosystem direction document](https://github.com/shruggietech/shruggie-indexer/blob/main/.archive/20260223-002-ecosystem-direction.md) is explicit: the catalog is responsible for tracking logical references (collections, projects, users, snapshots). Adding tagging fields to IndexEntry would violate the separation of concerns and create coupling between the indexer and the catalog's taxonomy.

The indexer already provides rich raw material for automated tagging: MIME types, extension groups, EXIF metadata fields, sidecar content (e.g., `.description` text, `.info.json` structured data), and the relative path hierarchy. The catalog can derive tags from any of these during ingest without the indexer needing to know about tag schemas.

### 1.8. Decision: Catalog Versioning Assistance

**Recommendation: The `session_id` and `indexed_at` additions are the appropriate bridge. No further changes.**

The catalog will track version history by correlating IndexEntries with matching `id` values (same content hash → same file content) or matching `file_system.relative` + `parent.id` values (same location → potentially the same logical file). The `session_id` lets the catalog group entries by run. The `indexed_at` timestamp lets the catalog order snapshots chronologically. This is sufficient for the catalog to build a version timeline without the indexer needing to know about versioning semantics.

### 1.9. Implementation Tasks

The following code changes implement the approved schema enhancements (`session_id` and `indexed_at`).

**Affected files:**

| File | Nature of change |
|------|------------------|
| `src/shruggie_indexer/models/schema.py` | Add `session_id: str \| None` and `indexed_at: TimestampPair \| None` fields to `IndexEntry`. Update `to_dict()`. |
| `src/shruggie_indexer/core/entry.py` | Accept `session_id` parameter in `build_file_entry()` and `build_directory_entry()`. Generate `indexed_at` from `datetime.now(timezone.utc)` during entry construction. Thread `session_id` into recursive child entries. |
| `src/shruggie_indexer/cli/main.py` | Generate a UUID4 at CLI startup. Pass it through to all `index_path()` / `build_*_entry()` calls. |
| `src/shruggie_indexer/gui/app.py` | Generate a UUID4 per operation execution. Pass it through to `index_path()`. |
| `src/shruggie_indexer/__init__.py` | Update the public `index_path()` API to accept optional `session_id` parameter. |
| `docs/schema/shruggie-indexer-v2.schema.json` | Add `session_id` and `indexed_at` field definitions. Update `additionalProperties` or add to property enumeration. Do NOT add to the `required` array. |
| `docs/schema/index.md` | Document the new fields. |
| `tests/conformance/test_v2_schema.py` | Add test cases validating entries with and without the new fields. |
| `tests/unit/test_entry.py` | Verify `session_id` and `indexed_at` are populated when provided and absent when not. |

**Spec reference:** [§5.3](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#53-top-level-indexentry-fields) (Top-Level IndexEntry Fields), [§5.4](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#54-identity-fields) (Identity Fields), [§6.8](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#68-index-entry-construction) (Index Entry Construction), [§11.4](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#114-session-identifiers) (Session Identifiers), [§18.1.14](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#18114-session-id-in-json-output) (Session ID in JSON Output), [§18.2.1](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#1821-evolution-principles) (Evolution Principles).

### 1.10. Canonical Schema Synchronization

After the local `docs/schema/shruggie-indexer-v2.schema.json` is updated, the canonical hosted schema at `schemas.shruggie.tech/data/shruggie-indexer-v2.schema.json` must also be updated. This is a manual deployment step performed by the project owner after code changes are merged.

### 1.11. Acceptance Criteria

- `session_id` appears in JSON output when the indexer is invoked via CLI, GUI, or API.
- `indexed_at` appears in JSON output as a `TimestampPair` with ISO 8601 and Unix millisecond representations.
- All entries within a single CLI/GUI invocation share the same `session_id`.
- `indexed_at` values are unique per entry (they record the moment each individual entry was constructed, not the session start time).
- Entries produced without a `session_id` (e.g., direct `IndexEntry()` construction in tests) validate against the updated schema.
- The local v2 JSON Schema file validates entries both with and without the new fields.
- All existing tests continue to pass without modification (the new fields are optional).
- New test cases validate the presence and format of both fields.

---

## 2. Shared Configuration Namespace (Priority: High)

### 2.1. Purpose

The current configuration and session storage for `shruggie-indexer` uses a tool-specific application data directory:

| Platform | Current Path |
|----------|-------------|
| Windows | `%APPDATA%\shruggie-indexer\` |
| Linux | `~/.config/shruggie-indexer/` |
| macOS | `~/Library/Application Support/shruggie-indexer/` |

This path contains:

- `gui-session.json` — GUI presentation state (window geometry, last-used settings, output panel height).
- An optional TOML configuration file if placed here manually.
- Log files (when persistent logging is enabled).

As additional ShruggieTech utilities (`shruggie-catalog`, `shruggie-vault`, `shruggie-sync`) are developed, each will need its own configuration and session storage. These tools may also need to discover and inspect each other's configuration (e.g., `shruggie-sync` needs to know the indexer's configured hash algorithm). A shared namespace must be established now — before a second tool ships — to avoid a fragmented directory structure that requires backward-incompatible migration later.

### 2.2. Proposed Directory Structure

```
<APPDATA>/shruggie-tech/
├── shared.toml                         # Cross-tool shared configuration (future)
├── shruggie-indexer/
│   ├── gui-session.json                # GUI session state
│   ├── config.toml                     # Tool-specific TOML config (if present)
│   └── logs/                           # Persistent log files (if enabled)
├── shruggie-catalog/                   # (future)
│   ├── ...
├── shruggie-vault/                     # (future)
│   ├── ...
└── shruggie-sync/                      # (future)
    ├── ...
```

Platform-resolved base:

| Platform | Base Path |
|----------|-----------|
| Windows | `%APPDATA%\shruggie-tech\` |
| Linux | `~/.config/shruggie-tech/` |
| macOS | `~/Library/Application Support/shruggie-tech/` |

### 2.3. Migration Strategy

Since only one release (v0.1.0) has shipped with the old path, the migration burden is minimal. The implementation must:

1. **Check the new path first.** If `<APPDATA>/shruggie-tech/shruggie-indexer/` exists and contains a session file, use it.
2. **Fall back to the old path.** If the new path does not exist but `<APPDATA>/shruggie-indexer/` does, use the old path and log an INFO-level message recommending migration.
3. **Auto-migrate on write.** When the session file is written (on application exit or operation completion), write to the new path. Do not delete the old path — the user may be running an older version concurrently.
4. **Configuration file discovery.** The TOML config resolution chain ([§7.7](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#77-configuration-override-and-merging-behavior)) must search the new path before the old path. Project-local `.shruggie-indexer.toml` discovery is unaffected.

### 2.4. Cross-Tool Configuration (Design Only — Not Implemented in v0.1.1)

The `shared.toml` file in the `shruggie-tech/` root is reserved for cross-tool settings. It is NOT implemented in this release. The file is documented here to establish the convention:

```toml
# shruggie-tech/shared.toml (FUTURE — not yet consumed by any tool)

[identity]
default_algorithm = "md5"       # Preferred hash algorithm for all tools

[exiftool]
path = ""                       # Explicit ExifTool binary path (empty = PATH lookup)
```

Future tools SHOULD read `shared.toml` for defaults and allow tool-specific config to override. This convention will be formalized when `shruggie-catalog` development begins.

### 2.5. Implementation Tasks

**Affected files:**

| File | Nature of change |
|------|------------------|
| `src/shruggie_indexer/config/loader.py` | Update `_resolve_appdata_dir()` to return the new namespaced path. Add fallback logic for old path. |
| `src/shruggie_indexer/gui/app.py` | Update `SessionManager._resolve_path()` to use the new namespaced path with old-path fallback. Auto-migrate on write. |
| `docs/user-guide/configuration.md` | Update all path references. Note the migration from v0.1.0 paths. |
| `docs/user-guide/gui.md` | Update session persistence path references. |

**Spec reference:** [§3.3](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#33-configuration-file-locations) (Configuration File Locations), [§10.1](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#101-gui-framework-and-architecture) (Session Persistence).

### 2.6. Acceptance Criteria

- On a clean installation, configuration and session files are written to `<APPDATA>/shruggie-tech/shruggie-indexer/`.
- On an existing installation with files at the old `<APPDATA>/shruggie-indexer/` path, the application reads from the old path and writes to the new path transparently.
- The TOML configuration resolution chain searches the new path before the old path.
- The GUI session file is written to the new path on exit.
- "Open Config Folder" in the GUI opens the new path.
- No data is lost during migration. Old files are not deleted.
- All three platforms (Windows, Linux, macOS) are handled correctly.

---

## 3. GUI Advanced Configuration (Priority: Medium — Design and Scaffold)

### 3.1. Purpose

The GUI Settings page currently exposes a subset of indexer configuration: ID algorithm, SHA-512 toggle, JSON indentation, verbosity, tooltip toggle, and an optional TOML config file path. The full set of TOML-configurable behaviors — regex patterns, filesystem exclusion lists, ExifTool exclude extensions, ExifTool key exclusion set, sidecar identification patterns, and metadata exclusion patterns — is only accessible via manual TOML file editing or CLI flags.

For the GUI to serve as the primary interface for non-technical users, these advanced settings must be accessible within the application. This section scopes the design and initial scaffold for the Advanced Configuration panel. **Full implementation is deferred to a post-v0.1.1 release** to avoid delaying the pivot to `shruggie-catalog`. This sprint produces the UI scaffold, data binding plan, and persistence design — not the final polished UI.

### 3.2. Design Constraints

All GUI work MUST adhere to the design standards established in [§10.9](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#109-gui-design-standards) of the technical specification.

Key constraints for the Advanced panel:

- **Progressive disclosure.** The Advanced section should be collapsed or on a sub-tab by default. Casual users should not be confronted with regex patterns on first launch.
- **Sensible defaults are king.** Every advanced field must show its compiled default value. The user's mental model is "I'm overriding a default," not "I'm building a configuration from scratch."
- **Validation on edit.** Regex patterns must be validated in real-time (compile the regex on each keystroke; show a red border and tooltip on invalid patterns). Malformed patterns must not be saved.
- **Reset per section.** Each collapsible group (Filesystem Excludes, ExifTool, Sidecar Patterns, etc.) must have its own "Reset to Defaults" button independent of the global reset.

### 3.3. Configuration Groups

The Advanced panel should organize settings into the following collapsible groups, mirroring the TOML structure:

| Group | Settings | Widget types |
|-------|----------|-------------|
| Filesystem Exclusion | `filesystem_excludes.names`, `filesystem_excludes.globs` | Editable list (add/remove/reorder) |
| ExifTool | `exiftool.exclude_extensions`, `exiftool.exclude_keys` / `exclude_keys_append`, `exiftool.base_args` | Editable list, text entry |
| Extension Validation | `extension_validation_pattern` | Regex entry with live validation |
| Sidecar Identification | `metadata_identify.*` (per-type regex lists) | Per-type collapsible regex lists |
| Metadata Exclusion | `metadata_exclude.patterns` | Editable regex list with live validation |

### 3.4. Cross-Utility Considerations

When other ShruggieTech tools share configuration (per Section 2), the Advanced panel must clearly distinguish:

- **Shared settings** (read from `shared.toml`, apply to all tools).
- **Tool-specific settings** (read from the indexer's own config, apply only to this tool).

For v0.1.1, this distinction is cosmetic only — `shared.toml` is not yet consumed. The scaffold should include a visual grouping mechanism (e.g., a "Shared" vs. "Indexer-Specific" separator) that can be activated when cross-tool configuration is implemented.

### 3.5. Implementation Tasks (Scaffold Only)

**Affected files:**

| File | Nature of change |
|------|------------------|
| `src/shruggie_indexer/gui/app.py` | Add a collapsed "Advanced" section to the Settings tab. Populate with placeholder groups showing current default values as read-only text. Add "Edit" toggle that enables editing (deferred: actual data binding and persistence). |

**Spec reference:** [§7](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#7-configuration) (Configuration), [§10.4](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#104-configuration-panel) (Configuration Panel), [§10.9](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#109-gui-design-standards) (GUI Design Standards).

### 3.6. Acceptance Criteria

- The Settings tab includes a collapsed "Advanced" section below the existing settings.
- Expanding the section reveals labeled groups showing the compiled default values for each configuration area.
- The groups are read-only in this release (editing infrastructure is deferred).
- The section does not interfere with existing settings functionality.
- The layout adheres to the design standards in §10.9.
- A `TODO` comment or admonition in the code clearly marks the deferred editing implementation.

---

## 4. Archive Normalization and Documentation Reference Updates (Priority: Medium)

### 4.1. Purpose

The `.archive/` directory has accumulated documents with inconsistent naming. A normalized naming system must be established and applied to all existing archive contents. Additionally, references to specification artifacts (the PDF and HTML renderings) on the documentation site must be updated to include direct download links.

### 4.2. Naming Convention

All files in `.archive/` MUST follow this pattern:

```
<YYYYmmdd>-<ZeroPaddedIncrement>-<title>.<ext>
```

- `YYYYmmdd` — The date the document was created or, for generated artifacts, the date of the source content.
- `ZeroPaddedIncrement` — A three-digit zero-padded sequence number (`001`, `002`, etc.) for ordering documents created on the same date. Related clusters of documents (e.g., an update doc and its prompt template) MAY share the same increment.
- `title` — A lowercase-hyphenated descriptive title.
- `ext` — The file extension.

### 4.3. File Renames

The following renames must be performed within `.archive/`:

| Current Name | New Name | Rationale |
|-------------|----------|-----------|
| `shruggie-indexer-spec.pdf` | `20260224-001-shruggie-indexer-spec.pdf` | Date of latest spec content |
| `shruggie-indexer-spec.html` | `20260224-001-shruggie-indexer-spec.html` | Date of latest spec content |
| `shruggie-indexer-plan.md` | `20260219-002-shruggie-indexer-plan.md` | Original plan creation date; increment `002` to follow any earlier docs from that date |

**Note:** The `.md` update documents and their associated templates already follow the naming convention (e.g., `20260223-001-Updates.md`). No renames are needed for these files.

**Important:** After renames, verify that no references to the old filenames exist in the spec or documentation site. The spec's §1.5 already points to `.archive/shruggie-indexer-plan.md` — this reference must be updated to the new name. The HTML and PDF spec renderings are referenced in §3.1 — these references must also be updated.

### 4.4. Documentation Site — Spec Reference Enhancement

The documentation site's landing page (`docs/index.md`) currently includes a "Technical Specification" link under Quick Links that points to the Markdown spec on GitHub:

```markdown
- [Technical Specification](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md)
```

This must be enhanced to also include a link to the raw PDF download hosted on GitHub. The PDF provides a more readable format for human consumption and can be viewed offline.

**Updated Quick Links section (proposed):**

```markdown
## Quick Links

- [GitHub Repository](https://github.com/shruggietech/shruggie-indexer)
- [V2 JSON Schema (canonical)](https://schemas.shruggie.tech/data/shruggie-indexer-v2.schema.json)
- Technical Specification:
    - [Markdown (GitHub)](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md)
    - [PDF Download](https://raw.githubusercontent.com/shruggietech/shruggie-indexer/main/.archive/20260224-001-shruggie-indexer-spec.pdf)
```

Maintaining a list of date-specific PDF versions is not recommended. The archive directory already provides version history via the naming convention and git history. The documentation site should always link to the latest version.

### 4.5. Implementation Tasks

**Affected files:**

| File | Nature of change |
|------|------------------|
| `.archive/shruggie-indexer-spec.pdf` | Rename to `20260224-001-shruggie-indexer-spec.pdf` |
| `.archive/shruggie-indexer-spec.html` | Rename to `20260224-001-shruggie-indexer-spec.html` |
| `.archive/shruggie-indexer-plan.md` | Rename to `20260219-002-shruggie-indexer-plan.md` |
| `shruggie-indexer-spec.md` §1.5 | Update the Implementation Plan path reference to the new filename. |
| `shruggie-indexer-spec.md` §3.1 | Update the HTML and PDF rendering descriptions to reference new filenames. |
| `shruggie-indexer-spec.md` §3.6 | Update Documentation Artifacts references if they mention the old filenames. |
| `docs/index.md` | Update Quick Links to include the PDF download link. |

**Spec reference:** [§1.5](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#15-reference-documents) (Reference Documents), [§3.1](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#31-top-level-layout) (Top-Level Layout), [§3.6](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#36-documentation-artifacts) (Documentation Artifacts).

### 4.6. Acceptance Criteria

- All files in `.archive/` follow the `<YYYYmmdd>-<ZZZ>-<title>.<ext>` naming convention.
- No broken references exist in the spec or documentation site after renames.
- The documentation site landing page includes both Markdown (GitHub UI) and PDF (raw download) links to the technical specification.
- `mkdocs build --strict` passes with zero warnings after all changes.

---

## 5. Documentation Site Synchronization (Priority: Medium)

### 5.1. Purpose

Two specific synchronization issues must be resolved before the release:

1. **Changelog drift.** The documentation site's changelog page (`docs/changelog.md`) does not automatically reflect the contents of the repository's `CHANGELOG.md`. Any manual edits to one are not propagated to the other. This must be addressed permanently.
2. **Content from prior sprints.** The specification received substantial edits during the `20260223-002` update cycle (GUI design standards, logging infrastructure, ExifTool error handling, etc.). The documentation site must be verified against these changes to ensure no behavioral contradictions exist between the spec and the user-facing docs.

### 5.2. Changelog Synchronization — Permanent Solution

**Problem:** Two separate files contain changelog content:

- `CHANGELOG.md` (repository root) — The authoritative source.
- `docs/changelog.md` — The documentation site page.

Manually keeping these in sync is fragile and has already drifted.

**Recommended approach:** Replace the contents of `docs/changelog.md` with an include directive that pulls from the root `CHANGELOG.md`. MkDocs does not natively support including files outside the `docs/` directory, but there are two clean solutions:

**Option A: Symlink.** Create `docs/changelog.md` as a symbolic link to `../CHANGELOG.md`. MkDocs follows symlinks during build. This is the simplest solution and works on all platforms.

```bash
# From the repository root:
rm docs/changelog.md
ln -s ../CHANGELOG.md docs/changelog.md
```

**Caveat:** Windows requires developer mode or elevated privileges to create symlinks. Since the documentation site is built by GitHub Actions (Linux), the symlink will resolve correctly in CI. Local Windows development may require `mkdocs-include-markdown-plugin` as a fallback.

**Option B: Build-time copy.** Add a pre-build step to `mkdocs.yml` or the docs CI workflow that copies `CHANGELOG.md` to `docs/changelog.md` before `mkdocs build`. This avoids symlink issues entirely.

```yaml
# In .github/workflows/docs.yml, before mkdocs build:
- name: Sync changelog
  run: cp CHANGELOG.md docs/changelog.md
```

**Recommendation:** Use Option B (build-time copy). It is the most portable solution and avoids symlink complications on Windows. The copy step should also be documented in a comment at the top of `docs/changelog.md` to prevent manual edits:

```markdown
<!-- THIS FILE IS AUTO-COPIED FROM CHANGELOG.md AT THE REPOSITORY ROOT. -->
<!-- DO NOT EDIT THIS FILE DIRECTLY. Edit CHANGELOG.md instead. -->
```

### 5.3. Documentation Site Content Verification

After all prior sprints in this document are complete, the following documentation pages must be verified against the spec and updated if discrepancies are found:

| Page | Verify against | Focus areas |
|------|---------------|-------------|
| `docs/schema/index.md` | §5.3, §5.4, §5.10 | New `session_id` and `indexed_at` fields. MetadataEntry field table. |
| `docs/user-guide/configuration.md` | §3.3, §7 | New AppData path structure. Config resolution chain. |
| `docs/user-guide/gui.md` | §10.4 | Session persistence paths. Advanced settings scaffold mention. |
| `docs/user-guide/python-api.md` | §9 | `IndexEntry` dataclass fields (new optional fields). `index_path()` signature (new `session_id` parameter). |
| `docs/user-guide/cli-reference.md` | §8 | No CLI flag changes expected, but verify consistency. |
| `docs/index.md` | — | Quick Links update from Section 4. General landing page accuracy. |

### 5.4. Implementation Tasks

**Affected files:**

| File | Nature of change |
|------|------------------|
| `docs/changelog.md` | Replace with auto-copy header + content from `CHANGELOG.md`. |
| `.github/workflows/docs.yml` | Add changelog copy step before `mkdocs build`. |
| `docs/schema/index.md` | Add `session_id` and `indexed_at` to field tables. |
| `docs/user-guide/configuration.md` | Update AppData paths. Note migration from v0.1.0 paths. |
| `docs/user-guide/gui.md` | Update session persistence paths. Mention Advanced section. |
| `docs/user-guide/python-api.md` | Update `IndexEntry` field listing. Update `index_path()` signature. |

**Spec reference:** [§3.7](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#37-documentation-site) (Documentation Site), [§5.3](https://github.com/shruggietech/shruggie-indexer/blob/main/shruggie-indexer-spec.md#53-top-level-indexentry-fields) (Top-Level IndexEntry Fields).

### 5.5. Acceptance Criteria

- `docs/changelog.md` is auto-generated from `CHANGELOG.md` during CI build. Manual edits to `docs/changelog.md` are overwritten.
- The documentation site changelog matches the repository changelog exactly after build.
- All documentation site pages accurately reflect the current state of the codebase after Sections 1–4.
- `mkdocs build --strict` passes with zero warnings.
- No behavioral contradictions exist between the spec and the documentation site.

---

## 6. Specification Update Directive (Priority: Required — Execute Last)

### 6.1. Purpose

After all work items in Sections 1–5 have been completed, the project technical specification (`shruggie-indexer-spec.md`) must be updated to reflect the changes that were implemented. This is the standard post-implementation synchronization step — the spec is the authoritative source of truth and must remain current.

This section addresses spec updates triggered by the behavioral changes in Sections 1–5. It does NOT overlap with the tone overhaul described in `20260223-002-Updates.md` Section 6, which is a separate multi-session effort that may be ongoing.

### 6.2. Required Spec Updates

| Section affected | Update trigger | Nature of update |
|-----------------|---------------|------------------|
| §5.3 — Top-Level IndexEntry Fields | Section 1 (`session_id`, `indexed_at`) | Add new fields to the property table. Update the `required` array documentation to note these are optional. |
| §5.4 — Identity Fields (or new §5.x) | Section 1 | Document `session_id` semantics, format, and population rules. Document `indexed_at` semantics and its distinction from file timestamps. |
| §6.8 — Index Entry Construction | Section 1 | Update the orchestration step list to include `session_id` threading and `indexed_at` generation. |
| §9.1 / §9.2 — Public API Surface | Section 1 | Document the new optional `session_id` parameter on `index_path()`. |
| §11.4 — Session Identifiers | Section 1 | Note that the session UUID now appears in JSON output in addition to log output. |
| §18.1.14 — Session ID in JSON Output | Section 1 | Mark as IMPLEMENTED. Update the description to reflect the actual implementation. |
| §3.3 — Configuration File Locations | Section 2 | Rewrite to document the new `shruggie-tech/` namespace, the migration strategy, and the old-path fallback. |
| §10.1 — Session Persistence | Section 2 | Update the session file location table to reflect the new paths. Document the auto-migration behavior. |
| §10.4 — Configuration Panel | Section 3 | Note the existence of the Advanced section scaffold. Mark full implementation as deferred. |
| §1.5 — Reference Documents | Section 4 | Update archived plan filename. |
| §3.1 — Top-Level Layout | Section 4 | Update filenames for HTML/PDF renderings and archived plan. |
| §3.6 — Documentation Artifacts | Section 4 | Update filenames for HTML/PDF renderings. |
| §3.7 — Documentation Site | Section 5 | Note the changelog auto-copy mechanism. |

### 6.3. Update Principles

1. **Preserve the document's existing style and conventions.** Use the same cross-referencing notation (§X.Y), deviation codes (DEV-XX), and formatting patterns already established in the spec.
2. **Do not remove historical context.** Deviation notes and comparison-to-original sections should be preserved. New changes should be documented alongside them, not in place of them.
3. **Mark new content clearly.** If a section is substantially rewritten, add a brief note at the top of the section indicating the update date and the triggering change (e.g., "Updated 2026-02-24: Added `session_id` and `indexed_at` per Pending Updates (2026-02-24), Section 1.").
4. **Regenerate the HTML and PDF renderings** of the spec after all textual updates are complete, using the same VS Code plugin workflow that produced the current `.html` and `.pdf` files. The regenerated files go to `.archive/` with the `20260224-001-` prefix per the naming convention established in Section 4.

### 6.4. Acceptance Criteria

- Every behavioral change implemented in Sections 1–5 is reflected in the spec.
- No spec section describes behavior that contradicts the implemented code.
- All cross-references (§X.Y) remain valid.
- The spec's §3.1 repository layout is synchronized with the actual repository.
- The generated `.html` and `.pdf` renderings are regenerated from the updated `.md` source.

---

## 7. Release v0.1.1 (Priority: Required — Execute Last)

### 7.1. Purpose

This section defines the final steps to cut the v0.1.1 release. It is a standalone sprint that must be executed after all other sections in this document are complete and merged.

### 7.2. Pre-Release Checklist

Before tagging the release, verify the following:

| Check | How to verify |
|-------|--------------|
| All Sections 1–6 are complete and merged to `main`. | Review commit history. |
| `CHANGELOG.md` includes a `## [0.1.1] - 2026-02-24` section. | Open the file and verify. |
| The changelog section accurately describes all changes in this update cycle. | Compare against this document. |
| `_version.py` reflects `0.1.1`. | `grep version src/shruggie_indexer/_version.py` |
| `pyproject.toml` version reflects `0.1.1`. | `grep version pyproject.toml` |
| All tests pass. | `pytest` |
| `ruff check src/` — zero errors. | Run the linter. |
| `mkdocs build --strict` — zero warnings. | Build the docs. |
| The documentation site changelog matches `CHANGELOG.md`. | Compare after build. |
| The canonical v2 JSON Schema at `schemas.shruggie.tech` has been updated (if schema changes landed). | Manual verification by project owner. |

### 7.3. Changelog Entry Template

```markdown
## [0.1.1] - 2026-02-24

### Added
- **Schema: `session_id` field** — New optional field on `IndexEntry` containing a UUID4 that identifies the indexing session. All entries produced by a single CLI/GUI invocation share the same session ID. Enables downstream tools (e.g., `shruggie-catalog`) to correlate entries by run.
- **Schema: `indexed_at` field** — New optional field on `IndexEntry` recording the moment the entry was constructed, as a `TimestampPair` (ISO 8601 + Unix milliseconds). Distinct from file timestamps — records the indexer's observation time.
- **GUI: Advanced configuration scaffold** — The Settings tab now includes a collapsed "Advanced" section showing compiled default values for all TOML-configurable settings. Editing capability is deferred to a future release.

### Changed
- **Configuration namespace migration** — Application data directory moved from `<APPDATA>/shruggie-indexer/` to `<APPDATA>/shruggie-tech/shruggie-indexer/` to establish a shared namespace for the ShruggieTech utility ecosystem. Existing configurations are auto-migrated on first write.
- **Archive file naming** — All `.archive/` files now follow a normalized `<YYYYmmdd>-<ZZZ>-<title>.<ext>` naming convention.
- **Documentation site: Changelog synchronization** — The changelog page is now auto-copied from the repository root `CHANGELOG.md` during CI build, eliminating manual synchronization.
- **Documentation site: Spec reference** — Quick Links now includes a direct PDF download link for the technical specification.
- **Documentation site: Schema reference** — Updated to document the new `session_id` and `indexed_at` fields.
```

### 7.4. Release Process

The project already has an automated release pipeline (`.github/workflows/release.yml`) that triggers on tag push and builds cross-platform binaries via PyInstaller.

**Steps:**

1. Finalize the `CHANGELOG.md` entry. Commit with message: `docs: finalize changelog for v0.1.1`.
2. Update `_version.py` and `pyproject.toml` to `0.1.1`. Commit with message: `release: bump version to 0.1.1`.
3. Tag the release: `git tag v0.1.1`.
4. Push the tag: `git push origin v0.1.1`.
5. The release pipeline will build CLI and GUI binaries for Windows, Linux, and macOS, create a GitHub Release with the binaries attached, and deploy the updated documentation site.
6. Verify the GitHub Release page, download links, and documentation site deployment.

### 7.5. Acceptance Criteria

- A GitHub Release exists for v0.1.1 with binaries for all three platforms.
- The documentation site is deployed and accessible.
- The changelog on the documentation site matches `CHANGELOG.md`.
- The `main` branch is clean — no uncommitted changes or pending work items.
